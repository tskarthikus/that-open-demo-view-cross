var t,e,s,i,n,r,o,a,h,c,l,u,d,p,m,f,g,y,b,x,_,w,S,v,M,I,A,B,T,z,C,L,P,F,O,E,k,V,R,U,D,N,G,q,W,H,j,Z,Y,X,J,Q,$,K,tt,et,st,it=Object.defineProperty,nt=(t,e,s)=>(((t,e,s)=>{e in t?it(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s})(t,"symbol"!=typeof e?e+"":e,s),s),rt=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},ot=(t,e,s)=>(rt(t,e,"read from private field"),s?s.call(t):e.get(t)),at=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},ht=(t,e,s,i)=>(rt(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),ct=(t,e,s,i)=>({set _(i){ht(t,e,i,s)},get _(){return ot(t,e,i)}}),lt=(t,e,s)=>(rt(t,e,"access private method"),s);const ut="172",dt=1001,pt=1015,mt=1023,ft="srgb",gt="srgb-linear",yt="linear",bt="srgb",xt=7680,_t=2e3,wt=2001;class St{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const s=this._listeners;void 0===s[t]&&(s[t]=[]),-1===s[t].indexOf(e)&&s[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const s=this._listeners;return void 0!==s[t]&&-1!==s[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const s=this._listeners[t];if(void 0!==s){const t=s.indexOf(e);-1!==t&&s.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const s=e.slice(0);for(let e=0,i=s.length;e<i;e++)s[e].call(this,t);t.target=null}}}const vt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];const Mt=Math.PI/180;Math.PI;function It(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,s=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(vt[255&t]+vt[t>>8&255]+vt[t>>16&255]+vt[t>>24&255]+"-"+vt[255&e]+vt[e>>8&255]+"-"+vt[e>>16&15|64]+vt[e>>24&255]+"-"+vt[63&s|128]+vt[s>>8&255]+"-"+vt[s>>16&255]+vt[s>>24&255]+vt[255&i]+vt[i>>8&255]+vt[i>>16&255]+vt[i>>24&255]).toLowerCase()}function At(t,e,s){return Math.max(e,Math.min(s,t))}function Bt(t,e){return(t%e+e)%e}function Tt(t,e,s){return(1-s)*t+s*e}function zt(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Ct(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const Lt=Mt;class Pt{constructor(t=0,e=0){Pt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,s=this.y,i=t.elements;return this.x=i[0]*e+i[3]*s+i[6],this.y=i[1]*e+i[4]*s+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=At(this.x,t.x,e.x),this.y=At(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=At(this.x,t,e),this.y=At(this.y,t,e),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(At(s,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(At(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const s=Math.cos(e),i=Math.sin(e),n=this.x-t.x,r=this.y-t.y;return this.x=n*s-r*i+t.x,this.y=n*i+r*s+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ft{constructor(t,e,s,i,n,r,o,a,h){Ft.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,s,i,n,r,o,a,h)}set(t,e,s,i,n,r,o,a,h){const c=this.elements;return c[0]=t,c[1]=i,c[2]=o,c[3]=e,c[4]=n,c[5]=a,c[6]=s,c[7]=r,c[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}extractBasis(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,r=s[0],o=s[3],a=s[6],h=s[1],c=s[4],l=s[7],u=s[2],d=s[5],p=s[8],m=i[0],f=i[3],g=i[6],y=i[1],b=i[4],x=i[7],_=i[2],w=i[5],S=i[8];return n[0]=r*m+o*y+a*_,n[3]=r*f+o*b+a*w,n[6]=r*g+o*x+a*S,n[1]=h*m+c*y+l*_,n[4]=h*f+c*b+l*w,n[7]=h*g+c*x+l*S,n[2]=u*m+d*y+p*_,n[5]=u*f+d*b+p*w,n[8]=u*g+d*x+p*S,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],c=t[8];return e*r*c-e*o*h-s*n*c+s*o*a+i*n*h-i*r*a}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],c=t[8],l=c*r-o*h,u=o*a-c*n,d=h*n-r*a,p=e*l+s*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=l*m,t[1]=(i*h-c*s)*m,t[2]=(o*s-i*r)*m,t[3]=u*m,t[4]=(c*e-i*a)*m,t[5]=(i*n-o*e)*m,t[6]=d*m,t[7]=(s*a-h*e)*m,t[8]=(r*e-s*n)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,s,i,n,r,o){const a=Math.cos(n),h=Math.sin(n);return this.set(s*a,s*h,-s*(a*r+h*o)+r+t,-i*h,i*a,-i*(-h*r+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Ot.makeScale(t,e)),this}rotate(t){return this.premultiply(Ot.makeRotation(-t)),this}translate(t,e){return this.premultiply(Ot.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,s,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,s=t.elements;for(let t=0;t<9;t++)if(e[t]!==s[t])return!1;return!0}fromArray(t,e=0){for(let s=0;s<9;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const Ot=new Ft;function Et(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}const kt=(new Ft).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Vt=(new Ft).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Rt(){const t={enabled:!0,workingColorSpace:gt,spaces:{},convert:function(t,e,s){return!1!==this.enabled&&e!==s&&e&&s?(this.spaces[e].transfer===bt&&(t.r=Dt(t.r),t.g=Dt(t.g),t.b=Dt(t.b)),this.spaces[e].primaries!==this.spaces[s].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[s].fromXYZ)),this.spaces[s].transfer===bt&&(t.r=Nt(t.r),t.g=Nt(t.g),t.b=Nt(t.b)),t):t},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return""===t?yt:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,s){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[s].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],s=[.2126,.7152,.0722],i=[.3127,.329];return t.define({[gt]:{primaries:e,whitePoint:i,transfer:yt,toXYZ:kt,fromXYZ:Vt,luminanceCoefficients:s,workingColorSpaceConfig:{unpackColorSpace:ft},outputColorSpaceConfig:{drawingBufferColorSpace:ft}},[ft]:{primaries:e,whitePoint:i,transfer:bt,toXYZ:kt,fromXYZ:Vt,luminanceCoefficients:s,outputColorSpaceConfig:{drawingBufferColorSpace:ft}}}),t}const Ut=Rt();function Dt(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Nt(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let Gt;class qt{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Gt&&(Gt=Et("canvas")),Gt.width=t.width,Gt.height=t.height;const s=Gt.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),e=Gt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=Et("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0,t.width,t.height);const i=s.getImageData(0,0,t.width,t.height),n=i.data;for(let t=0;t<n.length;t++)n[t]=255*Dt(n[t]/255);return s.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Dt(e[t]/255)):e[t]=Dt(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Wt=0;class Ht{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Wt++}),this.uuid=It(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const s={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,s=i.length;e<s;e++)i[e].isDataTexture?t.push(jt(i[e].image)):t.push(jt(i[e]))}else t=jt(i);s.url=t}return e||(t.images[this.uuid]=s),s}}function jt(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?qt.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Zt=0;class Yt extends St{constructor(t=Yt.DEFAULT_IMAGE,e=Yt.DEFAULT_MAPPING,s=1001,i=1001,n=1006,r=1008,o=1023,a=1009,h=Yt.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Zt++}),this.uuid=It(),this.name="",this.source=new Ht(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=s,this.wrapT=i,this.magFilter=n,this.minFilter=r,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Pt(0,0),this.repeat=new Pt(1,1),this.center=new Pt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ft,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),e||(t.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case dt:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case dt:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}Yt.DEFAULT_IMAGE=null,Yt.DEFAULT_MAPPING=300,Yt.DEFAULT_ANISOTROPY=1;class Xt{constructor(t=0,e=0,s=0,i=1){Xt.prototype.isVector4=!0,this.x=t,this.y=e,this.z=s,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,s,i){return this.x=t,this.y=e,this.z=s,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,n=this.w,r=t.elements;return this.x=r[0]*e+r[4]*s+r[8]*i+r[12]*n,this.y=r[1]*e+r[5]*s+r[9]*i+r[13]*n,this.z=r[2]*e+r[6]*s+r[10]*i+r[14]*n,this.w=r[3]*e+r[7]*s+r[11]*i+r[15]*n,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,s,i,n;const r=.01,o=.1,a=t.elements,h=a[0],c=a[4],l=a[8],u=a[1],d=a[5],p=a[9],m=a[2],f=a[6],g=a[10];if(Math.abs(c-u)<r&&Math.abs(l-m)<r&&Math.abs(p-f)<r){if(Math.abs(c+u)<o&&Math.abs(l+m)<o&&Math.abs(p+f)<o&&Math.abs(h+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(h+1)/2,a=(d+1)/2,y=(g+1)/2,b=(c+u)/4,x=(l+m)/4,_=(p+f)/4;return t>a&&t>y?t<r?(s=0,i=.707106781,n=.707106781):(s=Math.sqrt(t),i=b/s,n=x/s):a>y?a<r?(s=.707106781,i=0,n=.707106781):(i=Math.sqrt(a),s=b/i,n=_/i):y<r?(s=.707106781,i=.707106781,n=0):(n=Math.sqrt(y),s=x/n,i=_/n),this.set(s,i,n,e),this}let y=Math.sqrt((f-p)*(f-p)+(l-m)*(l-m)+(u-c)*(u-c));return Math.abs(y)<.001&&(y=1),this.x=(f-p)/y,this.y=(l-m)/y,this.z=(u-c)/y,this.w=Math.acos((h+d+g-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=At(this.x,t.x,e.x),this.y=At(this.y,t.y,e.y),this.z=At(this.z,t.z,e.z),this.w=At(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=At(this.x,t,e),this.y=At(this.y,t,e),this.z=At(this.z,t,e),this.w=At(this.w,t,e),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(At(s,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this.w=t.w+(e.w-t.w)*s,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Jt{constructor(t=0,e=0,s=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=i}static slerpFlat(t,e,s,i,n,r,o){let a=s[i+0],h=s[i+1],c=s[i+2],l=s[i+3];const u=n[r+0],d=n[r+1],p=n[r+2],m=n[r+3];if(0===o)return t[e+0]=a,t[e+1]=h,t[e+2]=c,void(t[e+3]=l);if(1===o)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=m);if(l!==m||a!==u||h!==d||c!==p){let t=1-o;const e=a*u+h*d+c*p+l*m,s=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const n=Math.sqrt(i),r=Math.atan2(n,e*s);t=Math.sin(t*r)/n,o=Math.sin(o*r)/n}const n=o*s;if(a=a*t+u*n,h=h*t+d*n,c=c*t+p*n,l=l*t+m*n,t===1-o){const t=1/Math.sqrt(a*a+h*h+c*c+l*l);a*=t,h*=t,c*=t,l*=t}}t[e]=a,t[e+1]=h,t[e+2]=c,t[e+3]=l}static multiplyQuaternionsFlat(t,e,s,i,n,r){const o=s[i],a=s[i+1],h=s[i+2],c=s[i+3],l=n[r],u=n[r+1],d=n[r+2],p=n[r+3];return t[e]=o*p+c*l+a*d-h*u,t[e+1]=a*p+c*u+h*l-o*d,t[e+2]=h*p+c*d+o*u-a*l,t[e+3]=c*p-o*l-a*u-h*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,i){return this._x=t,this._y=e,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const s=t._x,i=t._y,n=t._z,r=t._order,o=Math.cos,a=Math.sin,h=o(s/2),c=o(i/2),l=o(n/2),u=a(s/2),d=a(i/2),p=a(n/2);switch(r){case"XYZ":this._x=u*c*l+h*d*p,this._y=h*d*l-u*c*p,this._z=h*c*p+u*d*l,this._w=h*c*l-u*d*p;break;case"YXZ":this._x=u*c*l+h*d*p,this._y=h*d*l-u*c*p,this._z=h*c*p-u*d*l,this._w=h*c*l+u*d*p;break;case"ZXY":this._x=u*c*l-h*d*p,this._y=h*d*l+u*c*p,this._z=h*c*p+u*d*l,this._w=h*c*l-u*d*p;break;case"ZYX":this._x=u*c*l-h*d*p,this._y=h*d*l+u*c*p,this._z=h*c*p-u*d*l,this._w=h*c*l+u*d*p;break;case"YZX":this._x=u*c*l+h*d*p,this._y=h*d*l+u*c*p,this._z=h*c*p-u*d*l,this._w=h*c*l-u*d*p;break;case"XZY":this._x=u*c*l-h*d*p,this._y=h*d*l-u*c*p,this._z=h*c*p+u*d*l,this._w=h*c*l+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,i=Math.sin(s);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],i=e[4],n=e[8],r=e[1],o=e[5],a=e[9],h=e[2],c=e[6],l=e[10],u=s+o+l;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(c-a)*t,this._y=(n-h)*t,this._z=(r-i)*t}else if(s>o&&s>l){const t=2*Math.sqrt(1+s-o-l);this._w=(c-a)/t,this._x=.25*t,this._y=(i+r)/t,this._z=(n+h)/t}else if(o>l){const t=2*Math.sqrt(1+o-s-l);this._w=(n-h)/t,this._x=(i+r)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+l-s-o);this._w=(r-i)/t,this._x=(n+h)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(At(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(0===s)return this;const i=Math.min(1,e/s);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,i=t._y,n=t._z,r=t._w,o=e._x,a=e._y,h=e._z,c=e._w;return this._x=s*c+r*o+i*h-n*a,this._y=i*c+r*a+n*o-s*h,this._z=n*c+r*h+s*a-i*o,this._w=r*c-s*o-i*a-n*h,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const s=this._x,i=this._y,n=this._z,r=this._w;let o=r*t._w+s*t._x+i*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=r,this._x=s,this._y=i,this._z=n,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*r+e*this._w,this._x=t*s+e*this._x,this._y=t*i+e*this._y,this._z=t*n+e*this._z,this.normalize(),this}const h=Math.sqrt(a),c=Math.atan2(h,o),l=Math.sin((1-e)*c)/h,u=Math.sin(e*c)/h;return this._w=r*l+this._w*u,this._x=s*l+this._x*u,this._y=i*l+this._y*u,this._z=n*l+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),s=Math.random(),i=Math.sqrt(1-s),n=Math.sqrt(s);return this.set(i*Math.sin(t),i*Math.cos(t),n*Math.sin(e),n*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Qt{constructor(t=0,e=0,s=0){Qt.prototype.isVector3=!0,this.x=t,this.y=e,this.z=s}set(t,e,s){return void 0===s&&(s=this.z),this.x=t,this.y=e,this.z=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Kt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Kt.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[3]*s+n[6]*i,this.y=n[1]*e+n[4]*s+n[7]*i,this.z=n[2]*e+n[5]*s+n[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,n=t.elements,r=1/(n[3]*e+n[7]*s+n[11]*i+n[15]);return this.x=(n[0]*e+n[4]*s+n[8]*i+n[12])*r,this.y=(n[1]*e+n[5]*s+n[9]*i+n[13])*r,this.z=(n[2]*e+n[6]*s+n[10]*i+n[14])*r,this}applyQuaternion(t){const e=this.x,s=this.y,i=this.z,n=t.x,r=t.y,o=t.z,a=t.w,h=2*(r*i-o*s),c=2*(o*e-n*i),l=2*(n*s-r*e);return this.x=e+a*h+r*l-o*c,this.y=s+a*c+o*h-n*l,this.z=i+a*l+n*c-r*h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[4]*s+n[8]*i,this.y=n[1]*e+n[5]*s+n[9]*i,this.z=n[2]*e+n[6]*s+n[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=At(this.x,t.x,e.x),this.y=At(this.y,t.y,e.y),this.z=At(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=At(this.x,t,e),this.y=At(this.y,t,e),this.z=At(this.z,t,e),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(At(s,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const s=t.x,i=t.y,n=t.z,r=e.x,o=e.y,a=e.z;return this.x=i*a-n*o,this.y=n*r-s*a,this.z=s*o-i*r,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)}projectOnPlane(t){return $t.copy(this).projectOnVector(t),this.sub($t)}reflect(t){return this.sub($t.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(At(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y,i=this.z-t.z;return e*e+s*s+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,s){const i=Math.sin(e)*t;return this.x=i*Math.sin(s),this.y=Math.cos(e)*t,this.z=i*Math.cos(s),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,s=Math.sqrt(1-e*e);return this.x=s*Math.cos(t),this.y=e,this.z=s*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const $t=new Qt,Kt=new Jt;class te{constructor(t=new Qt(1/0,1/0,1/0),e=new Qt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e+=3)this.expandByPoint(se.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,s=t.count;e<s;e++)this.expandByPoint(se.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=se.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const s=t.geometry;if(void 0!==s){const i=s.getAttribute("position");if(!0===e&&void 0!==i&&!0!==t.isInstancedMesh)for(let e=0,s=i.count;e<s;e++)!0===t.isMesh?t.getVertexPosition(e,se):se.fromBufferAttribute(i,e),se.applyMatrix4(t.matrixWorld),this.expandByPoint(se);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),ie.copy(t.boundingBox)):(null===s.boundingBox&&s.computeBoundingBox(),ie.copy(s.boundingBox)),ie.applyMatrix4(t.matrixWorld),this.union(ie)}const i=t.children;for(let t=0,s=i.length;t<s;t++)this.expandByObject(i[t],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,se),se.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,s;return t.normal.x>0?(e=t.normal.x*this.min.x,s=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,s=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,s+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,s+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,s+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,s+=t.normal.z*this.min.z),e<=-t.constant&&s>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(le),ue.subVectors(this.max,le),ne.subVectors(t.a,le),re.subVectors(t.b,le),oe.subVectors(t.c,le),ae.subVectors(re,ne),he.subVectors(oe,re),ce.subVectors(ne,oe);let e=[0,-ae.z,ae.y,0,-he.z,he.y,0,-ce.z,ce.y,ae.z,0,-ae.x,he.z,0,-he.x,ce.z,0,-ce.x,-ae.y,ae.x,0,-he.y,he.x,0,-ce.y,ce.x,0];return!!me(e,ne,re,oe,ue)&&(e=[1,0,0,0,1,0,0,0,1],!!me(e,ne,re,oe,ue)&&(de.crossVectors(ae,he),e=[de.x,de.y,de.z],me(e,ne,re,oe,ue)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,se).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(se).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(ee[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ee[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ee[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ee[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ee[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ee[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ee[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ee[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ee)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const ee=[new Qt,new Qt,new Qt,new Qt,new Qt,new Qt,new Qt,new Qt],se=new Qt,ie=new te,ne=new Qt,re=new Qt,oe=new Qt,ae=new Qt,he=new Qt,ce=new Qt,le=new Qt,ue=new Qt,de=new Qt,pe=new Qt;function me(t,e,s,i,n){for(let r=0,o=t.length-3;r<=o;r+=3){pe.fromArray(t,r);const o=n.x*Math.abs(pe.x)+n.y*Math.abs(pe.y)+n.z*Math.abs(pe.z),a=e.dot(pe),h=s.dot(pe),c=i.dot(pe);if(Math.max(-Math.max(a,h,c),Math.min(a,h,c))>o)return!1}return!0}const fe=new te,ge=new Qt,ye=new Qt;class be{constructor(t=new Qt,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const s=this.center;void 0!==e?s.copy(e):fe.setFromPoints(t).getCenter(s);let i=0;for(let e=0,n=t.length;e<n;e++)i=Math.max(i,s.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const s=this.center.distanceToSquared(t);return e.copy(t),s>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;ge.subVectors(t,this.center);const e=ge.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),s=.5*(t-this.radius);this.center.addScaledVector(ge,s/t),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(ye.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(ge.copy(t.center).add(ye)),this.expandByPoint(ge.copy(t.center).sub(ye))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const xe=new Qt,_e=new Qt,we=new Qt,Se=new Qt,ve=new Qt,Me=new Qt,Ie=new Qt;class Ae{constructor(t=new Qt,e=new Qt(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,xe)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const s=e.dot(this.direction);return s<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=xe.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(xe.copy(this.origin).addScaledVector(this.direction,e),xe.distanceToSquared(t))}distanceSqToSegment(t,e,s,i){_e.copy(t).add(e).multiplyScalar(.5),we.copy(e).sub(t).normalize(),Se.copy(this.origin).sub(_e);const n=.5*t.distanceTo(e),r=-this.direction.dot(we),o=Se.dot(this.direction),a=-Se.dot(we),h=Se.lengthSq(),c=Math.abs(1-r*r);let l,u,d,p;if(c>0)if(l=r*a-o,u=r*o-a,p=n*c,l>=0)if(u>=-p)if(u<=p){const t=1/c;l*=t,u*=t,d=l*(l+r*u+2*o)+u*(r*l+u+2*a)+h}else u=n,l=Math.max(0,-(r*u+o)),d=-l*l+u*(u+2*a)+h;else u=-n,l=Math.max(0,-(r*u+o)),d=-l*l+u*(u+2*a)+h;else u<=-p?(l=Math.max(0,-(-r*n+o)),u=l>0?-n:Math.min(Math.max(-n,-a),n),d=-l*l+u*(u+2*a)+h):u<=p?(l=0,u=Math.min(Math.max(-n,-a),n),d=u*(u+2*a)+h):(l=Math.max(0,-(r*n+o)),u=l>0?n:Math.min(Math.max(-n,-a),n),d=-l*l+u*(u+2*a)+h);else u=r>0?-n:n,l=Math.max(0,-(r*u+o)),d=-l*l+u*(u+2*a)+h;return s&&s.copy(this.origin).addScaledVector(this.direction,l),i&&i.copy(_e).addScaledVector(we,u),d}intersectSphere(t,e){xe.subVectors(t.center,this.origin);const s=xe.dot(this.direction),i=xe.dot(xe)-s*s,n=t.radius*t.radius;if(i>n)return null;const r=Math.sqrt(n-i),o=s-r,a=s+r;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const s=-(this.origin.dot(t.normal)+t.constant)/e;return s>=0?s:null}intersectPlane(t,e){const s=this.distanceToPlane(t);return null===s?null:this.at(s,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let s,i,n,r,o,a;const h=1/this.direction.x,c=1/this.direction.y,l=1/this.direction.z,u=this.origin;return h>=0?(s=(t.min.x-u.x)*h,i=(t.max.x-u.x)*h):(s=(t.max.x-u.x)*h,i=(t.min.x-u.x)*h),c>=0?(n=(t.min.y-u.y)*c,r=(t.max.y-u.y)*c):(n=(t.max.y-u.y)*c,r=(t.min.y-u.y)*c),s>r||n>i?null:((n>s||isNaN(s))&&(s=n),(r<i||isNaN(i))&&(i=r),l>=0?(o=(t.min.z-u.z)*l,a=(t.max.z-u.z)*l):(o=(t.max.z-u.z)*l,a=(t.min.z-u.z)*l),s>a||o>i?null:((o>s||s!=s)&&(s=o),(a<i||i!=i)&&(i=a),i<0?null:this.at(s>=0?s:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,xe)}intersectTriangle(t,e,s,i,n){ve.subVectors(e,t),Me.subVectors(s,t),Ie.crossVectors(ve,Me);let r,o=this.direction.dot(Ie);if(o>0){if(i)return null;r=1}else{if(!(o<0))return null;r=-1,o=-o}Se.subVectors(this.origin,t);const a=r*this.direction.dot(Me.crossVectors(Se,Me));if(a<0)return null;const h=r*this.direction.dot(ve.cross(Se));if(h<0)return null;if(a+h>o)return null;const c=-r*Se.dot(Ie);return c<0?null:this.at(c/o,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Be{constructor(t,e,s,i,n,r,o,a,h,c,l,u,d,p,m,f){Be.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,s,i,n,r,o,a,h,c,l,u,d,p,m,f)}set(t,e,s,i,n,r,o,a,h,c,l,u,d,p,m,f){const g=this.elements;return g[0]=t,g[4]=e,g[8]=s,g[12]=i,g[1]=n,g[5]=r,g[9]=o,g[13]=a,g[2]=h,g[6]=c,g[10]=l,g[14]=u,g[3]=d,g[7]=p,g[11]=m,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Be).fromArray(this.elements)}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}copyPosition(t){const e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,s=t.elements,i=1/Te.setFromMatrixColumn(t,0).length(),n=1/Te.setFromMatrixColumn(t,1).length(),r=1/Te.setFromMatrixColumn(t,2).length();return e[0]=s[0]*i,e[1]=s[1]*i,e[2]=s[2]*i,e[3]=0,e[4]=s[4]*n,e[5]=s[5]*n,e[6]=s[6]*n,e[7]=0,e[8]=s[8]*r,e[9]=s[9]*r,e[10]=s[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,s=t.x,i=t.y,n=t.z,r=Math.cos(s),o=Math.sin(s),a=Math.cos(i),h=Math.sin(i),c=Math.cos(n),l=Math.sin(n);if("XYZ"===t.order){const t=r*c,s=r*l,i=o*c,n=o*l;e[0]=a*c,e[4]=-a*l,e[8]=h,e[1]=s+i*h,e[5]=t-n*h,e[9]=-o*a,e[2]=n-t*h,e[6]=i+s*h,e[10]=r*a}else if("YXZ"===t.order){const t=a*c,s=a*l,i=h*c,n=h*l;e[0]=t+n*o,e[4]=i*o-s,e[8]=r*h,e[1]=r*l,e[5]=r*c,e[9]=-o,e[2]=s*o-i,e[6]=n+t*o,e[10]=r*a}else if("ZXY"===t.order){const t=a*c,s=a*l,i=h*c,n=h*l;e[0]=t-n*o,e[4]=-r*l,e[8]=i+s*o,e[1]=s+i*o,e[5]=r*c,e[9]=n-t*o,e[2]=-r*h,e[6]=o,e[10]=r*a}else if("ZYX"===t.order){const t=r*c,s=r*l,i=o*c,n=o*l;e[0]=a*c,e[4]=i*h-s,e[8]=t*h+n,e[1]=a*l,e[5]=n*h+t,e[9]=s*h-i,e[2]=-h,e[6]=o*a,e[10]=r*a}else if("YZX"===t.order){const t=r*a,s=r*h,i=o*a,n=o*h;e[0]=a*c,e[4]=n-t*l,e[8]=i*l+s,e[1]=l,e[5]=r*c,e[9]=-o*c,e[2]=-h*c,e[6]=s*l+i,e[10]=t-n*l}else if("XZY"===t.order){const t=r*a,s=r*h,i=o*a,n=o*h;e[0]=a*c,e[4]=-l,e[8]=h*c,e[1]=t*l+n,e[5]=r*c,e[9]=s*l-i,e[2]=i*l-s,e[6]=o*c,e[10]=n*l+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ce,t,Le)}lookAt(t,e,s){const i=this.elements;return Oe.subVectors(t,e),0===Oe.lengthSq()&&(Oe.z=1),Oe.normalize(),Pe.crossVectors(s,Oe),0===Pe.lengthSq()&&(1===Math.abs(s.z)?Oe.x+=1e-4:Oe.z+=1e-4,Oe.normalize(),Pe.crossVectors(s,Oe)),Pe.normalize(),Fe.crossVectors(Oe,Pe),i[0]=Pe.x,i[4]=Fe.x,i[8]=Oe.x,i[1]=Pe.y,i[5]=Fe.y,i[9]=Oe.y,i[2]=Pe.z,i[6]=Fe.z,i[10]=Oe.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,r=s[0],o=s[4],a=s[8],h=s[12],c=s[1],l=s[5],u=s[9],d=s[13],p=s[2],m=s[6],f=s[10],g=s[14],y=s[3],b=s[7],x=s[11],_=s[15],w=i[0],S=i[4],v=i[8],M=i[12],I=i[1],A=i[5],B=i[9],T=i[13],z=i[2],C=i[6],L=i[10],P=i[14],F=i[3],O=i[7],E=i[11],k=i[15];return n[0]=r*w+o*I+a*z+h*F,n[4]=r*S+o*A+a*C+h*O,n[8]=r*v+o*B+a*L+h*E,n[12]=r*M+o*T+a*P+h*k,n[1]=c*w+l*I+u*z+d*F,n[5]=c*S+l*A+u*C+d*O,n[9]=c*v+l*B+u*L+d*E,n[13]=c*M+l*T+u*P+d*k,n[2]=p*w+m*I+f*z+g*F,n[6]=p*S+m*A+f*C+g*O,n[10]=p*v+m*B+f*L+g*E,n[14]=p*M+m*T+f*P+g*k,n[3]=y*w+b*I+x*z+_*F,n[7]=y*S+b*A+x*C+_*O,n[11]=y*v+b*B+x*L+_*E,n[15]=y*M+b*T+x*P+_*k,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[4],i=t[8],n=t[12],r=t[1],o=t[5],a=t[9],h=t[13],c=t[2],l=t[6],u=t[10],d=t[14];return t[3]*(+n*a*l-i*h*l-n*o*u+s*h*u+i*o*d-s*a*d)+t[7]*(+e*a*d-e*h*u+n*r*u-i*r*d+i*h*c-n*a*c)+t[11]*(+e*h*l-e*o*d-n*r*l+s*r*d+n*o*c-s*h*c)+t[15]*(-i*o*c-e*a*l+e*o*u+i*r*l-s*r*u+s*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,s){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=s),this}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],o=t[5],a=t[6],h=t[7],c=t[8],l=t[9],u=t[10],d=t[11],p=t[12],m=t[13],f=t[14],g=t[15],y=l*f*h-m*u*h+m*a*d-o*f*d-l*a*g+o*u*g,b=p*u*h-c*f*h-p*a*d+r*f*d+c*a*g-r*u*g,x=c*m*h-p*l*h+p*o*d-r*m*d-c*o*g+r*l*g,_=p*l*a-c*m*a-p*o*u+r*m*u+c*o*f-r*l*f,w=e*y+s*b+i*x+n*_;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/w;return t[0]=y*S,t[1]=(m*u*n-l*f*n-m*i*d+s*f*d+l*i*g-s*u*g)*S,t[2]=(o*f*n-m*a*n+m*i*h-s*f*h-o*i*g+s*a*g)*S,t[3]=(l*a*n-o*u*n-l*i*h+s*u*h+o*i*d-s*a*d)*S,t[4]=b*S,t[5]=(c*f*n-p*u*n+p*i*d-e*f*d-c*i*g+e*u*g)*S,t[6]=(p*a*n-r*f*n-p*i*h+e*f*h+r*i*g-e*a*g)*S,t[7]=(r*u*n-c*a*n+c*i*h-e*u*h-r*i*d+e*a*d)*S,t[8]=x*S,t[9]=(p*l*n-c*m*n-p*s*d+e*m*d+c*s*g-e*l*g)*S,t[10]=(r*m*n-p*o*n+p*s*h-e*m*h-r*s*g+e*o*g)*S,t[11]=(c*o*n-r*l*n-c*s*h+e*l*h+r*s*d-e*o*d)*S,t[12]=_*S,t[13]=(c*m*i-p*l*i+p*s*u-e*m*u-c*s*f+e*l*f)*S,t[14]=(p*o*i-r*m*i-p*s*a+e*m*a+r*s*f-e*o*f)*S,t[15]=(r*l*i-c*o*i+c*s*a-e*l*a-r*s*u+e*o*u)*S,this}scale(t){const e=this.elements,s=t.x,i=t.y,n=t.z;return e[0]*=s,e[4]*=i,e[8]*=n,e[1]*=s,e[5]*=i,e[9]*=n,e[2]*=s,e[6]*=i,e[10]*=n,e[3]*=s,e[7]*=i,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,i))}makeTranslation(t,e,s){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const s=Math.cos(e),i=Math.sin(e),n=1-s,r=t.x,o=t.y,a=t.z,h=n*r,c=n*o;return this.set(h*r+s,h*o-i*a,h*a+i*o,0,h*o+i*a,c*o+s,c*a-i*r,0,h*a-i*o,c*a+i*r,n*a*a+s,0,0,0,0,1),this}makeScale(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this}makeShear(t,e,s,i,n,r){return this.set(1,s,n,0,t,1,r,0,e,i,1,0,0,0,0,1),this}compose(t,e,s){const i=this.elements,n=e._x,r=e._y,o=e._z,a=e._w,h=n+n,c=r+r,l=o+o,u=n*h,d=n*c,p=n*l,m=r*c,f=r*l,g=o*l,y=a*h,b=a*c,x=a*l,_=s.x,w=s.y,S=s.z;return i[0]=(1-(m+g))*_,i[1]=(d+x)*_,i[2]=(p-b)*_,i[3]=0,i[4]=(d-x)*w,i[5]=(1-(u+g))*w,i[6]=(f+y)*w,i[7]=0,i[8]=(p+b)*S,i[9]=(f-y)*S,i[10]=(1-(u+m))*S,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,s){const i=this.elements;let n=Te.set(i[0],i[1],i[2]).length();const r=Te.set(i[4],i[5],i[6]).length(),o=Te.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),t.x=i[12],t.y=i[13],t.z=i[14],ze.copy(this);const a=1/n,h=1/r,c=1/o;return ze.elements[0]*=a,ze.elements[1]*=a,ze.elements[2]*=a,ze.elements[4]*=h,ze.elements[5]*=h,ze.elements[6]*=h,ze.elements[8]*=c,ze.elements[9]*=c,ze.elements[10]*=c,e.setFromRotationMatrix(ze),s.x=n,s.y=r,s.z=o,this}makePerspective(t,e,s,i,n,r,o=2e3){const a=this.elements,h=2*n/(e-t),c=2*n/(s-i),l=(e+t)/(e-t),u=(s+i)/(s-i);let d,p;if(o===_t)d=-(r+n)/(r-n),p=-2*r*n/(r-n);else{if(o!==wt)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-r/(r-n),p=-r*n/(r-n)}return a[0]=h,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=c,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,s,i,n,r,o=2e3){const a=this.elements,h=1/(e-t),c=1/(s-i),l=1/(r-n),u=(e+t)*h,d=(s+i)*c;let p,m;if(o===_t)p=(r+n)*l,m=-2*l;else{if(o!==wt)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=n*l,m=-1*l}return a[0]=2*h,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=m,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,s=t.elements;for(let t=0;t<16;t++)if(e[t]!==s[t])return!1;return!0}fromArray(t,e=0){for(let s=0;s<16;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t}}const Te=new Qt,ze=new Be,Ce=new Qt(0,0,0),Le=new Qt(1,1,1),Pe=new Qt,Fe=new Qt,Oe=new Qt,Ee=new Be,ke=new Jt;class Ve{constructor(t=0,e=0,s=0,i=Ve.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=s,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,s,i=this._order){return this._x=t,this._y=e,this._z=s,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,s=!0){const i=t.elements,n=i[0],r=i[4],o=i[8],a=i[1],h=i[5],c=i[9],l=i[2],u=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(At(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-r,n)):(this._x=Math.atan2(u,h),this._z=0);break;case"YXZ":this._x=Math.asin(-At(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,h)):(this._y=Math.atan2(-l,n),this._z=0);break;case"ZXY":this._x=Math.asin(At(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-l,d),this._z=Math.atan2(-r,h)):(this._y=0,this._z=Math.atan2(a,n));break;case"ZYX":this._y=Math.asin(-At(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,n)):(this._x=0,this._z=Math.atan2(-r,h));break;case"YZX":this._z=Math.asin(At(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,h),this._y=Math.atan2(-l,n)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-At(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(u,h),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===s&&this._onChangeCallback(),this}setFromQuaternion(t,e,s){return Ee.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ee,e,s)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return ke.setFromEuler(this),this.setFromQuaternion(ke,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ve.DEFAULT_ORDER="XYZ";class Re{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let Ue=0;const De=new Qt,Ne=new Jt,Ge=new Be,qe=new Qt,We=new Qt,He=new Qt,je=new Jt,Ze=new Qt(1,0,0),Ye=new Qt(0,1,0),Xe=new Qt(0,0,1),Je={type:"added"},Qe={type:"removed"},$e={type:"childadded",child:null},Ke={type:"childremoved",child:null};class ts extends St{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ue++}),this.uuid=It(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ts.DEFAULT_UP.clone();const t=new Qt,e=new Ve,s=new Jt,i=new Qt(1,1,1);e._onChange((function(){s.setFromEuler(e,!1)})),s._onChange((function(){e.setFromQuaternion(s,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Be},normalMatrix:{value:new Ft}}),this.matrix=new Be,this.matrixWorld=new Be,this.matrixAutoUpdate=ts.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ts.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Re,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Ne.setFromAxisAngle(t,e),this.quaternion.multiply(Ne),this}rotateOnWorldAxis(t,e){return Ne.setFromAxisAngle(t,e),this.quaternion.premultiply(Ne),this}rotateX(t){return this.rotateOnAxis(Ze,t)}rotateY(t){return this.rotateOnAxis(Ye,t)}rotateZ(t){return this.rotateOnAxis(Xe,t)}translateOnAxis(t,e){return De.copy(t).applyQuaternion(this.quaternion),this.position.add(De.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Ze,t)}translateY(t){return this.translateOnAxis(Ye,t)}translateZ(t){return this.translateOnAxis(Xe,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Ge.copy(this.matrixWorld).invert())}lookAt(t,e,s){t.isVector3?qe.copy(t):qe.set(t,e,s);const i=this.parent;this.updateWorldMatrix(!0,!1),We.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ge.lookAt(We,qe,this.up):Ge.lookAt(qe,We,this.up),this.quaternion.setFromRotationMatrix(Ge),i&&(Ge.extractRotation(i.matrixWorld),Ne.setFromRotationMatrix(Ge),this.quaternion.premultiply(Ne.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Je),$e.child=t,this.dispatchEvent($e),$e.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Qe),Ke.child=t,this.dispatchEvent(Ke),Ke.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Ge.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Ge.multiply(t.parent.matrixWorld)),t.applyMatrix4(Ge),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Je),$e.child=t,this.dispatchEvent($e),$e.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let s=0,i=this.children.length;s<i;s++){const i=this.children[s].getObjectByProperty(t,e);if(void 0!==i)return i}}getObjectsByProperty(t,e,s=[]){this[t]===e&&s.push(this);const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].getObjectsByProperty(t,e,s);return s}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(We,t,He),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(We,je,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let s=0,i=e.length;s<i;s++){e[s].updateMatrixWorld(t)}}updateWorldMatrix(t,e){const s=this.parent;if(!0===t&&null!==s&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,s=t.length;e<s;e++){t[e].updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,s={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function n(e,s){return void 0===e[s.uuid]&&(e[s.uuid]=s.toJSON(t)),s.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const s=e.shapes;if(Array.isArray(s))for(let e=0,i=s.length;e<i;e++){const i=s[e];n(t.shapes,i)}else n(t.shapes,s)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let s=0,i=this.material.length;s<i;s++)e.push(n(t.materials,this.material[s]));i.material=e}else i.material=n(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const s=this.animations[e];i.animations.push(n(t.animations,s))}}if(e){const e=r(t.geometries),i=r(t.materials),n=r(t.textures),o=r(t.images),a=r(t.shapes),h=r(t.skeletons),c=r(t.animations),l=r(t.nodes);e.length>0&&(s.geometries=e),i.length>0&&(s.materials=i),n.length>0&&(s.textures=n),o.length>0&&(s.images=o),a.length>0&&(s.shapes=a),h.length>0&&(s.skeletons=h),c.length>0&&(s.animations=c),l.length>0&&(s.nodes=l)}return s.object=i,s;function r(t){const e=[];for(const s in t){const i=t[s];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const s=t.children[e];this.add(s.clone())}return this}}ts.DEFAULT_UP=new Qt(0,1,0),ts.DEFAULT_MATRIX_AUTO_UPDATE=!0,ts.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const es=new Qt,ss=new Qt,is=new Qt,ns=new Qt,rs=new Qt,os=new Qt,as=new Qt,hs=new Qt,cs=new Qt,ls=new Qt,us=new Xt,ds=new Xt,ps=new Xt;class ms{constructor(t=new Qt,e=new Qt,s=new Qt){this.a=t,this.b=e,this.c=s}static getNormal(t,e,s,i){i.subVectors(s,e),es.subVectors(t,e),i.cross(es);const n=i.lengthSq();return n>0?i.multiplyScalar(1/Math.sqrt(n)):i.set(0,0,0)}static getBarycoord(t,e,s,i,n){es.subVectors(i,e),ss.subVectors(s,e),is.subVectors(t,e);const r=es.dot(es),o=es.dot(ss),a=es.dot(is),h=ss.dot(ss),c=ss.dot(is),l=r*h-o*o;if(0===l)return n.set(0,0,0),null;const u=1/l,d=(h*a-o*c)*u,p=(r*c-o*a)*u;return n.set(1-d-p,p,d)}static containsPoint(t,e,s,i){return null!==this.getBarycoord(t,e,s,i,ns)&&(ns.x>=0&&ns.y>=0&&ns.x+ns.y<=1)}static getInterpolation(t,e,s,i,n,r,o,a){return null===this.getBarycoord(t,e,s,i,ns)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(n,ns.x),a.addScaledVector(r,ns.y),a.addScaledVector(o,ns.z),a)}static getInterpolatedAttribute(t,e,s,i,n,r){return us.setScalar(0),ds.setScalar(0),ps.setScalar(0),us.fromBufferAttribute(t,e),ds.fromBufferAttribute(t,s),ps.fromBufferAttribute(t,i),r.setScalar(0),r.addScaledVector(us,n.x),r.addScaledVector(ds,n.y),r.addScaledVector(ps,n.z),r}static isFrontFacing(t,e,s,i){return es.subVectors(s,e),ss.subVectors(t,e),es.cross(ss).dot(i)<0}set(t,e,s){return this.a.copy(t),this.b.copy(e),this.c.copy(s),this}setFromPointsAndIndices(t,e,s,i){return this.a.copy(t[e]),this.b.copy(t[s]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,s,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,s),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return es.subVectors(this.c,this.b),ss.subVectors(this.a,this.b),.5*es.cross(ss).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ms.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ms.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,s,i,n){return ms.getInterpolation(t,this.a,this.b,this.c,e,s,i,n)}containsPoint(t){return ms.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ms.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const s=this.a,i=this.b,n=this.c;let r,o;rs.subVectors(i,s),os.subVectors(n,s),hs.subVectors(t,s);const a=rs.dot(hs),h=os.dot(hs);if(a<=0&&h<=0)return e.copy(s);cs.subVectors(t,i);const c=rs.dot(cs),l=os.dot(cs);if(c>=0&&l<=c)return e.copy(i);const u=a*l-c*h;if(u<=0&&a>=0&&c<=0)return r=a/(a-c),e.copy(s).addScaledVector(rs,r);ls.subVectors(t,n);const d=rs.dot(ls),p=os.dot(ls);if(p>=0&&d<=p)return e.copy(n);const m=d*h-a*p;if(m<=0&&h>=0&&p<=0)return o=h/(h-p),e.copy(s).addScaledVector(os,o);const f=c*p-d*l;if(f<=0&&l-c>=0&&d-p>=0)return as.subVectors(n,i),o=(l-c)/(l-c+(d-p)),e.copy(i).addScaledVector(as,o);const g=1/(f+m+u);return r=m*g,o=u*g,e.copy(s).addScaledVector(rs,r).addScaledVector(os,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const fs={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},gs={h:0,s:0,l:0},ys={h:0,s:0,l:0};function bs(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+6*(e-t)*(2/3-s):t}class xs{constructor(t,e,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,s)}set(t,e,s){if(void 0===e&&void 0===s){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,s);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=ft){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Ut.toWorkingColorSpace(this,e),this}setRGB(t,e,s,i=Ut.workingColorSpace){return this.r=t,this.g=e,this.b=s,Ut.toWorkingColorSpace(this,i),this}setHSL(t,e,s,i=Ut.workingColorSpace){if(t=Bt(t,1),e=At(e,0,1),s=At(s,0,1),0===e)this.r=this.g=this.b=s;else{const i=s<=.5?s*(1+e):s+e-s*e,n=2*s-i;this.r=bs(n,i,t+1/3),this.g=bs(n,i,t),this.b=bs(n,i,t-1/3)}return Ut.toWorkingColorSpace(this,i),this}setStyle(t,e=ft){function s(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let n;const r=i[1],o=i[2];switch(r){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return s(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,e);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return s(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,e);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return s(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],n=s.length;if(3===n)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(6===n)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=ft){const s=fs[t.toLowerCase()];return void 0!==s?this.setHex(s,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Dt(t.r),this.g=Dt(t.g),this.b=Dt(t.b),this}copyLinearToSRGB(t){return this.r=Nt(t.r),this.g=Nt(t.g),this.b=Nt(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=ft){return Ut.fromWorkingColorSpace(_s.copy(this),t),65536*Math.round(At(255*_s.r,0,255))+256*Math.round(At(255*_s.g,0,255))+Math.round(At(255*_s.b,0,255))}getHexString(t=ft){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Ut.workingColorSpace){Ut.fromWorkingColorSpace(_s.copy(this),e);const s=_s.r,i=_s.g,n=_s.b,r=Math.max(s,i,n),o=Math.min(s,i,n);let a,h;const c=(o+r)/2;if(o===r)a=0,h=0;else{const t=r-o;switch(h=c<=.5?t/(r+o):t/(2-r-o),r){case s:a=(i-n)/t+(i<n?6:0);break;case i:a=(n-s)/t+2;break;case n:a=(s-i)/t+4}a/=6}return t.h=a,t.s=h,t.l=c,t}getRGB(t,e=Ut.workingColorSpace){return Ut.fromWorkingColorSpace(_s.copy(this),e),t.r=_s.r,t.g=_s.g,t.b=_s.b,t}getStyle(t=ft){Ut.fromWorkingColorSpace(_s.copy(this),t);const e=_s.r,s=_s.g,i=_s.b;return t!==ft?`color(${t} ${e.toFixed(3)} ${s.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*s)},${Math.round(255*i)})`}offsetHSL(t,e,s){return this.getHSL(gs),this.setHSL(gs.h+t,gs.s+e,gs.l+s)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,s){return this.r=t.r+(e.r-t.r)*s,this.g=t.g+(e.g-t.g)*s,this.b=t.b+(e.b-t.b)*s,this}lerpHSL(t,e){this.getHSL(gs),t.getHSL(ys);const s=Tt(gs.h,ys.h,e),i=Tt(gs.s,ys.s,e),n=Tt(gs.l,ys.l,e);return this.setHSL(s,i,n),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,s=this.g,i=this.b,n=t.elements;return this.r=n[0]*e+n[3]*s+n[6]*i,this.g=n[1]*e+n[4]*s+n[7]*i,this.b=n[2]*e+n[5]*s+n[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _s=new xs;xs.NAMES=fs;let ws=0,Ss=class extends St{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ws++}),this.uuid=It(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new xs(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=xt,this.stencilZFail=xt,this.stencilZPass=xt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const s=t[e];if(void 0===s){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(s):i&&i.isVector3&&s&&s.isVector3?i.copy(s):this[e]=s:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const s={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const s in t){const i=t[s];delete i.metadata,e.push(i)}return e}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),void 0!==this.roughness&&(s.roughness=this.roughness),void 0!==this.metalness&&(s.metalness=this.metalness),void 0!==this.sheen&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(s.shininess=this.shininess),void 0!==this.clearcoat&&(s.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(s.dispersion=this.dispersion),void 0!==this.iridescence&&(s.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(s.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(s.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(s.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(s.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(t).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(t).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(t).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(t).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(t).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(s.combine=this.combine)),void 0!==this.envMapRotation&&(s.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(s.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(s.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(s.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(s.size=this.size),null!==this.shadowSide&&(s.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(s.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(s.blending=this.blending),0!==this.side&&(s.side=this.side),!0===this.vertexColors&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),!0===this.transparent&&(s.transparent=!0),204!==this.blendSrc&&(s.blendSrc=this.blendSrc),205!==this.blendDst&&(s.blendDst=this.blendDst),100!==this.blendEquation&&(s.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(s.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(s.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(s.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(s.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(s.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(s.depthFunc=this.depthFunc),!1===this.depthTest&&(s.depthTest=this.depthTest),!1===this.depthWrite&&(s.depthWrite=this.depthWrite),!1===this.colorWrite&&(s.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(s.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(s.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(s.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(s.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==xt&&(s.stencilFail=this.stencilFail),this.stencilZFail!==xt&&(s.stencilZFail=this.stencilZFail),this.stencilZPass!==xt&&(s.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(s.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(s.rotation=this.rotation),!0===this.polygonOffset&&(s.polygonOffset=!0),0!==this.polygonOffsetFactor&&(s.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(s.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(s.linewidth=this.linewidth),void 0!==this.dashSize&&(s.dashSize=this.dashSize),void 0!==this.gapSize&&(s.gapSize=this.gapSize),void 0!==this.scale&&(s.scale=this.scale),!0===this.dithering&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),!0===this.alphaHash&&(s.alphaHash=!0),!0===this.alphaToCoverage&&(s.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(s.premultipliedAlpha=!0),!0===this.forceSinglePass&&(s.forceSinglePass=!0),!0===this.wireframe&&(s.wireframe=!0),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(s.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(s.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(s.flatShading=!0),!1===this.visible&&(s.visible=!1),!1===this.toneMapped&&(s.toneMapped=!1),!1===this.fog&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData),e){const e=i(t.textures),n=i(t.images);e.length>0&&(s.textures=e),n.length>0&&(s.images=n)}return s}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let s=null;if(null!==e){const t=e.length;s=new Array(t);for(let i=0;i!==t;++i)s[i]=e[i].clone()}return this.clippingPlanes=s,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}};class vs extends Ss{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new xs(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ve,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Ms=new Qt,Is=new Pt;class As{constructor(t,e,s=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=s,this.usage=35044,this.updateRanges=[],this.gpuType=pt,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,s){t*=this.itemSize,s*=e.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[t+i]=e.array[s+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,s=this.count;e<s;e++)Is.fromBufferAttribute(this,e),Is.applyMatrix3(t),this.setXY(e,Is.x,Is.y);else if(3===this.itemSize)for(let e=0,s=this.count;e<s;e++)Ms.fromBufferAttribute(this,e),Ms.applyMatrix3(t),this.setXYZ(e,Ms.x,Ms.y,Ms.z);return this}applyMatrix4(t){for(let e=0,s=this.count;e<s;e++)Ms.fromBufferAttribute(this,e),Ms.applyMatrix4(t),this.setXYZ(e,Ms.x,Ms.y,Ms.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)Ms.fromBufferAttribute(this,e),Ms.applyNormalMatrix(t),this.setXYZ(e,Ms.x,Ms.y,Ms.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)Ms.fromBufferAttribute(this,e),Ms.transformDirection(t),this.setXYZ(e,Ms.x,Ms.y,Ms.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let s=this.array[t*this.itemSize+e];return this.normalized&&(s=zt(s,this.array)),s}setComponent(t,e,s){return this.normalized&&(s=Ct(s,this.array)),this.array[t*this.itemSize+e]=s,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=zt(e,this.array)),e}setX(t,e){return this.normalized&&(e=Ct(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=zt(e,this.array)),e}setY(t,e){return this.normalized&&(e=Ct(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=zt(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Ct(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=zt(e,this.array)),e}setW(t,e){return this.normalized&&(e=Ct(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,s){return t*=this.itemSize,this.normalized&&(e=Ct(e,this.array),s=Ct(s,this.array)),this.array[t+0]=e,this.array[t+1]=s,this}setXYZ(t,e,s,i){return t*=this.itemSize,this.normalized&&(e=Ct(e,this.array),s=Ct(s,this.array),i=Ct(i,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this}setXYZW(t,e,s,i,n){return t*=this.itemSize,this.normalized&&(e=Ct(e,this.array),s=Ct(s,this.array),i=Ct(i,this.array),n=Ct(n,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),35044!==this.usage&&(t.usage=this.usage),t}}class Bs extends As{constructor(t,e,s){super(new Uint16Array(t),e,s)}}class Ts extends As{constructor(t,e,s){super(new Uint32Array(t),e,s)}}class zs extends As{constructor(t,e,s){super(new Float32Array(t),e,s)}}let Cs=0;const Ls=new Be,Ps=new ts,Fs=new Qt,Os=new te,Es=new te,ks=new Qt;class Vs extends St{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Cs++}),this.uuid=It(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(function(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}(t)?Ts:Bs)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,s=0){this.groups.push({start:t,count:e,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const s=this.attributes.normal;if(void 0!==s){const e=(new Ft).getNormalMatrix(t);s.applyNormalMatrix(e),s.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Ls.makeRotationFromQuaternion(t),this.applyMatrix4(Ls),this}rotateX(t){return Ls.makeRotationX(t),this.applyMatrix4(Ls),this}rotateY(t){return Ls.makeRotationY(t),this.applyMatrix4(Ls),this}rotateZ(t){return Ls.makeRotationZ(t),this.applyMatrix4(Ls),this}translate(t,e,s){return Ls.makeTranslation(t,e,s),this.applyMatrix4(Ls),this}scale(t,e,s){return Ls.makeScale(t,e,s),this.applyMatrix4(Ls),this}lookAt(t){return Ps.lookAt(t),Ps.updateMatrix(),this.applyMatrix4(Ps.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Fs).negate(),this.translate(Fs.x,Fs.y,Fs.z),this}setFromPoints(t){const e=this.getAttribute("position");if(void 0===e){const e=[];for(let s=0,i=t.length;s<i;s++){const i=t[s];e.push(i.x,i.y,i.z||0)}this.setAttribute("position",new zs(e,3))}else{const s=Math.min(t.length,e.count);for(let i=0;i<s;i++){const s=t[i];e.setXYZ(i,s.x,s.y,s.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new te);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new Qt(-1/0,-1/0,-1/0),new Qt(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,s=e.length;t<s;t++){const s=e[t];Os.setFromBufferAttribute(s),this.morphTargetsRelative?(ks.addVectors(this.boundingBox.min,Os.min),this.boundingBox.expandByPoint(ks),ks.addVectors(this.boundingBox.max,Os.max),this.boundingBox.expandByPoint(ks)):(this.boundingBox.expandByPoint(Os.min),this.boundingBox.expandByPoint(Os.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new be);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Qt,1/0);if(t){const s=this.boundingSphere.center;if(Os.setFromBufferAttribute(t),e)for(let t=0,s=e.length;t<s;t++){const s=e[t];Es.setFromBufferAttribute(s),this.morphTargetsRelative?(ks.addVectors(Os.min,Es.min),Os.expandByPoint(ks),ks.addVectors(Os.max,Es.max),Os.expandByPoint(ks)):(Os.expandByPoint(Es.min),Os.expandByPoint(Es.max))}Os.getCenter(s);let i=0;for(let e=0,n=t.count;e<n;e++)ks.fromBufferAttribute(t,e),i=Math.max(i,s.distanceToSquared(ks));if(e)for(let n=0,r=e.length;n<r;n++){const r=e[n],o=this.morphTargetsRelative;for(let e=0,n=r.count;e<n;e++)ks.fromBufferAttribute(r,e),o&&(Fs.fromBufferAttribute(t,e),ks.add(Fs)),i=Math.max(i,s.distanceToSquared(ks))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const s=e.position,i=e.normal,n=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new As(new Float32Array(4*s.count),4));const r=this.getAttribute("tangent"),o=[],a=[];for(let t=0;t<s.count;t++)o[t]=new Qt,a[t]=new Qt;const h=new Qt,c=new Qt,l=new Qt,u=new Pt,d=new Pt,p=new Pt,m=new Qt,f=new Qt;function g(t,e,i){h.fromBufferAttribute(s,t),c.fromBufferAttribute(s,e),l.fromBufferAttribute(s,i),u.fromBufferAttribute(n,t),d.fromBufferAttribute(n,e),p.fromBufferAttribute(n,i),c.sub(h),l.sub(h),d.sub(u),p.sub(u);const r=1/(d.x*p.y-p.x*d.y);isFinite(r)&&(m.copy(c).multiplyScalar(p.y).addScaledVector(l,-d.y).multiplyScalar(r),f.copy(l).multiplyScalar(d.x).addScaledVector(c,-p.x).multiplyScalar(r),o[t].add(m),o[e].add(m),o[i].add(m),a[t].add(f),a[e].add(f),a[i].add(f))}let y=this.groups;0===y.length&&(y=[{start:0,count:t.count}]);for(let e=0,s=y.length;e<s;++e){const s=y[e],i=s.start;for(let e=i,n=i+s.count;e<n;e+=3)g(t.getX(e+0),t.getX(e+1),t.getX(e+2))}const b=new Qt,x=new Qt,_=new Qt,w=new Qt;function S(t){_.fromBufferAttribute(i,t),w.copy(_);const e=o[t];b.copy(e),b.sub(_.multiplyScalar(_.dot(e))).normalize(),x.crossVectors(w,e);const s=x.dot(a[t])<0?-1:1;r.setXYZW(t,b.x,b.y,b.z,s)}for(let e=0,s=y.length;e<s;++e){const s=y[e],i=s.start;for(let e=i,n=i+s.count;e<n;e+=3)S(t.getX(e+0)),S(t.getX(e+1)),S(t.getX(e+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let s=this.getAttribute("normal");if(void 0===s)s=new As(new Float32Array(3*e.count),3),this.setAttribute("normal",s);else for(let t=0,e=s.count;t<e;t++)s.setXYZ(t,0,0,0);const i=new Qt,n=new Qt,r=new Qt,o=new Qt,a=new Qt,h=new Qt,c=new Qt,l=new Qt;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),m=t.getX(u+2);i.fromBufferAttribute(e,d),n.fromBufferAttribute(e,p),r.fromBufferAttribute(e,m),c.subVectors(r,n),l.subVectors(i,n),c.cross(l),o.fromBufferAttribute(s,d),a.fromBufferAttribute(s,p),h.fromBufferAttribute(s,m),o.add(c),a.add(c),h.add(c),s.setXYZ(d,o.x,o.y,o.z),s.setXYZ(p,a.x,a.y,a.z),s.setXYZ(m,h.x,h.y,h.z)}else for(let t=0,o=e.count;t<o;t+=3)i.fromBufferAttribute(e,t+0),n.fromBufferAttribute(e,t+1),r.fromBufferAttribute(e,t+2),c.subVectors(r,n),l.subVectors(i,n),c.cross(l),s.setXYZ(t+0,c.x,c.y,c.z),s.setXYZ(t+1,c.x,c.y,c.z),s.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,s=t.count;e<s;e++)ks.fromBufferAttribute(t,e),ks.normalize(),t.setXYZ(e,ks.x,ks.y,ks.z)}toNonIndexed(){function t(t,e){const s=t.array,i=t.itemSize,n=t.normalized,r=new s.constructor(e.length*i);let o=0,a=0;for(let n=0,h=e.length;n<h;n++){o=t.isInterleavedBufferAttribute?e[n]*t.data.stride+t.offset:e[n]*i;for(let t=0;t<i;t++)r[a++]=s[o++]}return new As(r,i,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Vs,s=this.index.array,i=this.attributes;for(const n in i){const r=t(i[n],s);e.setAttribute(n,r)}const n=this.morphAttributes;for(const i in n){const r=[],o=n[i];for(let e=0,i=o.length;e<i;e++){const i=t(o[e],s);r.push(i)}e.morphAttributes[i]=r}e.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let t=0,s=r.length;t<s;t++){const s=r[t];e.addGroup(s.start,s.count,s.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const s in e)void 0!==e[s]&&(t[s]=e[s]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const s=this.attributes;for(const e in s){const i=s[e];t.data.attributes[e]=i.toJSON(t.data)}const i={};let n=!1;for(const e in this.morphAttributes){const s=this.morphAttributes[e],r=[];for(let e=0,i=s.length;e<i;e++){const i=s[e];r.push(i.toJSON(t.data))}r.length>0&&(i[e]=r,n=!0)}n&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(t.data.groups=JSON.parse(JSON.stringify(r)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const s=t.index;null!==s&&this.setIndex(s.clone(e));const i=t.attributes;for(const t in i){const s=i[t];this.setAttribute(t,s.clone(e))}const n=t.morphAttributes;for(const t in n){const s=[],i=n[t];for(let t=0,n=i.length;t<n;t++)s.push(i[t].clone(e));this.morphAttributes[t]=s}this.morphTargetsRelative=t.morphTargetsRelative;const r=t.groups;for(let t=0,e=r.length;t<e;t++){const e=r[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Rs=new Be,Us=new Ae,Ds=new be,Ns=new Qt,Gs=new Qt,qs=new Qt,Ws=new Qt,Hs=new Qt,js=new Qt,Zs=new Qt,Ys=new Qt;class Xs extends ts{constructor(t=new Vs,e=new vs){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const s=t[e[0]];if(void 0!==s){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=s.length;t<e;t++){const e=s[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const s=this.geometry,i=s.attributes.position,n=s.morphAttributes.position,r=s.morphTargetsRelative;e.fromBufferAttribute(i,t);const o=this.morphTargetInfluences;if(n&&o){js.set(0,0,0);for(let s=0,i=n.length;s<i;s++){const i=o[s],a=n[s];0!==i&&(Hs.fromBufferAttribute(a,t),r?js.addScaledVector(Hs,i):js.addScaledVector(Hs.sub(e),i))}e.add(js)}return e}raycast(t,e){const s=this.geometry,i=this.material,n=this.matrixWorld;if(void 0!==i){if(null===s.boundingSphere&&s.computeBoundingSphere(),Ds.copy(s.boundingSphere),Ds.applyMatrix4(n),Us.copy(t.ray).recast(t.near),!1===Ds.containsPoint(Us.origin)){if(null===Us.intersectSphere(Ds,Ns))return;if(Us.origin.distanceToSquared(Ns)>(t.far-t.near)**2)return}Rs.copy(n).invert(),Us.copy(t.ray).applyMatrix4(Rs),null!==s.boundingBox&&!1===Us.intersectsBox(s.boundingBox)||this._computeIntersections(t,e,Us)}}_computeIntersections(t,e,s){let i;const n=this.geometry,r=this.material,o=n.index,a=n.attributes.position,h=n.attributes.uv,c=n.attributes.uv1,l=n.attributes.normal,u=n.groups,d=n.drawRange;if(null!==o)if(Array.isArray(r))for(let n=0,a=u.length;n<a;n++){const a=u[n],p=r[a.materialIndex];for(let n=Math.max(a.start,d.start),r=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));n<r;n+=3){i=Js(this,p,t,s,h,c,l,o.getX(n),o.getX(n+1),o.getX(n+2)),i&&(i.faceIndex=Math.floor(n/3),i.face.materialIndex=a.materialIndex,e.push(i))}}else{for(let n=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);n<a;n+=3){i=Js(this,r,t,s,h,c,l,o.getX(n),o.getX(n+1),o.getX(n+2)),i&&(i.faceIndex=Math.floor(n/3),e.push(i))}}else if(void 0!==a)if(Array.isArray(r))for(let n=0,o=u.length;n<o;n++){const o=u[n],p=r[o.materialIndex];for(let n=Math.max(o.start,d.start),r=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));n<r;n+=3){i=Js(this,p,t,s,h,c,l,n,n+1,n+2),i&&(i.faceIndex=Math.floor(n/3),i.face.materialIndex=o.materialIndex,e.push(i))}}else{for(let n=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);n<o;n+=3){i=Js(this,r,t,s,h,c,l,n,n+1,n+2),i&&(i.faceIndex=Math.floor(n/3),e.push(i))}}}}function Js(t,e,s,i,n,r,o,a,h,c){t.getVertexPosition(a,Gs),t.getVertexPosition(h,qs),t.getVertexPosition(c,Ws);const l=function(t,e,s,i,n,r,o,a){let h;if(h=1===e.side?i.intersectTriangle(o,r,n,!0,a):i.intersectTriangle(n,r,o,0===e.side,a),null===h)return null;Ys.copy(a),Ys.applyMatrix4(t.matrixWorld);const c=s.ray.origin.distanceTo(Ys);return c<s.near||c>s.far?null:{distance:c,point:Ys.clone(),object:t}}(t,e,s,i,Gs,qs,Ws,Zs);if(l){const t=new Qt;ms.getBarycoord(Zs,Gs,qs,Ws,t),n&&(l.uv=ms.getInterpolatedAttribute(n,a,h,c,t,new Pt)),r&&(l.uv1=ms.getInterpolatedAttribute(r,a,h,c,t,new Pt)),o&&(l.normal=ms.getInterpolatedAttribute(o,a,h,c,t,new Qt),l.normal.dot(i.direction)>0&&l.normal.multiplyScalar(-1));const e={a:a,b:h,c:c,normal:new Qt,materialIndex:0};ms.getNormal(Gs,qs,Ws,e.normal),l.face=e,l.barycoord=t}return l}class Qs extends Yt{constructor(t=null,e=1,s=1,i,n,r,o,a,h=1003,c=1003,l,u){super(null,r,o,a,h,c,i,n,l,u),this.isDataTexture=!0,this.image={data:t,width:e,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class $s extends As{constructor(t,e,s,i=1){super(t,e,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Ks=new Be,ti=new Be,ei=[],si=new te,ii=new Be,ni=new Xs,ri=new be;class oi extends Xs{constructor(t,e,s){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new $s(new Float32Array(16*s),16),this.instanceColor=null,this.morphTexture=null,this.count=s,this.boundingBox=null,this.boundingSphere=null;for(let t=0;t<s;t++)this.setMatrixAt(t,ii)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new te),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,Ks),si.copy(t.boundingBox).applyMatrix4(Ks),this.boundingBox.union(si)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new be),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,Ks),ri.copy(t.boundingSphere).applyMatrix4(Ks),this.boundingSphere.union(ri)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){const s=e.morphTargetInfluences,i=this.morphTexture.source.data.data,n=t*(s.length+1)+1;for(let t=0;t<s.length;t++)s[t]=i[n+t]}raycast(t,e){const s=this.matrixWorld,i=this.count;if(ni.geometry=this.geometry,ni.material=this.material,void 0!==ni.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),ri.copy(this.boundingSphere),ri.applyMatrix4(s),!1!==t.ray.intersectsSphere(ri)))for(let n=0;n<i;n++){this.getMatrixAt(n,Ks),ti.multiplyMatrices(s,Ks),ni.matrixWorld=ti,ni.raycast(t,ei);for(let t=0,s=ei.length;t<s;t++){const s=ei[t];s.instanceId=n,s.object=this,e.push(s)}ei.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new $s(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){const s=e.morphTargetInfluences,i=s.length+1;null===this.morphTexture&&(this.morphTexture=new Qs(new Float32Array(i*this.count),i,this.count,1028,pt));const n=this.morphTexture.source.data.data;let r=0;for(let t=0;t<s.length;t++)r+=s[t];const o=this.geometry.morphTargetsRelative?1:1-r,a=i*t;n[a]=o,n.set(s,a+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}const ai=new Qt,hi=new Qt,ci=new Ft;class li{constructor(t=new Qt(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,s,i){return this.normal.set(t,e,s),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,s){const i=ai.subVectors(s,e).cross(hi.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const s=t.delta(ai),i=this.normal.dot(s);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const n=-(t.start.dot(this.normal)+this.constant)/i;return n<0||n>1?null:e.copy(t.start).addScaledVector(s,n)}intersectsLine(t){const e=this.distanceToPoint(t.start),s=this.distanceToPoint(t.end);return e<0&&s>0||s<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const s=e||ci.getNormalMatrix(t),i=this.coplanarPoint(ai).applyMatrix4(t),n=this.normal.applyMatrix3(s).normalize();return this.constant=-i.dot(n),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const ui=new be,di=new Qt;class pi{constructor(t=new li,e=new li,s=new li,i=new li,n=new li,r=new li){this.planes=[t,e,s,i,n,r]}set(t,e,s,i,n,r){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(s),o[3].copy(i),o[4].copy(n),o[5].copy(r),this}copy(t){const e=this.planes;for(let s=0;s<6;s++)e[s].copy(t.planes[s]);return this}setFromProjectionMatrix(t,e=2e3){const s=this.planes,i=t.elements,n=i[0],r=i[1],o=i[2],a=i[3],h=i[4],c=i[5],l=i[6],u=i[7],d=i[8],p=i[9],m=i[10],f=i[11],g=i[12],y=i[13],b=i[14],x=i[15];if(s[0].setComponents(a-n,u-h,f-d,x-g).normalize(),s[1].setComponents(a+n,u+h,f+d,x+g).normalize(),s[2].setComponents(a+r,u+c,f+p,x+y).normalize(),s[3].setComponents(a-r,u-c,f-p,x-y).normalize(),s[4].setComponents(a-o,u-l,f-m,x-b).normalize(),e===_t)s[5].setComponents(a+o,u+l,f+m,x+b).normalize();else{if(e!==wt)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);s[5].setComponents(o,l,m,b).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),ui.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),ui.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(ui)}intersectsSprite(t){return ui.center.set(0,0,0),ui.radius=.7071067811865476,ui.applyMatrix4(t.matrixWorld),this.intersectsSphere(ui)}intersectsSphere(t){const e=this.planes,s=t.center,i=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(s)<i)return!1}return!0}intersectsBox(t){const e=this.planes;for(let s=0;s<6;s++){const i=e[s];if(di.x=i.normal.x>0?t.max.x:t.min.x,di.y=i.normal.y>0?t.max.y:t.min.y,di.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(di)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let s=0;s<6;s++)if(e[s].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function mi(t,e){return t-e}function fi(t,e){return t.z-e.z}function gi(t,e){return e.z-t.z}class yi{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,e,s,i){const n=this.pool,r=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1,index:-1});const o=n[this.index];r.push(o),this.index++,o.start=t,o.count=e,o.z=s,o.index=i}reset(){this.list.length=0,this.index=0}}const bi=new Be,xi=new xs(1,1,1),_i=new pi,wi=new te,Si=new be,vi=new Qt,Mi=new Qt,Ii=new Qt,Ai=new yi,Bi=new Xs,Ti=[];function zi(t,e,s=0){const i=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const n=t.count;for(let r=0;r<n;r++)for(let n=0;n<i;n++)e.setComponent(r+s,n,t.getComponent(r,n))}else e.array.set(t.array,s*i);e.needsUpdate=!0}function Ci(t,e){if(t.constructor!==e.constructor){const s=Math.min(t.length,e.length);for(let i=0;i<s;i++)e[i]=t[i]}else{const s=Math.min(t.length,e.length);e.set(new t.constructor(t.buffer,0,s))}}const Li=new Be;function Pi(t,e){return t.distance-e.distance}function Fi(t,e,s,i){let n=!0;if(t.layers.test(e.layers)){!1===t.raycast(e,s)&&(n=!1)}if(!0===n&&!0===i){const i=t.children;for(let t=0,n=i.length;t<n;t++)Fi(i[t],e,s,!0)}}const Oi=new Qt,Ei=new Qt;class ki{constructor(t=new Qt,e=new Qt){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Oi.subVectors(t,this.start),Ei.subVectors(this.end,this.start);const s=Ei.dot(Ei);let i=Ei.dot(Oi)/s;return e&&(i=At(i,0,1)),i}closestPointToPoint(t,e,s){const i=this.closestPointToPointParameter(t,e);return this.delta(s).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ut}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ut);const Vi=65536;var Ri=(t=>(t[t.IGNORE=0]="IGNORE",t[t.NORMAL=1]="NORMAL",t[t.HIGH=2]="HIGH",t))(Ri||{}),Ui=(t=>(t[t.FACE=0]="FACE",t[t.LINE=1]="LINE",t[t.POINT=2]="POINT",t[t.CENTER_LINE=3]="CENTER_LINE",t[t.CENTER_POINT=4]="CENTER_POINT",t))(Ui||{}),Di=(t=>(t[t.LINE=0]="LINE",t[t.MESH=1]="MESH",t))(Di||{}),Ni=(t=>(t[t.SET_BATCH_STATE=0]="SET_BATCH_STATE",t[t.ADD_BATCH=1]="ADD_BATCH",t[t.REMOVE_BATCH=2]="REMOVE_BATCH",t[t.UPDATE_FINISHED=3]="UPDATE_FINISHED",t))(Ni||{}),Gi=(t=>(t[t.Full=0]="Full",t[t.Line=1]="Line",t[t.Hidden=2]="Hidden",t))(Gi||{}),qi=(t=>(t[t.LOAD=0]="LOAD",t[t.UNLOAD=1]="UNLOAD",t[t.PICK=2]="PICK",t[t.CAMERA_UPDATE=3]="CAMERA_UPDATE",t[t.GET_BOUNDINGBOXES=4]="GET_BOUNDINGBOXES",t[t.PROPERTY_GETSETNAMES=5]="PROPERTY_GETSETNAMES",t[t.PROPERTY_GETPROPERTYDEFINITIONS=6]="PROPERTY_GETPROPERTYDEFINITIONS",t[t.PROPERTY_GETPROPERTYVALUES=7]="PROPERTY_GETPROPERTYVALUES",t[t.GUIDS_TO_ITEMIDS=8]="GUIDS_TO_ITEMIDS",t[t.AGGREGATE_PROPERTIES=9]="AGGREGATE_PROPERTIES",t[t.CALL=10]="CALL",t[t.UPDATE_GEOMETRY=11]="UPDATE_GEOMETRY",t[t.ADD_MATERIAL=12]="ADD_MATERIAL",t[t.ERROR=13]="ERROR",t))(qi||{}),Wi=(t=>(t[t.PICK_PRIORITY=0]="PICK_PRIORITY",t[t.VISIBILITY=1]="VISIBILITY",t[t.SELECTION=2]="SELECTION",t[t.HOVER=3]="HOVER",t))(Wi||{});const Hi=new Int32Array(2),ji=new Float32Array(Hi.buffer),Zi=new Float64Array(Hi.buffer),Yi=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0];var Xi,Ji;(Ji=Xi||(Xi={}))[Ji.UTF8_BYTES=1]="UTF8_BYTES",Ji[Ji.UTF16_STRING=2]="UTF16_STRING";class Qi{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new Qi(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return Hi[0]=this.readInt32(t),ji[0]}readFloat64(t){return Hi[Yi?0:1]=this.readInt32(t),Hi[Yi?1:0]=this.readInt32(t+4),Zi[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){ji[0]=e,this.writeInt32(t,Hi[0])}writeFloat64(t,e){Zi[0]=e,this.writeInt32(t,Hi[Yi?0:1]),this.writeInt32(t+4,Hi[Yi?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<4;e++)t+=String.fromCharCode(this.readInt8(this.position_+4+e));return t}__offset(t,e){const s=t-this.readInt32(t);return e<this.readInt16(s)?this.readInt16(s+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const s=this.readInt32(t);t+=4;const i=this.bytes_.subarray(t,t+s);return e===Xi.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(t,e){return"string"==typeof t?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+4}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(4!=t.length)throw new Error("FlatBuffers: file identifier must be length 4");for(let e=0;e<4;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+4+e))return!1;return!0}createScalarList(t,e){const s=[];for(let i=0;i<e;++i){const e=t(i);null!==e&&s.push(e)}return s}createObjList(t,e){const s=[];for(let i=0;i<e;++i){const e=t(i);null!==e&&s.push(e.unpack())}return s}}const $i=1.25,Ki=65535,tn=Math.pow(2,-24),en=Symbol("SKIP_GENERATION");function sn(t){return function(t){return t.index?t.index.count:t.attributes.position.count}(t)/3}function nn(t,e){if(!t.index){const s=t.attributes.position.count,i=function(t,e=ArrayBuffer){return t>65535?new Uint32Array(new e(4*t)):new Uint16Array(new e(2*t))}(s,e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);t.setIndex(new As(i,1));for(let t=0;t<s;t++)i[t]=t}}function rn(t,e){const s=sn(t),i=e||t.drawRange,n=i.start/3,r=(i.start+i.count)/3,o=Math.max(0,n),a=Math.min(s,r)-o;return[{offset:Math.floor(o),count:Math.floor(a)}]}function on(t,e){if(!t.groups||!t.groups.length)return rn(t,e);const s=[],i=new Set,n=e||t.drawRange,r=n.start/3,o=(n.start+n.count)/3;for(const e of t.groups){const t=e.start/3,s=(e.start+e.count)/3;i.add(Math.max(r,t)),i.add(Math.min(o,s))}const a=Array.from(i.values()).sort(((t,e)=>t-e));for(let t=0;t<a.length-1;t++){const e=a[t],i=a[t+1];s.push({offset:Math.floor(e),count:Math.floor(i-e)})}return s}function an(t,e,s,i,n){let r=1/0,o=1/0,a=1/0,h=-1/0,c=-1/0,l=-1/0,u=1/0,d=1/0,p=1/0,m=-1/0,f=-1/0,g=-1/0;for(let i=6*e,n=6*(e+s);i<n;i+=6){const e=t[i+0],s=t[i+1],n=e-s,y=e+s;n<r&&(r=n),y>h&&(h=y),e<u&&(u=e),e>m&&(m=e);const b=t[i+2],x=t[i+3],_=b-x,w=b+x;_<o&&(o=_),w>c&&(c=w),b<d&&(d=b),b>f&&(f=b);const S=t[i+4],v=t[i+5],M=S-v,I=S+v;M<a&&(a=M),I>l&&(l=I),S<p&&(p=S),S>g&&(g=S)}i[0]=r,i[1]=o,i[2]=a,i[3]=h,i[4]=c,i[5]=l,n[0]=u,n[1]=d,n[2]=p,n[3]=m,n[4]=f,n[5]=g}function hn(t,e,s){return s.min.x=e[t],s.min.y=e[t+1],s.min.z=e[t+2],s.max.x=e[t+3],s.max.y=e[t+4],s.max.z=e[t+5],s}function cn(t){let e=-1,s=-1/0;for(let i=0;i<3;i++){const n=t[i+3]-t[i];n>s&&(s=n,e=i)}return e}function ln(t,e){e.set(t)}function un(t,e,s){let i,n;for(let r=0;r<3;r++){const o=r+3;i=t[r],n=e[r],s[r]=i<n?i:n,i=t[o],n=e[o],s[o]=i>n?i:n}}function dn(t,e,s){for(let i=0;i<3;i++){const n=e[t+2*i],r=e[t+2*i+1],o=n-r,a=n+r;o<s[i]&&(s[i]=o),a>s[i+3]&&(s[i+3]=a)}}function pn(t){const e=t[3]-t[0],s=t[4]-t[1],i=t[5]-t[2];return 2*(e*s+s*i+i*e)}const mn=32,fn=(t,e)=>t.candidate-e.candidate,gn=new Array(mn).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),yn=new Float32Array(6);class bn{constructor(){this.boundingData=new Float32Array(6)}}function xn(t,e,s,i,n,r){let o=i,a=i+n-1;const h=r.pos,c=2*r.axis;for(;;){for(;o<=a&&s[6*o+c]<h;)o++;for(;o<=a&&s[6*a+c]>=h;)a--;if(!(o<a))return o;for(let t=0;t<3;t++){let s=e[3*o+t];e[3*o+t]=e[3*a+t],e[3*a+t]=s}for(let t=0;t<6;t++){let e=s[6*o+t];s[6*o+t]=s[6*a+t],s[6*a+t]=e}o++,a--}}function _n(t,e,s,i,n,r){let o=i,a=i+n-1;const h=r.pos,c=2*r.axis;for(;;){for(;o<=a&&s[6*o+c]<h;)o++;for(;o<=a&&s[6*a+c]>=h;)a--;if(!(o<a))return o;{let e=t[o];t[o]=t[a],t[a]=e;for(let t=0;t<6;t++){let e=s[6*o+t];s[6*o+t]=s[6*a+t],s[6*a+t]=e}o++,a--}}}function wn(t,e){return 65535===e[t+15]}function Sn(t,e){return e[t+6]}function vn(t,e){return e[t+14]}function Mn(t){return t+8}function In(t,e){return e[t+6]}function An(t,e){return e[t+7]}let Bn,Tn,zn,Cn;const Ln=Math.pow(2,32);function Pn(t){return"count"in t?1:1+Pn(t.left)+Pn(t.right)}function Fn(t,e,s){return Bn=new Float32Array(s),Tn=new Uint32Array(s),zn=new Uint16Array(s),Cn=new Uint8Array(s),On(t,e)}function On(t,e){const s=t/4,i=t/2,n="count"in e,r=e.boundingData;for(let t=0;t<6;t++)Bn[s+t]=r[t];if(n){if(e.buffer){const i=e.buffer;Cn.set(new Uint8Array(i),t);for(let e=t,n=t+i.byteLength;e<n;e+=32){wn(e/2,zn)||(Tn[e/4+6]+=s)}return t+i.byteLength}{const n=e.offset,r=e.count;return Tn[s+6]=n,zn[i+14]=r,zn[i+15]=Ki,t+32}}{const i=e.left,n=e.right,r=e.splitAxis;let o;if(o=On(t+32,i),o/4>Ln)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return Tn[s+6]=o/4,o=On(o,n),Tn[s+7]=r,o}}function En(t,e,s,i,n){const{maxDepth:r,verbose:o,maxLeafTris:a,strategy:h,onProgress:c,indirect:l}=n,u=t._indirectBuffer,d=t.geometry,p=d.index?d.index.array:null,m=l?_n:xn,f=sn(d),g=new Float32Array(6);let y=!1;const b=new bn;return an(e,s,i,b.boundingData,g),function t(s,i,n,c=null,l=0){!y&&l>=r&&(y=!0,o&&(console.warn(`MeshBVH: Max depth of ${r} reached when generating BVH. Consider increasing maxDepth.`),console.warn(d)));if(n<=a||l>=r)return x(i+n),s.offset=i,s.count=n,s;const f=function(t,e,s,i,n,r){let o=-1,a=0;if(0===r)o=cn(e),-1!==o&&(a=(e[o]+e[o+3])/2);else if(1===r)o=cn(t),-1!==o&&(a=function(t,e,s,i){let n=0;for(let r=e,o=e+s;r<o;r++)n+=t[6*r+2*i];return n/s}(s,i,n,o));else if(2===r){const r=pn(t);let h=$i*n;const c=6*i,l=6*(i+n);for(let t=0;t<3;t++){const i=e[t],u=(e[t+3]-i)/mn;if(n<8){const e=[...gn];e.length=n;let i=0;for(let n=c;n<l;n+=6,i++){const r=e[i];r.candidate=s[n+2*t],r.count=0;const{bounds:o,leftCacheBounds:a,rightCacheBounds:h}=r;for(let t=0;t<3;t++)h[t]=1/0,h[t+3]=-1/0,a[t]=1/0,a[t+3]=-1/0,o[t]=1/0,o[t+3]=-1/0;dn(n,s,o)}e.sort(fn);let u=n;for(let t=0;t<u;t++){const s=e[t];for(;t+1<u&&e[t+1].candidate===s.candidate;)e.splice(t+1,1),u--}for(let i=c;i<l;i+=6){const n=s[i+2*t];for(let t=0;t<u;t++){const r=e[t];n>=r.candidate?dn(i,s,r.rightCacheBounds):(dn(i,s,r.leftCacheBounds),r.count++)}}for(let s=0;s<u;s++){const i=e[s],c=i.count,l=n-i.count,u=i.leftCacheBounds,d=i.rightCacheBounds;let p=0;0!==c&&(p=pn(u)/r);let m=0;0!==l&&(m=pn(d)/r);const f=1+$i*(p*c+m*l);f<h&&(o=t,h=f,a=i.candidate)}}else{for(let t=0;t<mn;t++){const e=gn[t];e.count=0,e.candidate=i+u+t*u;const s=e.bounds;for(let t=0;t<3;t++)s[t]=1/0,s[t+3]=-1/0}for(let e=c;e<l;e+=6){let n=~~((s[e+2*t]-i)/u);n>=mn&&(n=31);const r=gn[n];r.count++,dn(e,s,r.bounds)}const e=gn[31];ln(e.bounds,e.rightCacheBounds);for(let t=30;t>=0;t--){const e=gn[t],s=gn[t+1];un(e.bounds,s.rightCacheBounds,e.rightCacheBounds)}let d=0;for(let e=0;e<31;e++){const s=gn[e],i=s.count,c=s.bounds,l=gn[e+1].rightCacheBounds;0!==i&&(0===d?ln(c,yn):un(c,yn,yn)),d+=i;let u=0,p=0;0!==d&&(u=pn(yn)/r);const m=n-d;0!==m&&(p=pn(l)/r);const f=1+$i*(u*d+p*m);f<h&&(o=t,h=f,a=s.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:o,pos:a}}(s.boundingData,c,e,i,n,h);if(-1===f.axis)return x(i+n),s.offset=i,s.count=n,s;const b=m(u,p,e,i,n,f);if(b===i||b===i+n)x(i+n),s.offset=i,s.count=n;else{s.splitAxis=f.axis;const r=new bn,o=i,a=b-i;s.left=r,an(e,o,a,r.boundingData,g),t(r,o,a,g,l+1);const h=new bn,c=b,u=n-a;s.right=h,an(e,c,u,h.boundingData,g),t(h,c,u,g,l+1)}return s}(b,s,i,g),b;function x(t){c&&c(t/f)}}function kn(t,e){const s=t.geometry;e.indirect&&(t._indirectBuffer=function(t,e){const s=(t.index?t.index.count:t.attributes.position.count)/3,i=s>65536,n=i?4:2,r=e?new SharedArrayBuffer(s*n):new ArrayBuffer(s*n),o=i?new Uint32Array(r):new Uint16Array(r);for(let t=0,e=o.length;t<e;t++)o[t]=t;return o}(s,e.useSharedArrayBuffer),function(t,e){const s=sn(t),i=on(t,e).sort(((t,e)=>t.offset-e.offset)),n=i[i.length-1];n.count=Math.min(s-n.offset,n.count);let r=0;return i.forEach((({count:t})=>r+=t)),s!==r}(s,e.range)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),t._indirectBuffer||nn(s,e);const i=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=function(t,e=null,s=null,i=null){const n=t.attributes.position,r=t.index?t.index.array:null,o=sn(t),a=n.normalized;let h;null===e?(h=new Float32Array(6*o),s=0,i=o):(h=e,s=s||0,i=i||o);const c=n.array,l=n.offset||0;let u=3;n.isInterleavedBufferAttribute&&(u=n.data.stride);const d=["getX","getY","getZ"];for(let t=s;t<s+i;t++){const e=3*t,s=6*t;let i=e+0,o=e+1,p=e+2;r&&(i=r[i],o=r[o],p=r[p]),a||(i=i*u+l,o=o*u+l,p=p*u+l);for(let t=0;t<3;t++){let e,r,l;a?(e=n[d[t]](i),r=n[d[t]](o),l=n[d[t]](p)):(e=c[i+t],r=c[o+t],l=c[p+t]);let u=e;r<u&&(u=r),l<u&&(u=l);let m=e;r>m&&(m=r),l>m&&(m=l);const f=(m-u)/2,g=2*t;h[s+g+0]=u+f,h[s+g+1]=f+(Math.abs(u)+f)*tn}}return h}(s),r=e.indirect?rn(s,e.range):on(s,e.range);t._roots=r.map((s=>{const r=En(t,n,s.offset,s.count,e),o=Pn(r),a=new i(32*o);return Fn(0,r,a),a}))}class Vn{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const r=t[n][e];s=r<s?r:s,i=r>i?r:i}this.min=s,this.max=i}setFromPoints(t,e){let s=1/0,i=-1/0;for(let n=0,r=e.length;n<r;n++){const r=e[n],o=t.dot(r);s=o<s?o:s,i=o>i?o:i}this.min=s,this.max=i}isSeparated(t){return this.min>t.max||t.min>this.max}}Vn.prototype.setFromBox=function(){const t=new Qt;return function(e,s){const i=s.min,n=s.max;let r=1/0,o=-1/0;for(let s=0;s<=1;s++)for(let a=0;a<=1;a++)for(let h=0;h<=1;h++){t.x=i.x*s+n.x*(1-s),t.y=i.y*a+n.y*(1-a),t.z=i.z*h+n.z*(1-h);const c=e.dot(t);r=Math.min(c,r),o=Math.max(c,o)}this.min=r,this.max=o}}();const Rn=function(){const t=new Qt,e=new Qt,s=new Qt;return function(i,n,r){const o=i.start,a=t,h=n.start,c=e;s.subVectors(o,h),t.subVectors(i.end,i.start),e.subVectors(n.end,n.start);const l=s.dot(c),u=c.dot(a),d=c.dot(c),p=s.dot(a),m=a.dot(a)*d-u*u;let f,g;f=0!==m?(l*u-p*d)/m:0,g=(l+f*u)/d,r.x=f,r.y=g}}(),Un=function(){const t=new Pt,e=new Qt,s=new Qt;return function(i,n,r,o){Rn(i,n,t);let a=t.x,h=t.y;if(a>=0&&a<=1&&h>=0&&h<=1)return i.at(a,r),void n.at(h,o);if(a>=0&&a<=1)return h<0?n.at(0,o):n.at(1,o),void i.closestPointToPoint(o,!0,r);if(h>=0&&h<=1)return a<0?i.at(0,r):i.at(1,r),void n.closestPointToPoint(r,!0,o);{let t,c;t=a<0?i.start:i.end,c=h<0?n.start:n.end;const l=e,u=s;return i.closestPointToPoint(c,!0,e),n.closestPointToPoint(t,!0,s),l.distanceToSquared(c)<=u.distanceToSquared(t)?(r.copy(l),void o.copy(c)):(r.copy(t),void o.copy(u))}}}(),Dn=function(){const t=new Qt,e=new Qt,s=new li,i=new ki;return function(n,r){const{radius:o,center:a}=n,{a:h,b:c,c:l}=r;i.start=h,i.end=c;if(i.closestPointToPoint(a,!0,t).distanceTo(a)<=o)return!0;i.start=h,i.end=l;if(i.closestPointToPoint(a,!0,t).distanceTo(a)<=o)return!0;i.start=c,i.end=l;if(i.closestPointToPoint(a,!0,t).distanceTo(a)<=o)return!0;const u=r.getPlane(s);if(Math.abs(u.distanceToPoint(a))<=o){const t=u.projectPoint(a,e);if(r.containsPoint(t))return!0}return!1}}();function Nn(t){return Math.abs(t)<1e-15}class Gn extends ms{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new Qt)),this.satBounds=new Array(4).fill().map((()=>new Vn)),this.points=[this.a,this.b,this.c],this.sphere=new be,this.plane=new li,this.needsUpdate=!0}intersectsSphere(t){return Dn(t,this)}update(){const t=this.a,e=this.b,s=this.c,i=this.points,n=this.satAxes,r=this.satBounds,o=n[0],a=r[0];this.getNormal(o),a.setFromPoints(o,i);const h=n[1],c=r[1];h.subVectors(t,e),c.setFromPoints(h,i);const l=n[2],u=r[2];l.subVectors(e,s),u.setFromPoints(l,i);const d=n[3],p=r[3];d.subVectors(s,t),p.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,t),this.needsUpdate=!1}}Gn.prototype.closestPointToSegment=function(){const t=new Qt,e=new Qt,s=new ki;return function(i,n=null,r=null){const{start:o,end:a}=i,h=this.points;let c,l=1/0;for(let o=0;o<3;o++){const a=(o+1)%3;s.start.copy(h[o]),s.end.copy(h[a]),Un(s,i,t,e),c=t.distanceToSquared(e),c<l&&(l=c,n&&n.copy(t),r&&r.copy(e))}return this.closestPointToPoint(o,t),c=o.distanceToSquared(t),c<l&&(l=c,n&&n.copy(t),r&&r.copy(o)),this.closestPointToPoint(a,t),c=a.distanceToSquared(t),c<l&&(l=c,n&&n.copy(t),r&&r.copy(a)),Math.sqrt(l)}}(),Gn.prototype.intersectsTriangle=function(){const t=new Gn,e=new Array(3),s=new Array(3),i=new Vn,n=new Vn,r=new Qt,o=new Qt,a=new Qt,h=new Qt,c=new Qt,l=new ki,u=new ki,d=new ki,p=new Qt;function m(t,e,s){const i=t.points;let n=0,r=-1;for(let t=0;t<3;t++){const{start:a,end:h}=l;a.copy(i[t]),h.copy(i[(t+1)%3]),l.delta(o);const c=Nn(e.distanceToPoint(a));if(Nn(e.normal.dot(o))&&c){s.copy(l),n=2;break}const u=e.intersectLine(l,p);if(!u&&c&&p.copy(a),(u||c)&&!Nn(p.distanceTo(h))){if(n<=1){(1===n?s.start:s.end).copy(p),c&&(r=n)}else if(n>=2){(1===r?s.start:s.end).copy(p),n=2;break}if(n++,2===n&&-1===r)break}}return n}return function(o,l=null,p=!1){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(t.copy(o),t.update(),o=t);const f=this.plane,g=o.plane;if(Math.abs(f.normal.dot(g.normal))>1-1e-10){const t=this.satBounds,a=this.satAxes;s[0]=o.a,s[1]=o.b,s[2]=o.c;for(let e=0;e<4;e++){const n=t[e],r=a[e];if(i.setFromPoints(r,s),n.isSeparated(i))return!1}const h=o.satBounds,c=o.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let t=0;t<4;t++){const s=h[t],n=c[t];if(i.setFromPoints(n,e),s.isSeparated(i))return!1}for(let t=0;t<4;t++){const o=a[t];for(let t=0;t<4;t++){const a=c[t];if(r.crossVectors(o,a),i.setFromPoints(r,e),n.setFromPoints(r,s),i.isSeparated(n))return!1}}return l&&(p||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),l.start.set(0,0,0),l.end.set(0,0,0)),!0}{const t=m(this,g,u);if(1===t&&o.containsPoint(u.end))return l&&(l.start.copy(u.end),l.end.copy(u.end)),!0;if(2!==t)return!1;const e=m(o,f,d);if(1===e&&this.containsPoint(d.end))return l&&(l.start.copy(d.end),l.end.copy(d.end)),!0;if(2!==e)return!1;if(u.delta(a),d.delta(h),a.dot(h)<0){let t=d.start;d.start=d.end,d.end=t}const s=u.start.dot(a),i=u.end.dot(a),n=d.start.dot(a),r=d.end.dot(a);return(s===r||n===i||i<n!==s<r)&&(l&&(c.subVectors(u.start,d.start),c.dot(a)>0?l.start.copy(u.start):l.start.copy(d.start),c.subVectors(u.end,d.end),c.dot(a)<0?l.end.copy(u.end):l.end.copy(d.end)),!0)}}}(),Gn.prototype.distanceToPoint=function(){const t=new Qt;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),Gn.prototype.distanceToTriangle=function(){const t=new Qt,e=new Qt,s=["a","b","c"],i=new ki,n=new ki;return function(r,o=null,a=null){const h=o||a?i:null;if(this.intersectsTriangle(r,h))return(o||a)&&(o&&h.getCenter(o),a&&h.getCenter(a)),0;let c=1/0;for(let e=0;e<3;e++){let i;const n=s[e],h=r[n];this.closestPointToPoint(h,t),i=h.distanceToSquared(t),i<c&&(c=i,o&&o.copy(t),a&&a.copy(h));const l=this[n];r.closestPointToPoint(l,t),i=l.distanceToSquared(t),i<c&&(c=i,o&&o.copy(l),a&&a.copy(t))}for(let h=0;h<3;h++){const l=s[h],u=s[(h+1)%3];i.set(this[l],this[u]);for(let h=0;h<3;h++){const l=s[h],u=s[(h+1)%3];n.set(r[l],r[u]),Un(i,n,t,e);const d=t.distanceToSquared(e);d<c&&(c=d,o&&o.copy(t),a&&a.copy(e))}}return Math.sqrt(c)}}();class qn{constructor(t,e,s){this.isOrientedBox=!0,this.min=new Qt,this.max=new Qt,this.matrix=new Be,this.invMatrix=new Be,this.points=new Array(8).fill().map((()=>new Qt)),this.satAxes=new Array(3).fill().map((()=>new Qt)),this.satBounds=new Array(3).fill().map((()=>new Vn)),this.alignedSatBounds=new Array(3).fill().map((()=>new Vn)),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),s&&this.matrix.copy(s)}set(t,e,s){this.min.copy(t),this.max.copy(e),this.matrix.copy(s),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}qn.prototype.update=function(){return function(){const t=this.matrix,e=this.min,s=this.max,i=this.points;for(let n=0;n<=1;n++)for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){const a=i[1*n|2*r|4*o];a.x=n?s.x:e.x,a.y=r?s.y:e.y,a.z=o?s.z:e.z,a.applyMatrix4(t)}const n=this.satBounds,r=this.satAxes,o=i[0];for(let t=0;t<3;t++){const e=r[t],s=n[t],a=i[1<<t];e.subVectors(o,a),s.setFromPoints(e,i)}const a=this.alignedSatBounds;a[0].setFromPointsField(i,"x"),a[1].setFromPointsField(i,"y"),a[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}(),qn.prototype.intersectsBox=function(){const t=new Vn;return function(e){this.needsUpdate&&this.update();const s=e.min,i=e.max,n=this.satBounds,r=this.satAxes,o=this.alignedSatBounds;if(t.min=s.x,t.max=i.x,o[0].isSeparated(t))return!1;if(t.min=s.y,t.max=i.y,o[1].isSeparated(t))return!1;if(t.min=s.z,t.max=i.z,o[2].isSeparated(t))return!1;for(let s=0;s<3;s++){const i=r[s],o=n[s];if(t.setFromBox(i,e),o.isSeparated(t))return!1}return!0}}(),qn.prototype.intersectsTriangle=function(){const t=new Gn,e=new Array(3),s=new Vn,i=new Vn,n=new Qt;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(t.copy(r),t.update(),r=t);const o=this.satBounds,a=this.satAxes;e[0]=r.a,e[1]=r.b,e[2]=r.c;for(let t=0;t<3;t++){const i=o[t],n=a[t];if(s.setFromPoints(n,e),i.isSeparated(s))return!1}const h=r.satBounds,c=r.satAxes,l=this.points;for(let t=0;t<3;t++){const e=h[t],i=c[t];if(s.setFromPoints(i,l),e.isSeparated(s))return!1}for(let t=0;t<3;t++){const r=a[t];for(let t=0;t<4;t++){const o=c[t];if(n.crossVectors(r,o),s.setFromPoints(n,e),i.setFromPoints(n,l),s.isSeparated(i))return!1}}return!0}}(),qn.prototype.closestPointToPoint=function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}(),qn.prototype.distanceToPoint=function(){const t=new Qt;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),qn.prototype.distanceToBox=function(){const t=["x","y","z"],e=new Array(12).fill().map((()=>new ki)),s=new Array(12).fill().map((()=>new ki)),i=new Qt,n=new Qt;return function(r,o=0,a=null,h=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||h)&&(r.getCenter(n),this.closestPointToPoint(n,i),r.closestPointToPoint(i,n),a&&a.copy(i),h&&h.copy(n)),0;const c=o*o,l=r.min,u=r.max,d=this.points;let p=1/0;for(let t=0;t<8;t++){const e=d[t];n.copy(e).clamp(l,u);const s=e.distanceToSquared(n);if(s<p&&(p=s,a&&a.copy(e),h&&h.copy(n),s<c))return Math.sqrt(s)}let m=0;for(let i=0;i<3;i++)for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){const o=(i+1)%3,a=(i+2)%3,h=1<<i|n<<o|r<<a,c=d[n<<o|r<<a],p=d[h];e[m].set(c,p);const f=t[i],g=t[o],y=t[a],b=s[m],x=b.start,_=b.end;x[f]=l[f],x[g]=n?l[g]:u[g],x[y]=r?l[y]:u[g],_[f]=u[f],_[g]=n?l[g]:u[g],_[y]=r?l[y]:u[g],m++}for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)for(let s=0;s<=1;s++){n.x=t?u.x:l.x,n.y=e?u.y:l.y,n.z=s?u.z:l.z,this.closestPointToPoint(n,i);const r=n.distanceToSquared(i);if(r<p&&(p=r,a&&a.copy(i),h&&h.copy(n),r<c))return Math.sqrt(r)}for(let t=0;t<12;t++){const r=e[t];for(let t=0;t<12;t++){const e=s[t];Un(r,e,i,n);const o=i.distanceToSquared(n);if(o<p&&(p=o,a&&a.copy(i),h&&h.copy(n),o<c))return Math.sqrt(o)}}return Math.sqrt(p)}}();class Wn{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return 0===t.length?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}class Hn extends Wn{constructor(){super((()=>new Gn))}}const jn=new Hn;const Zn=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=s=>{e&&t.push(e),e=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==t.length&&this.setBuffer(t.pop())}}};let Yn,Xn;const Jn=[],Qn=new Wn((()=>new te));function $n(t,e,s,i,n,r){Yn=Qn.getPrimitive(),Xn=Qn.getPrimitive(),Jn.push(Yn,Xn),Zn.setBuffer(t._roots[e]);const o=Kn(0,t.geometry,s,i,n,r);Zn.clearBuffer(),Qn.releasePrimitive(Yn),Qn.releasePrimitive(Xn),Jn.pop(),Jn.pop();const a=Jn.length;return a>0&&(Xn=Jn[a-1],Yn=Jn[a-2]),o}function Kn(t,e,s,i,n=null,r=0,o=0){const{float32Array:a,uint16Array:h,uint32Array:c}=Zn;let l=2*t;if(wn(l,h)){const e=Sn(t,c),s=vn(l,h);return hn(t,a,Yn),i(e,s,!1,o,r+t,Yn)}{let l=function(t){const{uint16Array:e,uint32Array:s}=Zn;let i=2*t;for(;!wn(i,e);)i=2*(t=Mn(t));return Sn(t,s)},u=function(t){const{uint16Array:e,uint32Array:s}=Zn;let i=2*t;for(;!wn(i,e);)i=2*(t=In(t,s));return Sn(t,s)+vn(i,e)};const d=Mn(t),p=In(t,c);let m,f,g,y,b=d,x=p;if(n&&(g=Yn,y=Xn,hn(b,a,g),hn(x,a,y),m=n(g),f=n(y),f<m)){b=p,x=d;const t=m;m=f,f=t,g=y}g||(g=Yn,hn(b,a,g));const _=s(g,wn(2*b,h),m,o+1,r+b);let w;if(2===_){const t=l(b);w=i(t,u(b)-t,!0,o+1,r+b,g)}else w=_&&Kn(b,e,s,i,n,r,o+1);if(w)return!0;y=Xn,hn(x,a,y);const S=s(y,wn(2*x,h),f,o+1,r+x);let v;if(2===S){const t=l(x);v=i(t,u(x)-t,!0,o+1,r+x,y)}else v=S&&Kn(x,e,s,i,n,r,o+1);return!!v}}const tr=new Qt,er=new Qt;const sr=parseInt(ut)>=169,ir=new Qt,nr=new Qt,rr=new Qt,or=new Pt,ar=new Pt,hr=new Pt,cr=new Qt,lr=new Qt,ur=new Qt,dr=new Qt;function pr(t,e,s,i,n,r,o){const a=3*i;let h=a+0,c=a+1,l=a+2;const u=t.index;t.index&&(h=u.getX(h),c=u.getX(c),l=u.getX(l));const{position:d,normal:p,uv:m,uv1:f}=t.attributes,g=function(t,e,s,i,n,r,o,a,h,c,l){ir.fromBufferAttribute(e,r),nr.fromBufferAttribute(e,o),rr.fromBufferAttribute(e,a);const u=function(t,e,s,i,n,r,o,a){let h;if(h=1===r?t.intersectTriangle(i,s,e,!0,n):t.intersectTriangle(e,s,i,2!==r,n),null===h)return null;const c=t.origin.distanceTo(n);return c<o||c>a?null:{distance:c,point:n.clone()}}(t,ir,nr,rr,dr,h,c,l);if(u){const e=new Qt;ms.getBarycoord(dr,ir,nr,rr,e),i&&(or.fromBufferAttribute(i,r),ar.fromBufferAttribute(i,o),hr.fromBufferAttribute(i,a),u.uv=ms.getInterpolation(dr,ir,nr,rr,or,ar,hr,new Pt)),n&&(or.fromBufferAttribute(n,r),ar.fromBufferAttribute(n,o),hr.fromBufferAttribute(n,a),u.uv1=ms.getInterpolation(dr,ir,nr,rr,or,ar,hr,new Pt)),s&&(cr.fromBufferAttribute(s,r),lr.fromBufferAttribute(s,o),ur.fromBufferAttribute(s,a),u.normal=ms.getInterpolation(dr,ir,nr,rr,cr,lr,ur,new Qt),u.normal.dot(t.direction)>0&&u.normal.multiplyScalar(-1));const h={a:r,b:o,c:a,normal:new Qt,materialIndex:0};ms.getNormal(ir,nr,rr,h.normal),u.face=h,u.faceIndex=r,sr&&(u.barycoord=e)}return u}(s,d,p,m,f,h,c,l,e,r,o);return g?(g.faceIndex=i,n&&n.push(g),g):null}function mr(t,e,s,i){const n=t.a,r=t.b,o=t.c;let a=e,h=e+1,c=e+2;s&&(a=s.getX(a),h=s.getX(h),c=s.getX(c)),n.x=i.getX(a),n.y=i.getY(a),n.z=i.getZ(a),r.x=i.getX(h),r.y=i.getY(h),r.z=i.getZ(h),o.x=i.getX(c),o.y=i.getY(c),o.z=i.getZ(c)}function fr(t,e,s,i,n,r,o){const{geometry:a}=s,{index:h}=a,c=a.attributes.position;for(let s=t,a=e+t;s<a;s++){let t;if(t=s,mr(o,3*t,h,c),o.needsUpdate=!0,i(o,t,n,r))return!0}return!1}function gr(t,e=null){e&&Array.isArray(e)&&(e=new Set(e));const s=t.geometry,i=s.index?s.index.array:null,n=s.attributes.position;let r,o,a,h,c=0;const l=t._roots;for(let t=0,e=l.length;t<e;t++)r=l[t],o=new Uint32Array(r),a=new Uint16Array(r),h=new Float32Array(r),u(0,c),c+=r.byteLength;function u(t,s,r=!1){const c=2*t;if(a[c+15]===Ki){const e=o[t+6];let s=1/0,r=1/0,l=1/0,u=-1/0,d=-1/0,p=-1/0;for(let t=3*e,o=3*(e+a[c+14]);t<o;t++){let e=i[t];const o=n.getX(e),a=n.getY(e),h=n.getZ(e);o<s&&(s=o),o>u&&(u=o),a<r&&(r=a),a>d&&(d=a),h<l&&(l=h),h>p&&(p=h)}return(h[t+0]!==s||h[t+1]!==r||h[t+2]!==l||h[t+3]!==u||h[t+4]!==d||h[t+5]!==p)&&(h[t+0]=s,h[t+1]=r,h[t+2]=l,h[t+3]=u,h[t+4]=d,h[t+5]=p,!0)}{const i=t+8,n=o[t+6],a=i+s,c=n+s;let l=r,d=!1,p=!1;e?l||(d=e.has(a),p=e.has(c),l=!d&&!p):(d=!0,p=!0);const m=l||p;let f=!1;(l||d)&&(f=u(i,s,l));let g=!1;m&&(g=u(n,s,l));const y=f||g;if(y)for(let e=0;e<3;e++){const s=i+e,r=n+e,o=h[s],a=h[s+3],c=h[r],l=h[r+3];h[t+e]=o<c?o:c,h[t+e+3]=a>l?a:l}return y}}}function yr(t,e,s,i,n){let r,o,a,h,c,l;const u=1/s.direction.x,d=1/s.direction.y,p=1/s.direction.z,m=s.origin.x,f=s.origin.y,g=s.origin.z;let y=e[t],b=e[t+3],x=e[t+1],_=e[t+3+1],w=e[t+2],S=e[t+3+2];return u>=0?(r=(y-m)*u,o=(b-m)*u):(r=(b-m)*u,o=(y-m)*u),d>=0?(a=(x-f)*d,h=(_-f)*d):(a=(_-f)*d,h=(x-f)*d),!(r>h||a>o)&&((a>r||isNaN(r))&&(r=a),(h<o||isNaN(o))&&(o=h),p>=0?(c=(w-g)*p,l=(S-g)*p):(c=(S-g)*p,l=(w-g)*p),!(r>l||c>o)&&((c>r||r!=r)&&(r=c),(l<o||o!=o)&&(o=l),r<=n&&o>=i))}function br(t,e,s,i,n,r,o){const{geometry:a}=s,{index:h}=a,c=a.attributes.position;for(let a=t,l=e+t;a<l;a++){let t;if(t=s.resolveTriangleIndex(a),mr(o,3*t,h,c),o.needsUpdate=!0,i(o,t,n,r))return!0}return!1}function xr(t,e,s,i,n,r,o){Zn.setBuffer(t._roots[e]),_r(0,t,s,i,n,r,o),Zn.clearBuffer()}function _r(t,e,s,i,n,r,o){const{float32Array:a,uint16Array:h,uint32Array:c}=Zn,l=2*t;if(wn(l,h)){!function(t,e,s,i,n,r,o,a){const{geometry:h,_indirectBuffer:c}=t;for(let t=i,c=i+n;t<c;t++)pr(h,e,s,t,r,o,a)}(e,s,i,Sn(t,c),vn(l,h),n,r,o)}else{const h=Mn(t);yr(h,a,i,r,o)&&_r(h,e,s,i,n,r,o);const l=In(t,c);yr(l,a,i,r,o)&&_r(l,e,s,i,n,r,o)}}const wr=["x","y","z"];function Sr(t,e,s,i,n,r){Zn.setBuffer(t._roots[e]);const o=vr(0,t,s,i,n,r);return Zn.clearBuffer(),o}function vr(t,e,s,i,n,r){const{float32Array:o,uint16Array:a,uint32Array:h}=Zn;let c=2*t;if(wn(c,a)){return function(t,e,s,i,n,r,o){const{geometry:a,_indirectBuffer:h}=t;let c=1/0,l=null;for(let t=i,h=i+n;t<h;t++){let i;i=pr(a,e,s,t,null,r,o),i&&i.distance<c&&(l=i,c=i.distance)}return l}(e,s,i,Sn(t,h),vn(c,a),n,r)}{const a=An(t,h),c=wr[a],l=i.direction[c]>=0;let u,d;l?(u=Mn(t),d=In(t,h)):(u=In(t,h),d=Mn(t));const p=yr(u,o,i,n,r)?vr(u,e,s,i,n,r):null;if(p){const t=p.point[c];if(l?t<=o[d+a]:t>=o[d+a+3])return p}const m=yr(d,o,i,n,r)?vr(d,e,s,i,n,r):null;return p&&m?p.distance<=m.distance?p:m:p||m||null}}const Mr=new te,Ir=new Gn,Ar=new Gn,Br=new Be,Tr=new qn,zr=new qn;function Cr(t,e,s,i){Zn.setBuffer(t._roots[e]);const n=Lr(0,t,s,i);return Zn.clearBuffer(),n}function Lr(t,e,s,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=Zn;let h=2*t;null===n&&(s.boundingBox||s.computeBoundingBox(),Tr.set(s.boundingBox.min,s.boundingBox.max,i),n=Tr);if(!wn(h,o)){const o=t+8,h=a[t+6];hn(o,r,Mr);if(n.intersectsBox(Mr)&&Lr(o,e,s,i,n))return!0;hn(h,r,Mr);return!!(n.intersectsBox(Mr)&&Lr(h,e,s,i,n))}{const n=e.geometry,c=n.index,l=n.attributes.position,u=s.index,d=s.attributes.position,p=Sn(t,a),m=vn(h,o);if(Br.copy(i).invert(),s.boundsTree){hn(t,r,zr),zr.matrix.copy(Br),zr.needsUpdate=!0;return s.boundsTree.shapecast({intersectsBounds:t=>zr.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let e=3*p,s=3*(m+p);e<s;e+=3)if(mr(Ar,e,c,l),Ar.needsUpdate=!0,t.intersectsTriangle(Ar))return!0;return!1}})}for(let t=3*p,e=3*(m+p);t<e;t+=3){mr(Ir,t,c,l),Ir.a.applyMatrix4(Br),Ir.b.applyMatrix4(Br),Ir.c.applyMatrix4(Br),Ir.needsUpdate=!0;for(let t=0,e=u.count;t<e;t+=3)if(mr(Ar,t,u,d),Ar.needsUpdate=!0,Ir.intersectsTriangle(Ar))return!0}}}const Pr=new Be,Fr=new qn,Or=new qn,Er=new Qt,kr=new Qt,Vr=new Qt,Rr=new Qt;function Ur(t,e,s,i={},n={},r=0,o=1/0){e.boundingBox||e.computeBoundingBox(),Fr.set(e.boundingBox.min,e.boundingBox.max,s),Fr.needsUpdate=!0;const a=t.geometry,h=a.attributes.position,c=a.index,l=e.attributes.position,u=e.index,d=jn.getPrimitive(),p=jn.getPrimitive();let m=Er,f=kr,g=null,y=null;n&&(g=Vr,y=Rr);let b=1/0,x=null,_=null;return Pr.copy(s).invert(),Or.matrix.copy(Pr),t.shapecast({boundsTraverseOrder:t=>Fr.distanceToBox(t),intersectsBounds:(t,e,s)=>s<b&&s<o&&(e&&(Or.min.copy(t.min),Or.max.copy(t.max),Or.needsUpdate=!0),!0),intersectsRange:(t,i)=>{if(e.boundsTree){return e.boundsTree.shapecast({boundsTraverseOrder:t=>Or.distanceToBox(t),intersectsBounds:(t,e,s)=>s<b&&s<o,intersectsRange:(e,n)=>{for(let o=e,a=e+n;o<a;o++){mr(p,3*o,u,l),p.a.applyMatrix4(s),p.b.applyMatrix4(s),p.c.applyMatrix4(s),p.needsUpdate=!0;for(let e=t,s=t+i;e<s;e++){mr(d,3*e,c,h),d.needsUpdate=!0;const t=d.distanceToTriangle(p,m,g);if(t<b&&(f.copy(m),y&&y.copy(g),b=t,x=e,_=o),t<r)return!0}}}})}for(let n=0,o=sn(e);n<o;n++){mr(p,3*n,u,l),p.a.applyMatrix4(s),p.b.applyMatrix4(s),p.c.applyMatrix4(s),p.needsUpdate=!0;for(let e=t,s=t+i;e<s;e++){mr(d,3*e,c,h),d.needsUpdate=!0;const t=d.distanceToTriangle(p,m,g);if(t<b&&(f.copy(m),y&&y.copy(g),b=t,x=e,_=n),t<r)return!0}}}}),jn.releasePrimitive(d),jn.releasePrimitive(p),b===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=b,i.faceIndex=x,n&&(n.point?n.point.copy(y):n.point=y.clone(),n.point.applyMatrix4(Pr),f.applyMatrix4(Pr),n.distance=f.sub(n.point).length(),n.faceIndex=_),i)}function Dr(t,e=null){e&&Array.isArray(e)&&(e=new Set(e));const s=t.geometry,i=s.index?s.index.array:null,n=s.attributes.position;let r,o,a,h,c=0;const l=t._roots;for(let t=0,e=l.length;t<e;t++)r=l[t],o=new Uint32Array(r),a=new Uint16Array(r),h=new Float32Array(r),u(0,c),c+=r.byteLength;function u(s,r,c=!1){const l=2*s;if(a[l+15]===Ki){const e=o[s+6];let r=1/0,c=1/0,u=1/0,d=-1/0,p=-1/0,m=-1/0;for(let s=e,o=e+a[l+14];s<o;s++){const e=3*t.resolveTriangleIndex(s);for(let t=0;t<3;t++){let s=e+t;s=i?i[s]:s;const o=n.getX(s),a=n.getY(s),h=n.getZ(s);o<r&&(r=o),o>d&&(d=o),a<c&&(c=a),a>p&&(p=a),h<u&&(u=h),h>m&&(m=h)}}return(h[s+0]!==r||h[s+1]!==c||h[s+2]!==u||h[s+3]!==d||h[s+4]!==p||h[s+5]!==m)&&(h[s+0]=r,h[s+1]=c,h[s+2]=u,h[s+3]=d,h[s+4]=p,h[s+5]=m,!0)}{const t=s+8,i=o[s+6],n=t+r,a=i+r;let l=c,d=!1,p=!1;e?l||(d=e.has(n),p=e.has(a),l=!d&&!p):(d=!0,p=!0);const m=l||p;let f=!1;(l||d)&&(f=u(t,r,l));let g=!1;m&&(g=u(i,r,l));const y=f||g;if(y)for(let e=0;e<3;e++){const n=t+e,r=i+e,o=h[n],a=h[n+3],c=h[r],l=h[r+3];h[s+e]=o<c?o:c,h[s+e+3]=a>l?a:l}return y}}}function Nr(t,e,s,i,n,r,o){Zn.setBuffer(t._roots[e]),Gr(0,t,s,i,n,r,o),Zn.clearBuffer()}function Gr(t,e,s,i,n,r,o){const{float32Array:a,uint16Array:h,uint32Array:c}=Zn,l=2*t;if(wn(l,h)){!function(t,e,s,i,n,r,o,a){const{geometry:h,_indirectBuffer:c}=t;for(let t=i,l=i+n;t<l;t++)pr(h,e,s,c?c[t]:t,r,o,a)}(e,s,i,Sn(t,c),vn(l,h),n,r,o)}else{const h=Mn(t);yr(h,a,i,r,o)&&Gr(h,e,s,i,n,r,o);const l=In(t,c);yr(l,a,i,r,o)&&Gr(l,e,s,i,n,r,o)}}const qr=["x","y","z"];function Wr(t,e,s,i,n,r){Zn.setBuffer(t._roots[e]);const o=Hr(0,t,s,i,n,r);return Zn.clearBuffer(),o}function Hr(t,e,s,i,n,r){const{float32Array:o,uint16Array:a,uint32Array:h}=Zn;let c=2*t;if(wn(c,a)){return function(t,e,s,i,n,r,o){const{geometry:a,_indirectBuffer:h}=t;let c=1/0,l=null;for(let t=i,u=i+n;t<u;t++){let i;i=pr(a,e,s,h?h[t]:t,null,r,o),i&&i.distance<c&&(l=i,c=i.distance)}return l}(e,s,i,Sn(t,h),vn(c,a),n,r)}{const a=An(t,h),c=qr[a],l=i.direction[c]>=0;let u,d;l?(u=Mn(t),d=In(t,h)):(u=In(t,h),d=Mn(t));const p=yr(u,o,i,n,r)?Hr(u,e,s,i,n,r):null;if(p){const t=p.point[c];if(l?t<=o[d+a]:t>=o[d+a+3])return p}const m=yr(d,o,i,n,r)?Hr(d,e,s,i,n,r):null;return p&&m?p.distance<=m.distance?p:m:p||m||null}}const jr=new te,Zr=new Gn,Yr=new Gn,Xr=new Be,Jr=new qn,Qr=new qn;function $r(t,e,s,i){Zn.setBuffer(t._roots[e]);const n=Kr(0,t,s,i);return Zn.clearBuffer(),n}function Kr(t,e,s,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=Zn;let h=2*t;null===n&&(s.boundingBox||s.computeBoundingBox(),Jr.set(s.boundingBox.min,s.boundingBox.max,i),n=Jr);if(!wn(h,o)){const o=t+8,h=a[t+6];hn(o,r,jr);if(n.intersectsBox(jr)&&Kr(o,e,s,i,n))return!0;hn(h,r,jr);return!!(n.intersectsBox(jr)&&Kr(h,e,s,i,n))}{const n=e.geometry,c=n.index,l=n.attributes.position,u=s.index,d=s.attributes.position,p=Sn(t,a),m=vn(h,o);if(Xr.copy(i).invert(),s.boundsTree){hn(t,r,Qr),Qr.matrix.copy(Xr),Qr.needsUpdate=!0;return s.boundsTree.shapecast({intersectsBounds:t=>Qr.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let s=p,i=m+p;s<i;s++)if(mr(Yr,3*e.resolveTriangleIndex(s),c,l),Yr.needsUpdate=!0,t.intersectsTriangle(Yr))return!0;return!1}})}for(let t=p,s=m+p;t<s;t++){const s=e.resolveTriangleIndex(t);mr(Zr,3*s,c,l),Zr.a.applyMatrix4(Xr),Zr.b.applyMatrix4(Xr),Zr.c.applyMatrix4(Xr),Zr.needsUpdate=!0;for(let t=0,e=u.count;t<e;t+=3)if(mr(Yr,t,u,d),Yr.needsUpdate=!0,Zr.intersectsTriangle(Yr))return!0}}}const to=new Be,eo=new qn,so=new qn,io=new Qt,no=new Qt,ro=new Qt,oo=new Qt;function ao(t,e,s,i={},n={},r=0,o=1/0){e.boundingBox||e.computeBoundingBox(),eo.set(e.boundingBox.min,e.boundingBox.max,s),eo.needsUpdate=!0;const a=t.geometry,h=a.attributes.position,c=a.index,l=e.attributes.position,u=e.index,d=jn.getPrimitive(),p=jn.getPrimitive();let m=io,f=no,g=null,y=null;n&&(g=ro,y=oo);let b=1/0,x=null,_=null;return to.copy(s).invert(),so.matrix.copy(to),t.shapecast({boundsTraverseOrder:t=>eo.distanceToBox(t),intersectsBounds:(t,e,s)=>s<b&&s<o&&(e&&(so.min.copy(t.min),so.max.copy(t.max),so.needsUpdate=!0),!0),intersectsRange:(i,n)=>{if(e.boundsTree){const a=e.boundsTree;return a.shapecast({boundsTraverseOrder:t=>so.distanceToBox(t),intersectsBounds:(t,e,s)=>s<b&&s<o,intersectsRange:(e,o)=>{for(let w=e,S=e+o;w<S;w++){const e=a.resolveTriangleIndex(w);mr(p,3*e,u,l),p.a.applyMatrix4(s),p.b.applyMatrix4(s),p.c.applyMatrix4(s),p.needsUpdate=!0;for(let e=i,s=i+n;e<s;e++){const s=t.resolveTriangleIndex(e);mr(d,3*s,c,h),d.needsUpdate=!0;const i=d.distanceToTriangle(p,m,g);if(i<b&&(f.copy(m),y&&y.copy(g),b=i,x=e,_=w),i<r)return!0}}}})}for(let o=0,a=sn(e);o<a;o++){mr(p,3*o,u,l),p.a.applyMatrix4(s),p.b.applyMatrix4(s),p.c.applyMatrix4(s),p.needsUpdate=!0;for(let e=i,s=i+n;e<s;e++){const s=t.resolveTriangleIndex(e);mr(d,3*s,c,h),d.needsUpdate=!0;const i=d.distanceToTriangle(p,m,g);if(i<b&&(f.copy(m),y&&y.copy(g),b=i,x=e,_=o),i<r)return!0}}}}),jn.releasePrimitive(d),jn.releasePrimitive(p),b===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=b,i.faceIndex=x,n&&(n.point?n.point.copy(y):n.point=y.clone(),n.point.applyMatrix4(to),f.applyMatrix4(to),n.distance=f.sub(n.point).length(),n.faceIndex=_),i)}const ho=new Zn.constructor,co=new Zn.constructor,lo=new Wn((()=>new te)),uo=new te,po=new te,mo=new te,fo=new te;let go=!1;function yo(t,e,s,i,n,r=0,o=0,a=0,h=0,c=null,l=!1){let u,d;l?(u=co,d=ho):(u=ho,d=co);const p=u.float32Array,m=u.uint32Array,f=u.uint16Array,g=d.float32Array,y=d.uint32Array,b=d.uint16Array,x=2*e,_=wn(2*t,f),w=wn(x,b);let S=!1;if(w&&_)S=l?n(Sn(e,y),vn(2*e,b),Sn(t,m),vn(2*t,f),h,o+e,a,r+t):n(Sn(t,m),vn(2*t,f),Sn(e,y),vn(2*e,b),a,r+t,h,o+e);else if(w){const c=lo.getPrimitive();hn(e,g,c),c.applyMatrix4(s);const u=Mn(t),d=In(t,m);hn(u,p,uo),hn(d,p,po);const f=c.intersectsBox(uo),y=c.intersectsBox(po);S=f&&yo(e,u,i,s,n,o,r,h,a+1,c,!l)||y&&yo(e,d,i,s,n,o,r,h,a+1,c,!l),lo.releasePrimitive(c)}else{const u=Mn(e),d=In(e,y);hn(u,g,mo),hn(d,g,fo);const f=c.intersectsBox(mo),b=c.intersectsBox(fo);if(f&&b)S=yo(t,u,s,i,n,r,o,a,h+1,c,l)||yo(t,d,s,i,n,r,o,a,h+1,c,l);else if(f)if(_)S=yo(t,u,s,i,n,r,o,a,h+1,c,l);else{const e=lo.getPrimitive();e.copy(mo).applyMatrix4(s);const c=Mn(t),d=In(t,m);hn(c,p,uo),hn(d,p,po);const f=e.intersectsBox(uo),g=e.intersectsBox(po);S=f&&yo(u,c,i,s,n,o,r,h,a+1,e,!l)||g&&yo(u,d,i,s,n,o,r,h,a+1,e,!l),lo.releasePrimitive(e)}else if(b)if(_)S=yo(t,d,s,i,n,r,o,a,h+1,c,l);else{const e=lo.getPrimitive();e.copy(fo).applyMatrix4(s);const c=Mn(t),u=In(t,m);hn(c,p,uo),hn(u,p,po);const f=e.intersectsBox(uo),g=e.intersectsBox(po);S=f&&yo(d,c,i,s,n,o,r,h,a+1,e,!l)||g&&yo(d,u,i,s,n,o,r,h,a+1,e,!l),lo.releasePrimitive(e)}}return S}const bo=new qn,xo=new te,_o={strategy:0,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class wo{static serialize(t,e={}){e={cloneBuffers:!0,...e};const s=t.geometry,i=t._roots,n=t._indirectBuffer,r=s.getIndex();let o;return o=e.cloneBuffers?{roots:i.map((t=>t.slice())),index:r?r.array.slice():null,indirectBuffer:n?n.slice():null}:{roots:i,index:r?r.array:null,indirectBuffer:n},o}static deserialize(t,e,s={}){s={setIndex:!0,indirect:Boolean(t.indirectBuffer),...s};const{index:i,roots:n,indirectBuffer:r}=t,o=new wo(e,{...s,[en]:!0});if(o._roots=n,o._indirectBuffer=r||null,s.setIndex){const s=e.getIndex();if(null===s){const s=new As(t.index,1,!1);e.setIndex(s)}else s.array!==i&&(s.array.set(i),s.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(!t.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((e=Object.assign({..._o,[en]:!1},e)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[en]||(kn(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new te))),this.resolveTriangleIndex=e.indirect?t=>this._indirectBuffer[t]:t=>t}refit(t=null){return(this.indirect?Dr:gr)(this,t)}traverse(t,e=0){const s=this._roots[e],i=new Uint32Array(s),n=new Uint16Array(s);!function e(r,o=0){const a=2*r,h=n[a+15]===Ki;if(h){const e=i[r+6],c=n[a+14];t(o,h,new Float32Array(s,4*r,6),e,c)}else{const n=r+8,a=i[r+6],c=i[r+7];t(o,h,new Float32Array(s,4*r,6),c)||(e(n,o+1),e(a,o+1))}}(0)}raycast(t,e=0,s=0,i=1/0){const n=this._roots,r=this.geometry,o=[],a=e.isMaterial,h=Array.isArray(e),c=r.groups,l=a?e.side:e,u=this.indirect?Nr:xr;for(let r=0,a=n.length;r<a;r++){const n=h?e[c[r].materialIndex].side:l,a=o.length;if(u(this,r,n,t,o,s,i),h){const t=c[r].materialIndex;for(let e=a,s=o.length;e<s;e++)o[e].face.materialIndex=t}}return o}raycastFirst(t,e=0,s=0,i=1/0){const n=this._roots,r=this.geometry,o=e.isMaterial,a=Array.isArray(e);let h=null;const c=r.groups,l=o?e.side:e,u=this.indirect?Wr:Sr;for(let r=0,o=n.length;r<o;r++){const n=u(this,r,a?e[c[r].materialIndex].side:l,t,s,i);null!=n&&(null==h||n.distance<h.distance)&&(h=n,a&&(n.face.materialIndex=c[r].materialIndex))}return h}intersectsGeometry(t,e){let s=!1;const i=this._roots,n=this.indirect?$r:Cr;for(let r=0,o=i.length;r<o&&(s=n(this,r,t,e),!s);r++);return s}shapecast(t){const e=jn.getPrimitive(),s=this.indirect?br:fr;let{boundsTraverseOrder:i,intersectsBounds:n,intersectsRange:r,intersectsTriangle:o}=t;if(r&&o){const t=r;r=(i,n,r,a,h)=>!!t(i,n,r,a,h)||s(i,n,this,o,r,a,e)}else r||(r=o?(t,i,n,r)=>s(t,i,this,o,n,r,e):(t,e,s)=>s);let a=!1,h=0;const c=this._roots;for(let t=0,e=c.length;t<e;t++){const e=c[t];if(a=$n(this,t,n,r,i,h),a)break;h+=e.byteLength}return jn.releasePrimitive(e),a}bvhcast(t,e,s){let{intersectsRanges:i,intersectsTriangles:n}=s;const r=jn.getPrimitive(),o=this.geometry.index,a=this.geometry.attributes.position,h=this.indirect?t=>{const e=this.resolveTriangleIndex(t);mr(r,3*e,o,a)}:t=>{mr(r,3*t,o,a)},c=jn.getPrimitive(),l=t.geometry.index,u=t.geometry.attributes.position,d=t.indirect?e=>{const s=t.resolveTriangleIndex(e);mr(c,3*s,l,u)}:t=>{mr(c,3*t,l,u)};if(n){const t=(t,s,i,o,a,l,u,p)=>{for(let m=i,f=i+o;m<f;m++){d(m),c.a.applyMatrix4(e),c.b.applyMatrix4(e),c.c.applyMatrix4(e),c.needsUpdate=!0;for(let e=t,i=t+s;e<i;e++)if(h(e),r.needsUpdate=!0,n(r,c,e,m,a,l,u,p))return!0}return!1};if(i){const e=i;i=function(s,i,n,r,o,a,h,c){return!!e(s,i,n,r,o,a,h,c)||t(s,i,n,r,o,a,h,c)}}else i=t}return function(t,e,s,i){if(go)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");go=!0;const n=t._roots,r=e._roots;let o,a=0,h=0;const c=(new Be).copy(s).invert();for(let t=0,e=n.length;t<e;t++){ho.setBuffer(n[t]),h=0;const e=lo.getPrimitive();hn(0,ho.float32Array,e),e.applyMatrix4(c);for(let t=0,n=r.length;t<n&&(co.setBuffer(r[t]),o=yo(0,0,s,c,i,a,h,0,0,e),co.clearBuffer(),h+=r[t].length,!o);t++);if(lo.releasePrimitive(e),ho.clearBuffer(),a+=n[t].length,o)break}return go=!1,o}(this,t,e,i)}intersectsBox(t,e){return bo.set(t.min,t.max,e),bo.needsUpdate=!0,this.shapecast({intersectsBounds:t=>bo.intersectsBox(t),intersectsTriangle:t=>bo.intersectsTriangle(t)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,s={},i={},n=0,r=1/0){return(this.indirect?ao:Ur)(this,t,e,s,i,n,r)}closestPointToPoint(t,e={},s=0,i=1/0){return function(t,e,s={},i=0,n=1/0){const r=i*i,o=n*n;let a=1/0,h=null;if(t.shapecast({boundsTraverseOrder:t=>(tr.copy(e).clamp(t.min,t.max),tr.distanceToSquared(e)),intersectsBounds:(t,e,s)=>s<a&&s<o,intersectsTriangle:(t,s)=>{t.closestPointToPoint(e,tr);const i=e.distanceToSquared(tr);return i<a&&(er.copy(tr),a=i,h=s),i<r}}),a===1/0)return null;const c=Math.sqrt(a);return s.point?s.point.copy(er):s.point=er.clone(),s.distance=c,s.faceIndex=h,s}(this,t,e,s,i)}getBoundingBox(t){t.makeEmpty();return this._roots.forEach((e=>{hn(0,new Float32Array(e),xo),t.union(xo)})),t}}function So(t,e,s){return null===t?null:(t.point.applyMatrix4(e.matrixWorld),t.distance=t.point.distanceTo(s.ray.origin),t.object=e,t)}const vo=new Ae,Mo=new Qt,Io=new Be,Ao=Xs.prototype.raycast,Bo=class extends Xs{get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}constructor(t,e,s=2*e,i){super(new Vs,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=t,this._maxVertexCount=e,this._maxIndexCount=s,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let t=Math.sqrt(4*this._maxInstanceCount);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4),s=new Qs(e,t,t,mt,pt);this._matricesTexture=s}_initIndirectTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Uint32Array(t*t),s=new Qs(e,t,t,1029,1014);this._indirectTexture=s}_initColorsTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Float32Array(t*t*4).fill(1),s=new Qs(e,t,t,mt,pt);s.colorSpace=Ut.workingColorSpace,this._colorsTexture=s}_initializeGeometry(t){const e=this.geometry,s=this._maxVertexCount,i=this._maxIndexCount;if(!1===this._geometryInitialized){for(const i in t.attributes){const n=t.getAttribute(i),{array:r,itemSize:o,normalized:a}=n,h=new r.constructor(s*o),c=new As(h,o,a);e.setAttribute(i,c)}if(null!==t.getIndex()){const t=s>65535?new Uint32Array(i):new Uint16Array(i);e.setIndex(new As(t,1))}this._geometryInitialized=!0}}_validateGeometry(t){const e=this.geometry;if(Boolean(t.getIndex())!==Boolean(e.getIndex()))throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const s in e.attributes){if(!t.hasAttribute(s))throw new Error(`THREE.BatchedMesh: Added geometry missing "${s}". All geometries must have consistent attributes.`);const i=t.getAttribute(s),n=e.getAttribute(s);if(i.itemSize!==n.itemSize||i.normalized!==n.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(t){const e=this._instanceInfo;if(t<0||t>=e.length||!1===e[t].active)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${t}. Instance is either out of range or has been deleted.`)}validateGeometryId(t){const e=this._geometryInfo;if(t<0||t>=e.length||!1===e[t].active)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${t}. Geometry is either out of range or has been deleted.`)}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new te);const t=this.boundingBox,e=this._instanceInfo;t.makeEmpty();for(let s=0,i=e.length;s<i;s++){if(!1===e[s].active)continue;const i=e[s].geometryIndex;this.getMatrixAt(s,bi),this.getBoundingBoxAt(i,wi).applyMatrix4(bi),t.union(wi)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new be);const t=this.boundingSphere,e=this._instanceInfo;t.makeEmpty();for(let s=0,i=e.length;s<i;s++){if(!1===e[s].active)continue;const i=e[s].geometryIndex;this.getMatrixAt(s,bi),this.getBoundingSphereAt(i,Si).applyMatrix4(bi),t.union(Si)}}addInstance(t){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const e={visible:!0,active:!0,geometryIndex:t};let s=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(mi),s=this._availableInstanceIds.shift(),this._instanceInfo[s]=e):(s=this._instanceInfo.length,this._instanceInfo.push(e));const i=this._matricesTexture;bi.identity().toArray(i.image.data,16*s),i.needsUpdate=!0;const n=this._colorsTexture;return n&&(xi.toArray(n.image.data,4*s),n.needsUpdate=!0),this._visibilityChanged=!0,s}addGeometry(t,e=-1,s=-1){this._initializeGeometry(t),this._validateGeometry(t);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},n=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=-1===e?t.getAttribute("position").count:e;const r=t.getIndex();if(null!==r&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=-1===s?r.count:s),-1!==i.indexStart&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let o;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(mi),o=this._availableGeometryIds.shift(),n[o]=i):(o=this._geometryCount,this._geometryCount++,n.push(i)),this.setGeometryAt(o,t),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,o}setGeometryAt(t,e){if(t>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);const s=this.geometry,i=null!==s.getIndex(),n=s.getIndex(),r=e.getIndex(),o=this._geometryInfo[t];if(i&&r.count>o.reservedIndexCount||e.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const a=o.vertexStart,h=o.reservedVertexCount;o.vertexCount=e.getAttribute("position").count;for(const t in s.attributes){const i=e.getAttribute(t),n=s.getAttribute(t);zi(i,n,a);const r=i.itemSize;for(let t=i.count,e=h;t<e;t++){const e=a+t;for(let t=0;t<r;t++)n.setComponent(e,t,0)}n.needsUpdate=!0,n.addUpdateRange(a*r,h*r)}if(i){const t=o.indexStart,s=o.reservedIndexCount;o.indexCount=e.getIndex().count;for(let e=0;e<r.count;e++)n.setX(t+e,a+r.getX(e));for(let e=r.count,i=s;e<i;e++)n.setX(t+e,a);n.needsUpdate=!0,n.addUpdateRange(t,o.reservedIndexCount)}return o.start=i?o.indexStart:o.vertexStart,o.count=i?o.indexCount:o.vertexCount,o.boundingBox=null,null!==e.boundingBox&&(o.boundingBox=e.boundingBox.clone()),o.boundingSphere=null,null!==e.boundingSphere&&(o.boundingSphere=e.boundingSphere.clone()),this._visibilityChanged=!0,t}deleteGeometry(t){const e=this._geometryInfo;if(t>=e.length||!1===e[t].active)return this;const s=this._instanceInfo;for(let e=0,i=s.length;e<i;e++)s[e].geometryIndex===t&&this.deleteInstance(e);return e[t].active=!1,this._availableGeometryIds.push(t),this._visibilityChanged=!0,this}deleteInstance(t){return this.validateInstanceId(t),this._instanceInfo[t].active=!1,this._availableInstanceIds.push(t),this._visibilityChanged=!0,this}optimize(){let t=0,e=0;const s=this._geometryInfo,i=s.map(((t,e)=>e)).sort(((t,e)=>s[t].vertexStart-s[e].vertexStart)),n=this.geometry;for(let r=0,o=s.length;r<o;r++){const o=i[r],a=s[o];if(!1!==a.active){if(null!==n.index){if(a.indexStart!==e){const{indexStart:s,vertexStart:i,reservedIndexCount:r}=a,o=n.index,h=o.array,c=t-i;for(let t=s;t<s+r;t++)h[t]=h[t]+c;o.array.copyWithin(e,s,s+r),o.addUpdateRange(e,r),a.indexStart=e}e+=a.reservedIndexCount}if(a.vertexStart!==t){const{vertexStart:e,reservedVertexCount:s}=a,i=n.attributes;for(const n in i){const r=i[n],{array:o,itemSize:a}=r;o.copyWithin(t*a,e*a,(e+s)*a),r.addUpdateRange(t*a,s*a)}a.vertexStart=t}t+=a.reservedVertexCount,a.start=n.index?a.indexStart:a.vertexStart,this._nextIndexStart=n.index?a.indexStart+a.reservedIndexCount:0,this._nextVertexStart=a.vertexStart+a.reservedVertexCount}}return this}getBoundingBoxAt(t,e){if(t>=this._geometryCount)return null;const s=this.geometry,i=this._geometryInfo[t];if(null===i.boundingBox){const t=new te,e=s.index,n=s.attributes.position;for(let s=i.start,r=i.start+i.count;s<r;s++){let i=s;e&&(i=e.getX(i)),t.expandByPoint(vi.fromBufferAttribute(n,i))}i.boundingBox=t}return e.copy(i.boundingBox),e}getBoundingSphereAt(t,e){if(t>=this._geometryCount)return null;const s=this.geometry,i=this._geometryInfo[t];if(null===i.boundingSphere){const e=new be;this.getBoundingBoxAt(t,wi),wi.getCenter(e.center);const n=s.index,r=s.attributes.position;let o=0;for(let t=i.start,s=i.start+i.count;t<s;t++){let s=t;n&&(s=n.getX(s)),vi.fromBufferAttribute(r,s),o=Math.max(o,e.center.distanceToSquared(vi))}e.radius=Math.sqrt(o),i.boundingSphere=e}return e.copy(i.boundingSphere),e}setMatrixAt(t,e){this.validateInstanceId(t);const s=this._matricesTexture,i=this._matricesTexture.image.data;return e.toArray(i,16*t),s.needsUpdate=!0,this}getMatrixAt(t,e){return this.validateInstanceId(t),e.fromArray(this._matricesTexture.image.data,16*t)}setColorAt(t,e){return this.validateInstanceId(t),null===this._colorsTexture&&this._initColorsTexture(),e.toArray(this._colorsTexture.image.data,4*t),this._colorsTexture.needsUpdate=!0,this}getColorAt(t,e){return this.validateInstanceId(t),e.fromArray(this._colorsTexture.image.data,4*t)}setVisibleAt(t,e){return this.validateInstanceId(t),this._instanceInfo[t].visible===e||(this._instanceInfo[t].visible=e,this._visibilityChanged=!0),this}getVisibleAt(t){return this.validateInstanceId(t),this._instanceInfo[t].visible}setGeometryIdAt(t,e){return this.validateInstanceId(t),this.validateGeometryId(e),this._instanceInfo[t].geometryIndex=e,this}getGeometryIdAt(t){return this.validateInstanceId(t),this._instanceInfo[t].geometryIndex}getGeometryRangeAt(t,e={}){this.validateGeometryId(t);const s=this._geometryInfo[t];return e.vertexStart=s.vertexStart,e.vertexCount=s.vertexCount,e.reservedVertexCount=s.reservedVertexCount,e.indexStart=s.indexStart,e.indexCount=s.indexCount,e.reservedIndexCount=s.reservedIndexCount,e.start=s.start,e.count=s.count,e}setInstanceCount(t){const e=this._availableInstanceIds,s=this._instanceInfo;for(e.sort(mi);e[e.length-1]===s.length;)s.pop(),e.pop();if(t<s.length)throw new Error(`BatchedMesh: Instance ids outside the range ${t} are being used. Cannot shrink instance count.`);const i=new Int32Array(t),n=new Int32Array(t);Ci(this._multiDrawCounts,i),Ci(this._multiDrawStarts,n),this._multiDrawCounts=i,this._multiDrawStarts=n,this._maxInstanceCount=t;const r=this._indirectTexture,o=this._matricesTexture,a=this._colorsTexture;r.dispose(),this._initIndirectTexture(),Ci(r.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),Ci(o.image.data,this._matricesTexture.image.data),a&&(a.dispose(),this._initColorsTexture(),Ci(a.image.data,this._colorsTexture.image.data))}setGeometrySize(t,e){const s=[...this._geometryInfo].filter((t=>t.active));if(Math.max(...s.map((t=>t.vertexStart+t.reservedVertexCount)))>t)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${e}. Cannot shrink further.`);if(this.geometry.index){if(Math.max(...s.map((t=>t.indexStart+t.reservedIndexCount)))>e)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${e}. Cannot shrink further.`)}const i=this.geometry;i.dispose(),this._maxVertexCount=t,this._maxIndexCount=e,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Vs,this._initializeGeometry(i));const n=this.geometry;i.index&&Ci(i.index.array,n.index.array);for(const t in i.attributes)Ci(i.attributes[t].array,n.attributes[t].array)}raycast(t,e){const s=this._instanceInfo,i=this._geometryInfo,n=this.matrixWorld,r=this.geometry;Bi.material=this.material,Bi.geometry.index=r.index,Bi.geometry.attributes=r.attributes,null===Bi.geometry.boundingBox&&(Bi.geometry.boundingBox=new te),null===Bi.geometry.boundingSphere&&(Bi.geometry.boundingSphere=new be);for(let r=0,o=s.length;r<o;r++){if(!s[r].visible||!s[r].active)continue;const o=s[r].geometryIndex,a=i[o];Bi.geometry.setDrawRange(a.start,a.count),this.getMatrixAt(r,Bi.matrixWorld).premultiply(n),this.getBoundingBoxAt(o,Bi.geometry.boundingBox),this.getBoundingSphereAt(o,Bi.geometry.boundingSphere),Bi.raycast(t,Ti);for(let t=0,s=Ti.length;t<s;t++){const s=Ti[t];s.object=this,s.batchId=r,e.push(s)}Ti.length=0}Bi.material=null,Bi.geometry.index=null,Bi.geometry.attributes={},Bi.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=null!==t.boundingBox?t.boundingBox.clone():null,this.boundingSphere=null!==t.boundingSphere?t.boundingSphere.clone():null,this._geometryInfo=t._geometryInfo.map((t=>({...t,boundingBox:null!==t.boundingBox?t.boundingBox.clone():null,boundingSphere:null!==t.boundingSphere?t.boundingSphere.clone():null}))),this._instanceInfo=t._instanceInfo.map((t=>({...t}))),this._maxInstanceCount=t._maxInstanceCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(t,e,s,i,n){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const r=i.getIndex(),o=null===r?1:r.array.BYTES_PER_ELEMENT,a=this._instanceInfo,h=this._multiDrawStarts,c=this._multiDrawCounts,l=this._geometryInfo,u=this.perObjectFrustumCulled,d=this._indirectTexture,p=d.image.data;u&&(bi.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse).multiply(this.matrixWorld),_i.setFromProjectionMatrix(bi,t.coordinateSystem));let m=0;if(this.sortObjects){bi.copy(this.matrixWorld).invert(),vi.setFromMatrixPosition(s.matrixWorld).applyMatrix4(bi),Mi.set(0,0,-1).transformDirection(s.matrixWorld).transformDirection(bi);for(let t=0,e=a.length;t<e;t++)if(a[t].visible&&a[t].active){const e=a[t].geometryIndex;this.getMatrixAt(t,bi),this.getBoundingSphereAt(e,Si).applyMatrix4(bi);let s=!1;if(u&&(s=!_i.intersectsSphere(Si)),!s){const s=l[e],i=Ii.subVectors(Si.center,vi).dot(Mi);Ai.push(s.start,s.count,i,t)}}const t=Ai.list,e=this.customSort;null===e?t.sort(n.transparent?gi:fi):e.call(this,t,s);for(let e=0,s=t.length;e<s;e++){const s=t[e];h[m]=s.start*o,c[m]=s.count,p[m]=s.index,m++}Ai.reset()}else for(let t=0,e=a.length;t<e;t++)if(a[t].visible&&a[t].active){const e=a[t].geometryIndex;let s=!1;if(u&&(this.getMatrixAt(t,bi),this.getBoundingSphereAt(e,Si).applyMatrix4(bi),s=!_i.intersectsSphere(Si)),!s){const s=l[e];h[m]=s.start*o,c[m]=s.count,p[m]=t,m++}}d.needsUpdate=!0,this._multiDrawCount=m,this._visibilityChanged=!1}onBeforeShadow(t,e,s,i,n,r){this.onBeforeRender(t,null,i,n,r)}}.prototype.raycast,To=new Qt,zo=new Xs,Co=[];function Lo(t,e){this.isBatchedMesh?Po.call(this,t,e):Fo.call(this,t,e)}function Po(t,e){if(this.boundsTrees){const s=this.boundsTrees,i=this._drawInfo||this._instanceInfo,n=this._drawRanges||this._geometryInfo,r=this.matrixWorld;zo.material=this.material,zo.geometry=this.geometry;const o=zo.geometry.boundsTree,a=zo.geometry.drawRange;null===zo.geometry.boundingSphere&&(zo.geometry.boundingSphere=new be);for(let o=0,a=i.length;o<a;o++){if(!this.getVisibleAt(o))continue;const a=i[o].geometryIndex;if(zo.geometry.boundsTree=s[a],this.getMatrixAt(o,zo.matrixWorld).premultiply(r),!zo.geometry.boundsTree){this.getBoundingBoxAt(a,zo.geometry.boundingBox),this.getBoundingSphereAt(a,zo.geometry.boundingSphere);const t=n[a];zo.geometry.setDrawRange(t.start,t.count)}zo.raycast(t,Co);for(let t=0,s=Co.length;t<s;t++){const s=Co[t];s.object=this,s.batchId=o,e.push(s)}Co.length=0}zo.geometry.boundsTree=o,zo.geometry.drawRange=a,zo.material=null,zo.geometry=null}else Bo.call(this,t,e)}function Fo(t,e){if(this.geometry.boundsTree){if(void 0===this.material)return;Io.copy(this.matrixWorld).invert(),vo.copy(t.ray).applyMatrix4(Io),To.setFromMatrixScale(this.matrixWorld),Mo.copy(vo.direction).multiply(To);const s=Mo.length(),i=t.near/s,n=t.far/s,r=this.geometry.boundsTree;if(!0===t.firstHitOnly){const s=So(r.raycastFirst(vo,this.material,i,n),this,t);s&&e.push(s)}else{const s=r.raycast(vo,this.material,i,n);for(let i=0,n=s.length;i<n;i++){const n=So(s[i],this,t);n&&e.push(n)}}}else Ao.call(this,t,e)}function Oo(t={}){return this.boundsTree=new wo(this,t),this.boundsTree}function Eo(){this.boundsTree=null}function ko(t,e,s=2){const i=t.length;let n=function(t,e,s,i,n){let r;if(n===function(t,e,s,i){let n=0;for(let r=e,o=s-i;r<s;r+=i)n+=(t[o]-t[r])*(t[r+1]+t[o+1]),o=r;return n}(t,e,s,i)>0)for(let n=e;n<s;n+=i)r=Ko(n/i|0,t[n],t[n+1],r);else for(let n=s-i;n>=e;n-=i)r=Ko(n/i|0,t[n],t[n+1],r);r&&Zo(r,r.next)&&(ta(r),r=r.next);return r}(t,0,i,s,!0);const r=[];if(!n||n.next===n.prev)return r;let o,a,h;if(t.length>80*s){o=1/0,a=1/0;let e=-1/0,n=-1/0;for(let r=s;r<i;r+=s){const s=t[r],i=t[r+1];s<o&&(o=s),i<a&&(a=i),s>e&&(e=s),i>n&&(n=i)}h=Math.max(e-o,n-a),h=0!==h?32767/h:0}return Ro(n,r,s,o,a,h,0),r}function Vo(t,e){if(!t)return t;e||(e=t);let s,i=t;do{if(s=!1,i.steiner||!Zo(i,i.next)&&0!==jo(i.prev,i,i.next))i=i.next;else{if(ta(i),i=e=i.prev,i===i.next)break;s=!0}}while(s||i!==e);return e}function Ro(t,e,s,i,n,r,o){if(!t)return;!o&&r&&function(t,e,s,i){let n=t;do{0===n.z&&(n.z=qo(n.x,n.y,e,s,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){let e,s=1;do{let i,n=t;t=null;let r=null;for(e=0;n;){e++;let o=n,a=0;for(let t=0;t<s&&(a++,o=o.nextZ,o);t++);let h=s;for(;a>0||h>0&&o;)0!==a&&(0===h||!o||n.z<=o.z)?(i=n,n=n.nextZ,a--):(i=o,o=o.nextZ,h--),r?r.nextZ=i:t=i,i.prevZ=r,r=i;n=o}r.nextZ=null,s*=2}while(e>1)}(n)}(t,i,n,r);let a=t;for(;t.prev!==t.next;){const h=t.prev,c=t.next;if(r?Do(t,i,n,r):Uo(t))e.push(h.i,t.i,c.i),ta(t),t=c.next,a=c.next;else if((t=c)===a){o?1===o?Ro(t=No(Vo(t),e),e,s,i,n,r,2):2===o&&Go(t,e,s,i,n,r):Ro(Vo(t),e,s,i,n,r,1);break}}}function Uo(t){const e=t.prev,s=t,i=t.next;if(jo(e,s,i)>=0)return!1;const n=e.x,r=s.x,o=i.x,a=e.y,h=s.y,c=i.y,l=Math.min(n,r,o),u=Math.min(a,h,c),d=Math.max(n,r,o),p=Math.max(a,h,c);let m=i.next;for(;m!==e;){if(m.x>=l&&m.x<=d&&m.y>=u&&m.y<=p&&Wo(n,a,r,h,o,c,m.x,m.y)&&jo(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Do(t,e,s,i){const n=t.prev,r=t,o=t.next;if(jo(n,r,o)>=0)return!1;const a=n.x,h=r.x,c=o.x,l=n.y,u=r.y,d=o.y,p=Math.min(a,h,c),m=Math.min(l,u,d),f=Math.max(a,h,c),g=Math.max(l,u,d),y=qo(p,m,e,s,i),b=qo(f,g,e,s,i);let x=t.prevZ,_=t.nextZ;for(;x&&x.z>=y&&_&&_.z<=b;){if(x.x>=p&&x.x<=f&&x.y>=m&&x.y<=g&&x!==n&&x!==o&&Wo(a,l,h,u,c,d,x.x,x.y)&&jo(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,_.x>=p&&_.x<=f&&_.y>=m&&_.y<=g&&_!==n&&_!==o&&Wo(a,l,h,u,c,d,_.x,_.y)&&jo(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;x&&x.z>=y;){if(x.x>=p&&x.x<=f&&x.y>=m&&x.y<=g&&x!==n&&x!==o&&Wo(a,l,h,u,c,d,x.x,x.y)&&jo(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;_&&_.z<=b;){if(_.x>=p&&_.x<=f&&_.y>=m&&_.y<=g&&_!==n&&_!==o&&Wo(a,l,h,u,c,d,_.x,_.y)&&jo(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function No(t,e){let s=t;do{const i=s.prev,n=s.next.next;!Zo(i,n)&&Yo(i,s,s.next,n)&&Qo(i,n)&&Qo(n,i)&&(e.push(i.i,s.i,n.i),ta(s),ta(s.next),s=t=n),s=s.next}while(s!==t);return Vo(s)}function Go(t,e,s,i,n,r){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&Ho(o,t)){let a=$o(o,t);return o=Vo(o,o.next),a=Vo(a,a.next),Ro(o,e,s,i,n,r,0),void Ro(a,e,s,i,n,r,0)}t=t.next}o=o.next}while(o!==t)}function qo(t,e,s,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Wo(t,e,s,i,n,r,o,a){return!(t===o&&e===a)&&function(t,e,s,i,n,r,o,a){return(n-o)*(e-a)>=(t-o)*(r-a)&&(t-o)*(i-a)>=(s-o)*(e-a)&&(s-o)*(r-a)>=(n-o)*(i-a)}(t,e,s,i,n,r,o,a)}function Ho(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==e.i&&s.next.i!==e.i&&Yo(s,s.next,t,e))return!0;s=s.next}while(s!==t);return!1}(t,e)&&(Qo(t,e)&&Qo(e,t)&&function(t,e){let s=t,i=!1;const n=(t.x+e.x)/2,r=(t.y+e.y)/2;do{s.y>r!=s.next.y>r&&s.next.y!==s.y&&n<(s.next.x-s.x)*(r-s.y)/(s.next.y-s.y)+s.x&&(i=!i),s=s.next}while(s!==t);return i}(t,e)&&(jo(t.prev,t,e.prev)||jo(t,e.prev,e))||Zo(t,e)&&jo(t.prev,t,t.next)>0&&jo(e.prev,e,e.next)>0)}function jo(t,e,s){return(e.y-t.y)*(s.x-e.x)-(e.x-t.x)*(s.y-e.y)}function Zo(t,e){return t.x===e.x&&t.y===e.y}function Yo(t,e,s,i){const n=Jo(jo(t,e,s)),r=Jo(jo(t,e,i)),o=Jo(jo(s,i,t)),a=Jo(jo(s,i,e));return n!==r&&o!==a||(!(0!==n||!Xo(t,s,e))||(!(0!==r||!Xo(t,i,e))||(!(0!==o||!Xo(s,t,i))||!(0!==a||!Xo(s,e,i)))))}function Xo(t,e,s){return e.x<=Math.max(t.x,s.x)&&e.x>=Math.min(t.x,s.x)&&e.y<=Math.max(t.y,s.y)&&e.y>=Math.min(t.y,s.y)}function Jo(t){return t>0?1:t<0?-1:0}function Qo(t,e){return jo(t.prev,t,t.next)<0?jo(t,e,t.next)>=0&&jo(t,t.prev,e)>=0:jo(t,e,t.prev)<0||jo(t,t.next,e)<0}function $o(t,e){const s=ea(t.i,t.x,t.y),i=ea(e.i,e.x,e.y),n=t.next,r=e.prev;return t.next=e,e.prev=t,s.next=n,n.prev=s,i.next=s,s.prev=i,r.next=i,i.prev=r,i}function Ko(t,e,s,i){const n=ea(t,e,s);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function ta(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ea(t,e,s){return{i:t,x:e,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class sa{constructor(){nt(this,"_inverseMatrix",new Be),nt(this,"_localPlane",new li),nt(this,"_tempLine",new ki),nt(this,"_tempVector",new Qt),nt(this,"_plane"),nt(this,"_plane2DCoordinateSystem",new Be),nt(this,"_precission",1e4),nt(this,"_planeAxis")}get plane(){if(!this._plane)throw new Error("Plane not set");return this._plane}set plane(t){this._plane=t}createEdges(t){const{meshes:e,posAttr:s}=t;let i=0;s.array.fill(0);const n=[];let r=0;const o=new Xs;for(const t of e)if(t.geometry){if(t.geometry.boundsTree||t.geometry.computeBoundsTree(),!t.geometry.boundsTree)throw new Error("Bounds tree not found for edges generation.");if(t instanceof oi){if(0===t.count)continue;const e=t;for(let a=0;a<e.count;a++){o.geometry=t.geometry,o.matrix.copy(t.matrix);const h=new Be;e.getMatrixAt(a,h),o.applyMatrix4(h),o.applyMatrix4(t.matrixWorld),o.updateMatrix(),o.updateMatrixWorld(),this._inverseMatrix.copy(o.matrixWorld).invert(),this._localPlane.copy(this.plane).applyMatrix4(this._inverseMatrix),i=this.shapecast(o,s,i),i!==r&&(n.push(i),r=i)}}else this._inverseMatrix.copy(t.matrixWorld).invert(),this._localPlane.copy(this.plane).applyMatrix4(this._inverseMatrix),i=this.shapecast(t,s,i),i!==r&&(n.push(i),r=i)}return{indexes:n,index:i}}createFills(t,e){this.updatePlane2DCoordinateSystem();const s=[];let i=0;for(let n=0;n<e.length;n++){const r=e[n],o=[];for(let t=i;t<r;t+=2)o.push(3*t);const a=this.computeFill(o,t);for(const t of a)s.push(t);i=r}return s}computeFill(t,e){const s=new Map,i={},n=new Map;let r=0;const o=new Map,a=new Map,h=new Set,c=this._precission;for(let l=0;l<t.length;l++){const u=t[l];let d=0,p=0,m=0,f=0;const g=e[u],y=e[u+1],b=e[u+2],x=e[u+3],_=e[u+4],w=e[u+5];if(this._tempVector.set(g,y,b),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),d=Math.trunc(this._tempVector.x*c)/c,p=Math.trunc(this._tempVector.y*c)/c,this._tempVector.set(x,_,w),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),m=Math.trunc(this._tempVector.x*c)/c,f=Math.trunc(this._tempVector.y*c)/c,d===m&&p===f)continue;const S=`${d}|${p}`,v=`${m}|${f}`;s.has(S)||s.set(S,u/3),s.has(v)||s.set(v,u/3+1);const M=s.get(S),I=s.get(v);i[M]=[d,p],i[I]=[m,f];const A=a.has(M),B=o.has(M),T=a.has(I),z=o.has(I);if(!(A||B||T||z))a.set(M,r),o.set(I,r),h.add(r),n.set(r,[M,I]),r++;else if(A&&z){const t=a.get(M),e=o.get(I);if(t!==e){const s=n.get(e),i=n.get(t);if(!s||!i)continue;n.delete(t),h.delete(t),o.set(i[i.length-1],e),o.delete(s[s.length-1]);for(const t of i)s.push(t)}else h.delete(e);a.delete(M),o.delete(I)}else if(B&&T){const t=a.get(I),e=o.get(M);if(t!==e){const s=n.get(e),i=n.get(t);if(!s||!i)continue;n.delete(t),h.delete(t),o.set(i[i.length-1],e),o.delete(s[s.length-1]);for(const t of i)s.push(t)}else h.delete(e);a.delete(I),o.delete(M)}else if(A&&T){const t=a.get(I),e=a.get(M),s=n.get(e),i=n.get(t);if(!s||!i)continue;n.delete(t),h.delete(t),a.delete(s[0]),a.delete(i[0]),o.delete(i[i.length-1]),a.set(i[i.length-1],e),i.reverse(),s.splice(0,0,...i)}else if(B&&z){const t=o.get(I),e=o.get(M),s=n.get(e),i=n.get(t);if(!s||!i)continue;n.delete(t),h.delete(t),o.delete(s[s.length-1]),o.delete(i[i.length-1]),a.delete(i[0]),o.set(i[0],e),i.reverse(),s.push(...i)}else if(A){const t=a.get(M),e=n.get(t);if(!e)continue;e.unshift(I),a.delete(M),a.set(I,t)}else if(B){const t=o.get(M),e=n.get(t);if(!e)continue;e.push(I),o.delete(M),o.set(I,t)}else if(T){const t=a.get(I),e=n.get(t);if(!e)continue;e.unshift(M),a.delete(I),a.set(M,t)}else if(z){const t=o.get(I),e=n.get(t);if(!e)continue;e.push(M),o.delete(I),o.set(M,t)}}const l=[];for(const[t,e]of n){if(h.has(t))continue;const s=[],n=new Map;let r=0;for(const t of e){const e=i[t];s.push(e[0],e[1]),n.set(r++,t)}const o=ko(s);for(const t of o){const e=n.get(t);if(void 0===e)throw new Error("Map error!");l.push(e)}}return l}updatePlane2DCoordinateSystem(){this._plane2DCoordinateSystem=new Be;const t=new Qt(1,0,0),e=new Qt(0,1,0),s=this.plane.normal,i=new Qt;this.plane.coplanarPoint(i),"x"===this._planeAxis?t.crossVectors(e,s):"y"===this._planeAxis?e.crossVectors(s,t):"z"===this._planeAxis||(t.crossVectors(e,s).normalize(),e.crossVectors(s,t)),this._plane2DCoordinateSystem.fromArray([t.x,t.y,t.z,0,e.x,e.y,e.z,0,s.x,s.y,s.z,0,i.x,i.y,i.z,1]),this._plane2DCoordinateSystem.invert()}shapecast(t,e,s){return t.geometry.boundsTree.shapecast({intersectsBounds:t=>this._localPlane.intersectsBox(t),intersectsTriangle:i=>{let n=0;if(this._tempLine.start.copy(i.a),this._tempLine.end.copy(i.b),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const i=this._tempVector.applyMatrix4(t.matrixWorld);e.setXYZ(s,i.x,i.y,i.z),n++,s++}if(this._tempLine.start.copy(i.b),this._tempLine.end.copy(i.c),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const i=this._tempVector.applyMatrix4(t.matrixWorld);e.setXYZ(s,i.x,i.y,i.z),n++,s++}if(this._tempLine.start.copy(i.c),this._tempLine.end.copy(i.a),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const i=this._tempVector.applyMatrix4(t.matrixWorld);e.setXYZ(s,i.x,i.y,i.z),n++,s++}2!==n&&(s-=n)}}),s}}const ia="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,na=new Set,ra="object"==typeof process&&process?process:{},oa=(t,e,s,i)=>{"function"==typeof ra.emitWarning?ra.emitWarning(t,e,s,i):console.error(`[${s}] ${e}: ${t}`)};let aa=globalThis.AbortController,ha=globalThis.AbortSignal;if(void 0===aa){ha=class{constructor(){nt(this,"onabort"),nt(this,"_onabort",[]),nt(this,"reason"),nt(this,"aborted",!1)}addEventListener(t,e){this._onabort.push(e)}},aa=class{constructor(){nt(this,"signal",new ha),s()}abort(t){var e,s;if(!this.signal.aborted){this.signal.reason=t,this.signal.aborted=!0;for(const e of this.signal._onabort)e(t);null==(s=(e=this.signal).onabort)||s.call(e,t)}}};let e="1"!==(null==(t=ra.env)?void 0:t.LRU_CACHE_IGNORE_AC_WARNING);const s=()=>{e&&(e=!1,oa("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",s))}}const ca=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),la=t=>ca(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?ua:null:null;class ua extends Array{constructor(t){super(t),this.fill(0)}}const da=class t{constructor(s,i){if(nt(this,"heap"),nt(this,"length"),!ot(t,e))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new i(s),this.length=0}static create(s){const i=la(s);if(!i)return[];ht(t,e,!0);const n=new t(s,i);return ht(t,e,!1),n}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}};e=new WeakMap,at(da,e,!1);let pa=da;const ma=class t{constructor(e){at(this,I),at(this,L),at(this,k),at(this,R),at(this,D),at(this,q),at(this,H),at(this,Z),at(this,X),at(this,Q),at(this,K),at(this,et),at(this,s,void 0),at(this,i,void 0),at(this,n,void 0),at(this,r,void 0),at(this,o,void 0),at(this,a,void 0),nt(this,"ttl"),nt(this,"ttlResolution"),nt(this,"ttlAutopurge"),nt(this,"updateAgeOnGet"),nt(this,"updateAgeOnHas"),nt(this,"allowStale"),nt(this,"noDisposeOnSet"),nt(this,"noUpdateTTL"),nt(this,"maxEntrySize"),nt(this,"sizeCalculation"),nt(this,"noDeleteOnFetchRejection"),nt(this,"noDeleteOnStaleGet"),nt(this,"allowStaleOnFetchAbort"),nt(this,"allowStaleOnFetchRejection"),nt(this,"ignoreFetchAbort"),at(this,h,void 0),at(this,c,void 0),at(this,l,void 0),at(this,u,void 0),at(this,d,void 0),at(this,p,void 0),at(this,m,void 0),at(this,f,void 0),at(this,g,void 0),at(this,y,void 0),at(this,b,void 0),at(this,x,void 0),at(this,_,void 0),at(this,w,void 0),at(this,S,void 0),at(this,v,void 0),at(this,M,void 0),at(this,B,(()=>{})),at(this,T,(()=>{})),at(this,z,(()=>{})),at(this,C,(()=>!1)),at(this,F,(t=>{})),at(this,O,((t,e,s)=>{})),at(this,E,((t,e,s,i)=>{if(s||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0})),nt(this,G,"LRUCache");const{max:V=0,ttl:U,ttlResolution:N=1,ttlAutopurge:W,updateAgeOnGet:j,updateAgeOnHas:Y,allowStale:J,dispose:$,disposeAfter:tt,noDisposeOnSet:st,noUpdateTTL:it,maxSize:rt=0,maxEntrySize:ct=0,sizeCalculation:ut,fetchMethod:dt,memoMethod:pt,noDeleteOnFetchRejection:mt,noDeleteOnStaleGet:ft,allowStaleOnFetchRejection:gt,allowStaleOnFetchAbort:yt,ignoreFetchAbort:bt}=e;if(0!==V&&!ca(V))throw new TypeError("max option must be a nonnegative integer");const xt=V?la(V):Array;if(!xt)throw new Error("invalid max value: "+V);if(ht(this,s,V),ht(this,i,rt),this.maxEntrySize=ct||ot(this,i),this.sizeCalculation=ut,this.sizeCalculation){if(!ot(this,i)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(void 0!==pt&&"function"!=typeof pt)throw new TypeError("memoMethod must be a function if defined");if(ht(this,a,pt),void 0!==dt&&"function"!=typeof dt)throw new TypeError("fetchMethod must be a function if specified");if(ht(this,o,dt),ht(this,v,!!dt),ht(this,l,new Map),ht(this,u,new Array(V).fill(void 0)),ht(this,d,new Array(V).fill(void 0)),ht(this,p,new xt(V)),ht(this,m,new xt(V)),ht(this,f,0),ht(this,g,0),ht(this,y,pa.create(V)),ht(this,h,0),ht(this,c,0),"function"==typeof $&&ht(this,n,$),"function"==typeof tt?(ht(this,r,tt),ht(this,b,[])):(ht(this,r,void 0),ht(this,b,void 0)),ht(this,S,!!ot(this,n)),ht(this,M,!!ot(this,r)),this.noDisposeOnSet=!!st,this.noUpdateTTL=!!it,this.noDeleteOnFetchRejection=!!mt,this.allowStaleOnFetchRejection=!!gt,this.allowStaleOnFetchAbort=!!yt,this.ignoreFetchAbort=!!bt,0!==this.maxEntrySize){if(0!==ot(this,i)&&!ca(ot(this,i)))throw new TypeError("maxSize must be a positive integer if specified");if(!ca(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");lt(this,L,P).call(this)}if(this.allowStale=!!J,this.noDeleteOnStaleGet=!!ft,this.updateAgeOnGet=!!j,this.updateAgeOnHas=!!Y,this.ttlResolution=ca(N)||0===N?N:1,this.ttlAutopurge=!!W,this.ttl=U||0,this.ttl){if(!ca(this.ttl))throw new TypeError("ttl must be a positive integer if specified");lt(this,I,A).call(this)}if(0===ot(this,s)&&0===this.ttl&&0===ot(this,i))throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!ot(this,s)&&!ot(this,i)){const e="LRU_CACHE_UNBOUNDED";if((t=>!na.has(t))(e)){na.add(e);oa("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,t)}}}static unsafeExposeInternals(t){return{starts:ot(t,_),ttls:ot(t,w),sizes:ot(t,x),keyMap:ot(t,l),keyList:ot(t,u),valList:ot(t,d),next:ot(t,p),prev:ot(t,m),get head(){return ot(t,f)},get tail(){return ot(t,g)},free:ot(t,y),isBackgroundFetch:e=>{var s;return lt(s=t,Z,Y).call(s,e)},backgroundFetch:(e,s,i,n)=>{var r;return lt(r=t,H,j).call(r,e,s,i,n)},moveToTail:e=>{var s;return lt(s=t,Q,$).call(s,e)},indexes:e=>{var s;return lt(s=t,k,V).call(s,e)},rindexes:e=>{var s;return lt(s=t,R,U).call(s,e)},isStale:e=>{var s;return ot(s=t,C).call(s,e)}}}get max(){return ot(this,s)}get maxSize(){return ot(this,i)}get calculatedSize(){return ot(this,c)}get size(){return ot(this,h)}get fetchMethod(){return ot(this,o)}get memoMethod(){return ot(this,a)}get dispose(){return ot(this,n)}get disposeAfter(){return ot(this,r)}getRemainingTTL(t){return ot(this,l).has(t)?1/0:0}*entries(){for(const t of lt(this,k,V).call(this))void 0===ot(this,d)[t]||void 0===ot(this,u)[t]||lt(this,Z,Y).call(this,ot(this,d)[t])||(yield[ot(this,u)[t],ot(this,d)[t]])}*rentries(){for(const t of lt(this,R,U).call(this))void 0===ot(this,d)[t]||void 0===ot(this,u)[t]||lt(this,Z,Y).call(this,ot(this,d)[t])||(yield[ot(this,u)[t],ot(this,d)[t]])}*keys(){for(const t of lt(this,k,V).call(this)){const e=ot(this,u)[t];void 0===e||lt(this,Z,Y).call(this,ot(this,d)[t])||(yield e)}}*rkeys(){for(const t of lt(this,R,U).call(this)){const e=ot(this,u)[t];void 0===e||lt(this,Z,Y).call(this,ot(this,d)[t])||(yield e)}}*values(){for(const t of lt(this,k,V).call(this)){void 0===ot(this,d)[t]||lt(this,Z,Y).call(this,ot(this,d)[t])||(yield ot(this,d)[t])}}*rvalues(){for(const t of lt(this,R,U).call(this)){void 0===ot(this,d)[t]||lt(this,Z,Y).call(this,ot(this,d)[t])||(yield ot(this,d)[t])}}[Symbol.iterator](){return this.entries()}find(t,e={}){for(const s of lt(this,k,V).call(this)){const i=ot(this,d)[s],n=lt(this,Z,Y).call(this,i)?i.__staleWhileFetching:i;if(void 0!==n&&t(n,ot(this,u)[s],this))return this.get(ot(this,u)[s],e)}}forEach(t,e=this){for(const s of lt(this,k,V).call(this)){const i=ot(this,d)[s],n=lt(this,Z,Y).call(this,i)?i.__staleWhileFetching:i;void 0!==n&&t.call(e,n,ot(this,u)[s],this)}}rforEach(t,e=this){for(const s of lt(this,R,U).call(this)){const i=ot(this,d)[s],n=lt(this,Z,Y).call(this,i)?i.__staleWhileFetching:i;void 0!==n&&t.call(e,n,ot(this,u)[s],this)}}purgeStale(){let t=!1;for(const e of lt(this,R,U).call(this,{allowStale:!0}))ot(this,C).call(this,e)&&(lt(this,K,tt).call(this,ot(this,u)[e],"expire"),t=!0);return t}info(t){const e=ot(this,l).get(t);if(void 0===e)return;const s=ot(this,d)[e],i=lt(this,Z,Y).call(this,s)?s.__staleWhileFetching:s;if(void 0===i)return;const n={value:i};if(ot(this,w)&&ot(this,_)){const t=ot(this,w)[e],s=ot(this,_)[e];if(t&&s){const e=t-(ia.now()-s);n.ttl=e,n.start=Date.now()}}return ot(this,x)&&(n.size=ot(this,x)[e]),n}dump(){const t=[];for(const e of lt(this,k,V).call(this,{allowStale:!0})){const s=ot(this,u)[e],i=ot(this,d)[e],n=lt(this,Z,Y).call(this,i)?i.__staleWhileFetching:i;if(void 0===n||void 0===s)continue;const r={value:n};if(ot(this,w)&&ot(this,_)){r.ttl=ot(this,w)[e];const t=ia.now()-ot(this,_)[e];r.start=Math.floor(Date.now()-t)}ot(this,x)&&(r.size=ot(this,x)[e]),t.unshift([s,r])}return t}load(t){this.clear();for(const[e,s]of t){if(s.start){const t=Date.now()-s.start;s.start=ia.now()-t}this.set(e,s.value,s)}}set(t,e,i={}){var o,a,c,f,x;if(void 0===e)return this.delete(t),this;const{ttl:_=this.ttl,start:B,noDisposeOnSet:C=this.noDisposeOnSet,sizeCalculation:L=this.sizeCalculation,status:P}=i;let{noUpdateTTL:k=this.noUpdateTTL}=i;const V=ot(this,E).call(this,t,e,i.size||0,L);if(this.maxEntrySize&&V>this.maxEntrySize)return P&&(P.set="miss",P.maxEntrySizeExceeded=!0),lt(this,K,tt).call(this,t,"set"),this;let R=0===ot(this,h)?void 0:ot(this,l).get(t);if(void 0===R)R=0===ot(this,h)?ot(this,g):0!==ot(this,y).length?ot(this,y).pop():ot(this,h)===ot(this,s)?lt(this,q,W).call(this,!1):ot(this,h),ot(this,u)[R]=t,ot(this,d)[R]=e,ot(this,l).set(t,R),ot(this,p)[ot(this,g)]=R,ot(this,m)[R]=ot(this,g),ht(this,g,R),ct(this,h)._++,ot(this,O).call(this,R,V,P),P&&(P.set="add"),k=!1;else{lt(this,Q,$).call(this,R);const s=ot(this,d)[R];if(e!==s){if(ot(this,v)&&lt(this,Z,Y).call(this,s)){s.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:e}=s;void 0===e||C||(ot(this,S)&&(null==(o=ot(this,n))||o.call(this,e,t,"set")),ot(this,M)&&(null==(a=ot(this,b))||a.push([e,t,"set"])))}else C||(ot(this,S)&&(null==(c=ot(this,n))||c.call(this,s,t,"set")),ot(this,M)&&(null==(f=ot(this,b))||f.push([s,t,"set"])));if(ot(this,F).call(this,R),ot(this,O).call(this,R,V,P),ot(this,d)[R]=e,P){P.set="replace";const t=s&&lt(this,Z,Y).call(this,s)?s.__staleWhileFetching:s;void 0!==t&&(P.oldValue=t)}}else P&&(P.set="update")}if(0===_||ot(this,w)||lt(this,I,A).call(this),ot(this,w)&&(k||ot(this,z).call(this,R,_,B),P&&ot(this,T).call(this,P,R)),!C&&ot(this,M)&&ot(this,b)){const t=ot(this,b);let e;for(;e=null==t?void 0:t.shift();)null==(x=ot(this,r))||x.call(this,...e)}return this}pop(){var t;try{for(;ot(this,h);){const t=ot(this,d)[ot(this,f)];if(lt(this,q,W).call(this,!0),lt(this,Z,Y).call(this,t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(void 0!==t)return t}}finally{if(ot(this,M)&&ot(this,b)){const e=ot(this,b);let s;for(;s=null==e?void 0:e.shift();)null==(t=ot(this,r))||t.call(this,...s)}}}has(t,e={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:i}=e,n=ot(this,l).get(t);if(void 0!==n){const t=ot(this,d)[n];if(lt(this,Z,Y).call(this,t)&&void 0===t.__staleWhileFetching)return!1;if(!ot(this,C).call(this,n))return s&&ot(this,B).call(this,n),i&&(i.has="hit",ot(this,T).call(this,i,n)),!0;i&&(i.has="stale",ot(this,T).call(this,i,n))}else i&&(i.has="miss");return!1}peek(t,e={}){const{allowStale:s=this.allowStale}=e,i=ot(this,l).get(t);if(void 0===i||!s&&ot(this,C).call(this,i))return;const n=ot(this,d)[i];return lt(this,Z,Y).call(this,n)?n.__staleWhileFetching:n}async fetch(t,e={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,ttl:r=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:a=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:c=this.noUpdateTTL,noDeleteOnFetchRejection:u=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:p=this.allowStaleOnFetchRejection,ignoreFetchAbort:m=this.ignoreFetchAbort,allowStaleOnFetchAbort:f=this.allowStaleOnFetchAbort,context:g,forceRefresh:y=!1,status:b,signal:x}=e;if(!ot(this,v))return b&&(b.fetch="get"),this.get(t,{allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:n,status:b});const _={allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:n,ttl:r,noDisposeOnSet:o,size:a,sizeCalculation:h,noUpdateTTL:c,noDeleteOnFetchRejection:u,allowStaleOnFetchRejection:p,allowStaleOnFetchAbort:f,ignoreFetchAbort:m,status:b,signal:x};let w=ot(this,l).get(t);if(void 0===w){b&&(b.fetch="miss");const e=lt(this,H,j).call(this,t,w,_,g);return e.__returned=e}{const e=ot(this,d)[w];if(lt(this,Z,Y).call(this,e)){const t=s&&void 0!==e.__staleWhileFetching;return b&&(b.fetch="inflight",t&&(b.returnedStale=!0)),t?e.__staleWhileFetching:e.__returned=e}const n=ot(this,C).call(this,w);if(!y&&!n)return b&&(b.fetch="hit"),lt(this,Q,$).call(this,w),i&&ot(this,B).call(this,w),b&&ot(this,T).call(this,b,w),e;const r=lt(this,H,j).call(this,t,w,_,g),o=void 0!==r.__staleWhileFetching&&s;return b&&(b.fetch=n?"stale":"refresh",o&&n&&(b.returnedStale=!0)),o?r.__staleWhileFetching:r.__returned=r}}async forceFetch(t,e={}){const s=await this.fetch(t,e);if(void 0===s)throw new Error("fetch() returned undefined");return s}memo(t,e={}){const s=ot(this,a);if(!s)throw new Error("no memoMethod provided to constructor");const{context:i,forceRefresh:n,...r}=e,o=this.get(t,r);if(!n&&void 0!==o)return o;const h=s(t,o,{options:r,context:i});return this.set(t,h,r),h}get(t,e={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:n=this.noDeleteOnStaleGet,status:r}=e,o=ot(this,l).get(t);if(void 0!==o){const e=ot(this,d)[o],a=lt(this,Z,Y).call(this,e);return r&&ot(this,T).call(this,r,o),ot(this,C).call(this,o)?(r&&(r.get="stale"),a?(r&&s&&void 0!==e.__staleWhileFetching&&(r.returnedStale=!0),s?e.__staleWhileFetching:void 0):(n||lt(this,K,tt).call(this,t,"expire"),r&&s&&(r.returnedStale=!0),s?e:void 0)):(r&&(r.get="hit"),a?e.__staleWhileFetching:(lt(this,Q,$).call(this,o),i&&ot(this,B).call(this,o),e))}r&&(r.get="miss")}delete(t){return lt(this,K,tt).call(this,t,"delete")}clear(){return lt(this,et,st).call(this,"delete")}};G=Symbol.toStringTag,s=new WeakMap,i=new WeakMap,n=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap,h=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap,m=new WeakMap,f=new WeakMap,g=new WeakMap,y=new WeakMap,b=new WeakMap,x=new WeakMap,_=new WeakMap,w=new WeakMap,S=new WeakMap,v=new WeakMap,M=new WeakMap,I=new WeakSet,A=function(){const t=new ua(ot(this,s)),e=new ua(ot(this,s));ht(this,w,t),ht(this,_,e),ht(this,z,((s,i,n=ia.now())=>{if(e[s]=0!==i?n:0,t[s]=i,0!==i&&this.ttlAutopurge){const t=setTimeout((()=>{ot(this,C).call(this,s)&&lt(this,K,tt).call(this,ot(this,u)[s],"expire")}),i+1);t.unref&&t.unref()}})),ht(this,B,(s=>{e[s]=0!==t[s]?ia.now():0})),ht(this,T,((s,r)=>{if(t[r]){const o=t[r],a=e[r];if(!o||!a)return;s.ttl=o,s.start=a,s.now=i||n();const h=s.now-a;s.remainingTTL=o-h}}));let i=0;const n=()=>{const t=ia.now();if(this.ttlResolution>0){i=t;const e=setTimeout((()=>i=0),this.ttlResolution);e.unref&&e.unref()}return t};this.getRemainingTTL=s=>{const r=ot(this,l).get(s);if(void 0===r)return 0;const o=t[r],a=e[r];if(!o||!a)return 1/0;return o-((i||n())-a)},ht(this,C,(s=>{const r=e[s],o=t[s];return!!o&&!!r&&(i||n())-r>o}))},B=new WeakMap,T=new WeakMap,z=new WeakMap,C=new WeakMap,L=new WeakSet,P=function(){const t=new ua(ot(this,s));ht(this,c,0),ht(this,x,t),ht(this,F,(e=>{ht(this,c,ot(this,c)-t[e]),t[e]=0})),ht(this,E,((t,e,s,i)=>{if(lt(this,Z,Y).call(this,e))return 0;if(!ca(s)){if(!i)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof i)throw new TypeError("sizeCalculation must be a function");if(s=i(e,t),!ca(s))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return s})),ht(this,O,((e,s,n)=>{if(t[e]=s,ot(this,i)){const s=ot(this,i)-t[e];for(;ot(this,c)>s;)lt(this,q,W).call(this,!0)}ht(this,c,ot(this,c)+t[e]),n&&(n.entrySize=s,n.totalCalculatedSize=ot(this,c))}))},F=new WeakMap,O=new WeakMap,E=new WeakMap,k=new WeakSet,V=function*({allowStale:t=this.allowStale}={}){if(ot(this,h))for(let e=ot(this,g);lt(this,D,N).call(this,e)&&(!t&&ot(this,C).call(this,e)||(yield e),e!==ot(this,f));)e=ot(this,m)[e]},R=new WeakSet,U=function*({allowStale:t=this.allowStale}={}){if(ot(this,h))for(let e=ot(this,f);lt(this,D,N).call(this,e)&&(!t&&ot(this,C).call(this,e)||(yield e),e!==ot(this,g));)e=ot(this,p)[e]},D=new WeakSet,N=function(t){return void 0!==t&&ot(this,l).get(ot(this,u)[t])===t},q=new WeakSet,W=function(t){var e,s;const i=ot(this,f),r=ot(this,u)[i],o=ot(this,d)[i];return ot(this,v)&&lt(this,Z,Y).call(this,o)?o.__abortController.abort(new Error("evicted")):(ot(this,S)||ot(this,M))&&(ot(this,S)&&(null==(e=ot(this,n))||e.call(this,o,r,"evict")),ot(this,M)&&(null==(s=ot(this,b))||s.push([o,r,"evict"]))),ot(this,F).call(this,i),t&&(ot(this,u)[i]=void 0,ot(this,d)[i]=void 0,ot(this,y).push(i)),1===ot(this,h)?(ht(this,f,ht(this,g,0)),ot(this,y).length=0):ht(this,f,ot(this,p)[i]),ot(this,l).delete(r),ct(this,h)._--,i},H=new WeakSet,j=function(t,e,s,i){const n=void 0===e?void 0:ot(this,d)[e];if(lt(this,Z,Y).call(this,n))return n;const r=new aa,{signal:a}=s;null==a||a.addEventListener("abort",(()=>r.abort(a.reason)),{signal:r.signal});const h={signal:r.signal,options:s,context:i},c=(i,n=!1)=>{const{aborted:o}=r.signal,a=s.ignoreFetchAbort&&void 0!==i;if(s.status&&(o&&!n?(s.status.fetchAborted=!0,s.status.fetchError=r.signal.reason,a&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),o&&!a&&!n)return u(r.signal.reason);const c=p;return ot(this,d)[e]===p&&(void 0===i?c.__staleWhileFetching?ot(this,d)[e]=c.__staleWhileFetching:lt(this,K,tt).call(this,t,"fetch"):(s.status&&(s.status.fetchUpdated=!0),this.set(t,i,h.options))),i},u=i=>{const{aborted:n}=r.signal,o=n&&s.allowStaleOnFetchAbort,a=o||s.allowStaleOnFetchRejection,h=a||s.noDeleteOnFetchRejection,c=p;if(ot(this,d)[e]===p){!h||void 0===c.__staleWhileFetching?lt(this,K,tt).call(this,t,"fetch"):o||(ot(this,d)[e]=c.__staleWhileFetching)}if(a)return s.status&&void 0!==c.__staleWhileFetching&&(s.status.returnedStale=!0),c.__staleWhileFetching;if(c.__returned===c)throw i};s.status&&(s.status.fetchDispatched=!0);const p=new Promise(((e,i)=>{var a;const l=null==(a=ot(this,o))?void 0:a.call(this,t,n,h);l&&l instanceof Promise&&l.then((t=>e(void 0===t?void 0:t)),i),r.signal.addEventListener("abort",(()=>{s.ignoreFetchAbort&&!s.allowStaleOnFetchAbort||(e(void 0),s.allowStaleOnFetchAbort&&(e=t=>c(t,!0)))}))})).then(c,(t=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=t),u(t)))),m=Object.assign(p,{__abortController:r,__staleWhileFetching:n,__returned:void 0});return void 0===e?(this.set(t,m,{...h.options,status:void 0}),e=ot(this,l).get(t)):ot(this,d)[e]=m,m},Z=new WeakSet,Y=function(t){if(!ot(this,v))return!1;const e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof aa},X=new WeakSet,J=function(t,e){ot(this,m)[e]=t,ot(this,p)[t]=e},Q=new WeakSet,$=function(t){t!==ot(this,g)&&(t===ot(this,f)?ht(this,f,ot(this,p)[t]):lt(this,X,J).call(this,ot(this,m)[t],ot(this,p)[t]),lt(this,X,J).call(this,ot(this,g),t),ht(this,g,t))},K=new WeakSet,tt=function(t,e){var s,i,o,a;let c=!1;if(0!==ot(this,h)){const r=ot(this,l).get(t);if(void 0!==r)if(c=!0,1===ot(this,h))lt(this,et,st).call(this,e);else{ot(this,F).call(this,r);const o=ot(this,d)[r];if(lt(this,Z,Y).call(this,o)?o.__abortController.abort(new Error("deleted")):(ot(this,S)||ot(this,M))&&(ot(this,S)&&(null==(s=ot(this,n))||s.call(this,o,t,e)),ot(this,M)&&(null==(i=ot(this,b))||i.push([o,t,e]))),ot(this,l).delete(t),ot(this,u)[r]=void 0,ot(this,d)[r]=void 0,r===ot(this,g))ht(this,g,ot(this,m)[r]);else if(r===ot(this,f))ht(this,f,ot(this,p)[r]);else{const t=ot(this,m)[r];ot(this,p)[t]=ot(this,p)[r];const e=ot(this,p)[r];ot(this,m)[e]=ot(this,m)[r]}ct(this,h)._--,ot(this,y).push(r)}}if(ot(this,M)&&(null==(o=ot(this,b))?void 0:o.length)){const t=ot(this,b);let e;for(;e=null==t?void 0:t.shift();)null==(a=ot(this,r))||a.call(this,...e)}return c},et=new WeakSet,st=function(t){var e,s,i;for(const i of lt(this,R,U).call(this,{allowStale:!0})){const r=ot(this,d)[i];if(lt(this,Z,Y).call(this,r))r.__abortController.abort(new Error("deleted"));else{const o=ot(this,u)[i];ot(this,S)&&(null==(e=ot(this,n))||e.call(this,r,o,t)),ot(this,M)&&(null==(s=ot(this,b))||s.push([r,o,t]))}}if(ot(this,l).clear(),ot(this,d).fill(void 0),ot(this,u).fill(void 0),ot(this,w)&&ot(this,_)&&(ot(this,w).fill(0),ot(this,_).fill(0)),ot(this,x)&&ot(this,x).fill(0),ht(this,f,0),ht(this,g,0),ot(this,y).length=0,ht(this,c,0),ht(this,h,0),ot(this,M)&&ot(this,b)){const t=ot(this,b);let e;for(;e=null==t?void 0:t.shift();)null==(i=ot(this,r))||i.call(this,...e)}};let fa=ma;const ga=class t{constructor(){nt(this,"intPlaceholder",new Int32Array(1)),nt(this,"floatPlaceholder",new Float32Array(this.intPlaceholder.buffer)),nt(this,"bytes",new Uint8Array(this.intPlaceholder.buffer)),nt(this,"crc",-1)}add(e){switch(typeof e){case"number":Number.isInteger(e)&&e<t.MAX_INT32&&e>t.MIN_INT32?this.intPlaceholder[0]=e:this.floatPlaceholder[0]=e,this.compute();break;case"boolean":this.intPlaceholder[0]=e?1:0,this.compute();break;case"string":for(let t=0;t<e.length;++t)this.intPlaceholder[0]=e.codePointAt(t),this.compute();break;case"object":for(const t in e)e.hasOwnProperty(t)&&this.add(e[t])}return this}get(){return~this.crc}clear(){return this.crc=-1,this}compute(){for(let e=0;e<4;++e){this.crc^=this.bytes[e];for(let e=0;e<8;++e)this.crc=1&this.crc?this.crc>>1^t.POLY:this.crc>>1}}};nt(ga,"POLY",2197175160),nt(ga,"MAX_INT32",2147483647),nt(ga,"MIN_INT32",-2147483648);let ya=ga;const ba=class t{constructor(t,e){nt(this,"startRange"),this.startRange={start:0,count:t,prev:null,next:null,value:e}}getRange(t){let e=this.startRange;for(;;){if(null===e||e.start<=t&&t<e.start+e.count)return e;e=e.next}}createRangeNode(e,s,i){if(!t.rangeNodeCache.length)return{start:e,count:s,prev:null,next:null,value:i};const n=t.rangeNodeCache.pop();return n.start=e,n.count=s,n.value=i,n}disposeRangeNode(e){e&&(e.next=null,e.prev=null,t.rangeNodeCache.push(e))}set(t,e){const s=this.getRange(t);if(s.value===e)return;const i=this.createRangeNode(s.start,t-s.start,s.value),n=this.createRangeNode(t,1,e),r=this.createRangeNode(t+1,s.count-i.count-1,s.value);if(s.prev?(s.prev.next=i,i.prev=s.prev):this.startRange=i,s.next&&(s.next.prev=r,r.next=s.next),this.disposeRangeNode(s),i.next=n,n.prev=i,n.next=r,r.prev=n,i.count||(i.prev?i.prev.next=n:this.startRange=n,n.prev=i.prev,this.disposeRangeNode(i)),r.count||(r.next&&(r.next.prev=n),n.next=r.next,this.disposeRangeNode(r)),n.prev&&n.prev.value===n.value){n.count=n.prev.count+n.count,n.start=n.prev.start;const t=n.prev.prev;this.disposeRangeNode(n.prev),n.prev=t,n.prev?n.prev.next=n:this.startRange=n}if(n.next&&n.next.value===n.value){n.count=n.next.count+n.count;const t=n.next.next;this.disposeRangeNode(n.next),n.next=t,n.next&&(n.next.prev=n)}}collect(t){const e=[];let s=this.startRange;for(;null!==s;)t&&!t(s.value)||e.push(s),s=s.next;return e}count(t){let e=0,s=this.startRange;for(;null!==s;)t&&!t(s.value)||++e,s=s.next;return e}all(t){return null===this.startRange.next&&this.startRange.value===t}};nt(ba,"rangeNodeCache",[]);let xa=ba;function _a(t,e,s){s||(s={start:0,count:0});const i=t.start+t.count===e.length;return s.start=e[t.start],s.count=i?1/0:e[t.start+t.count]-s.start,s}const wa=(()=>{const t={start:0,count:0};return(e,s,i,n)=>{const r=e.collect(i),o=new Uint32Array(r.length),a=new Uint32Array(r.length);for(let e=0;e<r.length;++e){const i=r[e];_a(i,s,t),o[e]=t.start,a[e]=t.count===1/0?4294967295:t.count,n&&n(e,i.value)}return{starts:o,counts:a}}})(),Sa=class t{static transformFrustum(t,e,s=new pi){for(let i=0;i<s.planes.length;i++)s.planes[i].copy(t.planes[i]).applyMatrix4(e);return s}static planesIntersectBox(e,s){return t.planesIntersectBoxInternal(e,s,!1)}static planesContainBox(e,s){return t.planesIntersectBoxInternal(e,s,!0)}static insideNonIntersectingPlanes(t,e){let s=!0;for(const i of e)s=s&&i.distanceToPoint(t)>=0;return s}};nt(Sa,"planesIntersectBoxInternal",(()=>{const t=new Qt;return(e,s,i)=>{for(let n=0,r=e.length;n<r;n++){const r=e[n].normal;if(t.set(r.x>=0!==i?s.max.x:s.min.x,r.y>=0!==i?s.max.y:s.min.y,r.z>=0!==i?s.max.z:s.min.z),e[n].distanceToPoint(t)<0)return!1}return!0}})());let va=Sa;class Ma{constructor(){nt(this,"textDecoder",new TextDecoder)}decode(t,e){return t=t instanceof Uint8Array&&"undefined"!=typeof SharedArrayBuffer&&t.buffer instanceof SharedArrayBuffer?new Uint8Array(t):t,this.textDecoder.decode(t,e)}}class Ia{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}x(){return this.bb.readFloat32(this.bb_pos)}mutate_x(t){return this.bb.writeFloat32(this.bb_pos+0,t),!0}y(){return this.bb.readFloat32(this.bb_pos+4)}mutate_y(t){return this.bb.writeFloat32(this.bb_pos+4,t),!0}z(){return this.bb.readFloat32(this.bb_pos+8)}mutate_z(t){return this.bb.writeFloat32(this.bb_pos+8,t),!0}static sizeOf(){return 12}static createVecf(t,e,s,i){return t.prep(4,12),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}}let Aa=class{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}min(t){return(t||new Ia).__init(this.bb_pos,this.bb)}max(t){return(t||new Ia).__init(this.bb_pos+12,this.bb)}static sizeOf(){return 24}static createAABB(t,e,s,i,n,r,o){return t.prep(4,24),t.prep(4,12),t.writeFloat32(o),t.writeFloat32(r),t.writeFloat32(n),t.prep(4,12),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}};class Ba{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}center(t){return(t||new Ia).__init(this.bb_pos,this.bb)}axis(t){return(t||new Ia).__init(this.bb_pos+12,this.bb)}refDirection(t){return(t||new Ia).__init(this.bb_pos+24,this.bb)}radius(){return this.bb.readFloat32(this.bb_pos+36)}mutate_radius(t){return this.bb.writeFloat32(this.bb_pos+36,t),!0}angle(){return this.bb.readFloat32(this.bb_pos+40)}mutate_angle(t){return this.bb.writeFloat32(this.bb_pos+40,t),!0}static sizeOf(){return 44}static createArc(t,e,s,i,n,r,o,a,h,c,l,u){return t.prep(4,44),t.writeFloat32(u),t.writeFloat32(l),t.prep(4,12),t.writeFloat32(c),t.writeFloat32(h),t.writeFloat32(a),t.prep(4,12),t.writeFloat32(o),t.writeFloat32(r),t.writeFloat32(n),t.prep(4,12),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}}class Ta{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsAttribute(t,e){return(e||new Ta).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsAttribute(t,e){return t.setPosition(t.position()+4),(e||new Ta).__init(t.readInt32(t.position())+t.position(),t)}data(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}dataLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startAttribute(t){t.startObject(1)}static addData(t,e){t.addFieldOffset(0,e,0)}static createDataVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startDataVector(t,e){t.startVector(4,e,4)}static endAttribute(t){const e=t.endObject();return t.requiredField(e,4),e}static createAttribute(t,e){return Ta.startAttribute(t),Ta.addData(t,e),Ta.endAttribute(t)}}class za{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}start(t){return(t||new Ia).__init(this.bb_pos,this.bb)}end(t){return(t||new Ia).__init(this.bb_pos+12,this.bb)}static sizeOf(){return 24}static createLine(t,e,s,i,n,r,o){return t.prep(4,24),t.prep(4,12),t.writeFloat32(o),t.writeFloat32(r),t.writeFloat32(n),t.prep(4,12),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}}class Ca{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsPolyline(t,e){return(e||new Ca).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsPolyline(t,e){return t.setPosition(t.position()+4),(e||new Ca).__init(t.readInt32(t.position())+t.position(),t)}points(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?(e||new Ia).__init(this.bb.__vector(this.bb_pos+s)+12*t,this.bb):null}pointsLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startPolyline(t){t.startObject(1)}static addPoints(t,e){t.addFieldOffset(0,e,0)}static startPointsVector(t,e){t.startVector(12,e,4)}static endPolyline(t){return t.endObject()}static createPolyline(t,e){return Ca.startPolyline(t),Ca.addPoints(t,e),Ca.endPolyline(t)}}class La{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsAxis(t,e){return(e||new La).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsAxis(t,e){return t.setPosition(t.position()+4),(e||new La).__init(t.readInt32(t.position())+t.position(),t)}types(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt8(this.bb.__vector(this.bb_pos+e)+t):0}typesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}typesArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Int8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}indexes(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}indexesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}indexesArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}lines(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new za).__init(this.bb.__vector(this.bb_pos+s)+24*t,this.bb):null}linesLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}polyLines(t,e){const s=this.bb.__offset(this.bb_pos,10);return s?(e||new Ca).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}polyLinesLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}arcs(t,e){const s=this.bb.__offset(this.bb_pos,12);return s?(e||new Ba).__init(this.bb.__vector(this.bb_pos+s)+44*t,this.bb):null}arcsLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startAxis(t){t.startObject(5)}static addTypes(t,e){t.addFieldOffset(0,e,0)}static createTypesVector(t,e){t.startVector(1,e.length,1);for(let s=e.length-1;s>=0;s--)t.addInt8(e[s]);return t.endVector()}static startTypesVector(t,e){t.startVector(1,e,1)}static addIndexes(t,e){t.addFieldOffset(1,e,0)}static createIndexesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startIndexesVector(t,e){t.startVector(4,e,4)}static addLines(t,e){t.addFieldOffset(2,e,0)}static startLinesVector(t,e){t.startVector(24,e,4)}static addPolyLines(t,e){t.addFieldOffset(3,e,0)}static createPolyLinesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startPolyLinesVector(t,e){t.startVector(4,e,4)}static addArcs(t,e){t.addFieldOffset(4,e,0)}static startArcsVector(t,e){t.startVector(44,e,4)}static endAxis(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,10),t.requiredField(e,12),e}static createAxis(t,e,s,i,n,r){return La.startAxis(t),La.addTypes(t,e),La.addIndexes(t,s),La.addLines(t,i),La.addPolyLines(t,n),La.addArcs(t,r),La.endAxis(t)}}class Pa{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}localTransformId(){return this.bb.readUint32(this.bb_pos)}mutate_local_transform_id(t){return this.bb.writeUint32(this.bb_pos+0,t),!0}itemId(){return this.bb.readUint32(this.bb_pos+4)}mutate_item_id(t){return this.bb.writeUint32(this.bb_pos+4,t),!0}representationId(){return this.bb.readUint32(this.bb_pos+8)}mutate_representation_id(t){return this.bb.writeUint32(this.bb_pos+8,t),!0}materialId(){return this.bb.readUint32(this.bb_pos+12)}mutate_material_id(t){return this.bb.writeUint32(this.bb_pos+12,t),!0}static sizeOf(){return 16}static createInstance(t,e,s,i,n){return t.prep(4,16),t.writeInt32(n),t.writeInt32(i),t.writeInt32(s),t.writeInt32(e),t.offset()}}class Fa{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}r(){return this.bb.readUint8(this.bb_pos)}mutate_r(t){return this.bb.writeUint8(this.bb_pos+0,t),!0}g(){return this.bb.readUint8(this.bb_pos+1)}mutate_g(t){return this.bb.writeUint8(this.bb_pos+1,t),!0}b(){return this.bb.readUint8(this.bb_pos+2)}mutate_b(t){return this.bb.writeUint8(this.bb_pos+2,t),!0}a(){return this.bb.readUint8(this.bb_pos+3)}mutate_a(t){return this.bb.writeUint8(this.bb_pos+3,t),!0}sidedness(){return this.bb.readInt8(this.bb_pos+4)}mutate_sidedness(t){return this.bb.writeInt8(this.bb_pos+4,t),!0}lineType(){return this.bb.readInt8(this.bb_pos+5)}mutate_line_type(t){return this.bb.writeInt8(this.bb_pos+5,t),!0}static sizeOf(){return 6}static createMaterial(t,e,s,i,n,r,o){return t.prep(1,6),t.writeInt8(o),t.writeInt8(r),t.writeInt8(n),t.writeInt8(i),t.writeInt8(s),t.writeInt8(e),t.offset()}}class Oa{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}type(){return this.bb.readInt8(this.bb_pos)}mutate_type(t){return this.bb.writeInt8(this.bb_pos+0,t),!0}index(){return this.bb.readUint32(this.bb_pos+4)}mutate_index(t){return this.bb.writeUint32(this.bb_pos+4,t),!0}boundingBox(t){return(t||new Aa).__init(this.bb_pos+8,this.bb)}static sizeOf(){return 32}static createRepresentation(t,e,s,i,n,r,o,a,h){return t.prep(4,32),t.prep(4,24),t.prep(4,12),t.writeFloat32(h),t.writeFloat32(a),t.writeFloat32(o),t.prep(4,12),t.writeFloat32(r),t.writeFloat32(n),t.writeFloat32(i),t.writeInt32(s),t.pad(3),t.writeInt8(e),t.offset()}}class Ea{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShellHole(t,e){return(e||new Ea).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShellHole(t,e){return t.setPosition(t.position()+4),(e||new Ea).__init(t.readInt32(t.position())+t.position(),t)}profile(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint16(this.bb_pos+t):0}mutate_profile(t){const e=this.bb.__offset(this.bb_pos,4);return 0!==e&&(this.bb.writeUint16(this.bb_pos+e,t),!0)}indices(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0}indicesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}indicesArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startShellHole(t){t.startObject(2)}static addProfile(t,e){t.addFieldInt16(0,e,0)}static addIndices(t,e){t.addFieldOffset(1,e,0)}static createIndicesVector(t,e){t.startVector(2,e.length,2);for(let s=e.length-1;s>=0;s--)t.addInt16(e[s]);return t.endVector()}static startIndicesVector(t,e){t.startVector(2,e,2)}static endShellHole(t){const e=t.endObject();return t.requiredField(e,6),e}static createShellHole(t,e,s){return Ea.startShellHole(t),Ea.addProfile(t,e),Ea.addIndices(t,s),Ea.endShellHole(t)}}class ka{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShellProfile(t,e){return(e||new ka).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShellProfile(t,e){return t.setPosition(t.position()+4),(e||new ka).__init(t.readInt32(t.position())+t.position(),t)}indices(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0}indicesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}indicesArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startShellProfile(t){t.startObject(1)}static addIndices(t,e){t.addFieldOffset(0,e,0)}static createIndicesVector(t,e){t.startVector(2,e.length,2);for(let s=e.length-1;s>=0;s--)t.addInt16(e[s]);return t.endVector()}static startIndicesVector(t,e){t.startVector(2,e,2)}static endShellProfile(t){const e=t.endObject();return t.requiredField(e,4),e}static createShellProfile(t,e){return ka.startShellProfile(t),ka.addIndices(t,e),ka.endShellProfile(t)}}class Va{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShell(t,e){return(e||new Va).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShell(t,e){return t.setPosition(t.position()+4),(e||new Va).__init(t.readInt32(t.position())+t.position(),t)}profiles(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?(e||new ka).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}profilesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}holes(t,e){const s=this.bb.__offset(this.bb_pos,6);return s?(e||new Ea).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}holesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}vertices(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new Ia).__init(this.bb.__vector(this.bb_pos+s)+12*t,this.bb):null}verticesLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startShell(t){t.startObject(3)}static addProfiles(t,e){t.addFieldOffset(0,e,0)}static createProfilesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startProfilesVector(t,e){t.startVector(4,e,4)}static addHoles(t,e){t.addFieldOffset(1,e,0)}static createHolesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startHolesVector(t,e){t.startVector(4,e,4)}static addVertices(t,e){t.addFieldOffset(2,e,0)}static startVerticesVector(t,e){t.startVector(12,e,4)}static endShell(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),t.requiredField(e,8),e}static createShell(t,e,s,i){return Va.startShell(t),Va.addProfiles(t,e),Va.addHoles(t,s),Va.addVertices(t,i),Va.endShell(t)}}class Ra{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSweptDisk(t,e){return(e||new Ra).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSweptDisk(t,e){return t.setPosition(t.position()+4),(e||new Ra).__init(t.readInt32(t.position())+t.position(),t)}axes(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?(e||new La).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}axesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}radius(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}radiusLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}radiusArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startSweptDisk(t){t.startObject(2)}static addAxes(t,e){t.addFieldOffset(0,e,0)}static createAxesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startAxesVector(t,e){t.startVector(4,e,4)}static addRadius(t,e){t.addFieldOffset(1,e,0)}static createRadiusVector(t,e){t.startVector(8,e.length,8);for(let s=e.length-1;s>=0;s--)t.addFloat64(e[s]);return t.endVector()}static startRadiusVector(t,e){t.startVector(8,e,8)}static endSweptDisk(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),e}static createSweptDisk(t,e,s){return Ra.startSweptDisk(t),Ra.addAxes(t,e),Ra.addRadius(t,s),Ra.endSweptDisk(t)}}class Ua{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}x(){return this.bb.readFloat64(this.bb_pos)}mutate_x(t){return this.bb.writeFloat64(this.bb_pos+0,t),!0}y(){return this.bb.readFloat64(this.bb_pos+8)}mutate_y(t){return this.bb.writeFloat64(this.bb_pos+8,t),!0}z(){return this.bb.readFloat64(this.bb_pos+16)}mutate_z(t){return this.bb.writeFloat64(this.bb_pos+16,t),!0}static sizeOf(){return 24}static createVecd(t,e,s,i){return t.prep(8,24),t.writeFloat64(i),t.writeFloat64(s),t.writeFloat64(e),t.offset()}}class Da{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}position(t){return(t||new Ua).__init(this.bb_pos,this.bb)}xAxis(t){return(t||new Ia).__init(this.bb_pos+24,this.bb)}yAxis(t){return(t||new Ia).__init(this.bb_pos+36,this.bb)}static sizeOf(){return 48}static createTransform(t,e,s,i,n,r,o,a,h,c){return t.prep(8,48),t.prep(4,12),t.writeFloat32(c),t.writeFloat32(h),t.writeFloat32(a),t.prep(4,12),t.writeFloat32(o),t.writeFloat32(r),t.writeFloat32(n),t.prep(8,24),t.writeFloat64(i),t.writeFloat64(s),t.writeFloat64(e),t.offset()}}class Na{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometries(t,e){return(e||new Na).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometries(t,e){return t.setPosition(t.position()+4),(e||new Na).__init(t.readInt32(t.position())+t.position(),t)}coordinates(t){const e=this.bb.__offset(this.bb_pos,4);return e?(t||new Da).__init(this.bb_pos+e,this.bb):null}localTransforms(t,e){const s=this.bb.__offset(this.bb_pos,6);return s?(e||new Da).__init(this.bb.__vector(this.bb_pos+s)+48*t,this.bb):null}localTransformsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}globalTransforms(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new Da).__init(this.bb.__vector(this.bb_pos+s)+48*t,this.bb):null}globalTransformsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}materials(t,e){const s=this.bb.__offset(this.bb_pos,10);return s?(e||new Fa).__init(this.bb.__vector(this.bb_pos+s)+6*t,this.bb):null}materialsLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}representations(t,e){const s=this.bb.__offset(this.bb_pos,12);return s?(e||new Oa).__init(this.bb.__vector(this.bb_pos+s)+32*t,this.bb):null}representationsLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}instances(t,e){const s=this.bb.__offset(this.bb_pos,14);return s?(e||new Pa).__init(this.bb.__vector(this.bb_pos+s)+16*t,this.bb):null}instancesLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}shells(t,e){const s=this.bb.__offset(this.bb_pos,16);return s?(e||new Va).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}shellsLength(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}sweptDisks(t,e){const s=this.bb.__offset(this.bb_pos,18);return s?(e||new Ra).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}sweptDisksLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}geometriesItems(t){const e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}geometriesItemsLength(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0}geometriesItemsArray(){const t=this.bb.__offset(this.bb_pos,20);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startGeometries(t){t.startObject(9)}static addCoordinates(t,e){t.addFieldStruct(0,e,0)}static addLocalTransforms(t,e){t.addFieldOffset(1,e,0)}static startLocalTransformsVector(t,e){t.startVector(48,e,8)}static addGlobalTransforms(t,e){t.addFieldOffset(2,e,0)}static startGlobalTransformsVector(t,e){t.startVector(48,e,8)}static addMaterials(t,e){t.addFieldOffset(3,e,0)}static startMaterialsVector(t,e){t.startVector(6,e,1)}static addRepresentations(t,e){t.addFieldOffset(4,e,0)}static startRepresentationsVector(t,e){t.startVector(32,e,4)}static addInstances(t,e){t.addFieldOffset(5,e,0)}static startInstancesVector(t,e){t.startVector(16,e,4)}static addShells(t,e){t.addFieldOffset(6,e,0)}static createShellsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startShellsVector(t,e){t.startVector(4,e,4)}static addSweptDisks(t,e){t.addFieldOffset(7,e,0)}static createSweptDisksVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startSweptDisksVector(t,e){t.startVector(4,e,4)}static addGeometriesItems(t,e){t.addFieldOffset(8,e,0)}static createGeometriesItemsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startGeometriesItemsVector(t,e){t.startVector(4,e,4)}static endGeometries(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,10),t.requiredField(e,12),t.requiredField(e,14),t.requiredField(e,16),t.requiredField(e,18),t.requiredField(e,20),e}static createGeometries(t,e,s,i,n,r,o,a,h,c){return Na.startGeometries(t),Na.addCoordinates(t,e),Na.addLocalTransforms(t,s),Na.addGlobalTransforms(t,i),Na.addMaterials(t,n),Na.addRepresentations(t,r),Na.addInstances(t,o),Na.addShells(t,a),Na.addSweptDisks(t,h),Na.addGeometriesItems(t,c),Na.endGeometries(t)}}var Ga=(t=>(t[t.None=0]="None",t[t.Shell=1]="Shell",t[t.SweptDisk=2]="SweptDisk",t))(Ga||{});class qa{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}data1(){return this.bb.readUint32(this.bb_pos)}mutate_data1(t){return this.bb.writeUint32(this.bb_pos+0,t),!0}data2(){return this.bb.readUint16(this.bb_pos+4)}mutate_data2(t){return this.bb.writeUint16(this.bb_pos+4,t),!0}data3(){return this.bb.readUint16(this.bb_pos+6)}mutate_data3(t){return this.bb.writeUint16(this.bb_pos+6,t),!0}data41(){return this.bb.readUint8(this.bb_pos+8)}mutate_data4_1(t){return this.bb.writeUint8(this.bb_pos+8,t),!0}data42(){return this.bb.readUint8(this.bb_pos+9)}mutate_data4_2(t){return this.bb.writeUint8(this.bb_pos+9,t),!0}data43(){return this.bb.readUint8(this.bb_pos+10)}mutate_data4_3(t){return this.bb.writeUint8(this.bb_pos+10,t),!0}data44(){return this.bb.readUint8(this.bb_pos+11)}mutate_data4_4(t){return this.bb.writeUint8(this.bb_pos+11,t),!0}data45(){return this.bb.readUint8(this.bb_pos+12)}mutate_data4_5(t){return this.bb.writeUint8(this.bb_pos+12,t),!0}data46(){return this.bb.readUint8(this.bb_pos+13)}mutate_data4_6(t){return this.bb.writeUint8(this.bb_pos+13,t),!0}data47(){return this.bb.readUint8(this.bb_pos+14)}mutate_data4_7(t){return this.bb.writeUint8(this.bb_pos+14,t),!0}data48(){return this.bb.readUint8(this.bb_pos+15)}mutate_data4_8(t){return this.bb.writeUint8(this.bb_pos+15,t),!0}static sizeOf(){return 16}static createGuid(t,e,s,i,n,r,o,a,h,c,l,u){return t.prep(4,16),t.writeInt8(u),t.writeInt8(l),t.writeInt8(c),t.writeInt8(h),t.writeInt8(a),t.writeInt8(o),t.writeInt8(r),t.writeInt8(n),t.writeInt16(i),t.writeInt16(s),t.writeInt32(e),t.offset()}}var Wa=(t=>(t[t.Normal=0]="Normal",t[t.Border=1]="Border",t[t.Center=2]="Center",t[t.DashDot=3]="DashDot",t[t.Dashed=4]="Dashed",t[t.Divide=5]="Divide",t[t.Dot=6]="Dot",t[t.Hidden=7]="Hidden",t))(Wa||{});class Ha{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsRelation(t,e){return(e||new Ha).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRelation(t,e){return t.setPosition(t.position()+4),(e||new Ha).__init(t.readInt32(t.position())+t.position(),t)}data(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}dataLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startRelation(t){t.startObject(1)}static addData(t,e){t.addFieldOffset(0,e,0)}static createDataVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startDataVector(t,e){t.startVector(4,e,4)}static endRelation(t){const e=t.endObject();return t.requiredField(e,4),e}static createRelation(t,e){return Ha.startRelation(t),Ha.addData(t,e),Ha.endRelation(t)}}class ja{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSpatialStructure(t,e){return(e||new ja).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSpatialStructure(t,e){return t.setPosition(t.position()+4),(e||new ja).__init(t.readInt32(t.position())+t.position(),t)}localId(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb_pos+t):null}mutate_local_id(t){const e=this.bb.__offset(this.bb_pos,4);return 0!==e&&(this.bb.writeUint32(this.bb_pos+e,t),!0)}category(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}children(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new ja).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}childrenLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSpatialStructure(t){t.startObject(3)}static addLocalId(t,e){t.addFieldInt32(0,e,null)}static addCategory(t,e){t.addFieldOffset(1,e,0)}static addChildren(t,e){t.addFieldOffset(2,e,0)}static createChildrenVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startChildrenVector(t,e){t.startVector(4,e,4)}static endSpatialStructure(t){return t.endObject()}static createSpatialStructure(t,e,s,i){return ja.startSpatialStructure(t),null!==e&&ja.addLocalId(t,e),ja.addCategory(t,s),ja.addChildren(t,i),ja.endSpatialStructure(t)}}class Za{constructor(){nt(this,"bb",null),nt(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsModel(t,e){return(e||new Za).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsModel(t,e){return t.setPosition(t.position()+4),(e||new Za).__init(t.readInt32(t.position())+t.position(),t)}static bufferHasIdentifier(t){return t.__has_identifier("0001")}metadata(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}guids(t,e){const s=this.bb.__offset(this.bb_pos,6);return s?(e||new qa).__init(this.bb.__vector(this.bb_pos+s)+16*t,this.bb):null}guidsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}guidsItems(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}guidsItemsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}guidsItemsArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}maxLocalId(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readUint32(this.bb_pos+t):0}mutate_max_local_id(t){const e=this.bb.__offset(this.bb_pos,10);return 0!==e&&(this.bb.writeUint32(this.bb_pos+e,t),!0)}localIds(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}localIdsLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}localIdsArray(){const t=this.bb.__offset(this.bb_pos,12);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}categories(t,e){const s=this.bb.__offset(this.bb_pos,14);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}categoriesLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}geometries(t){const e=this.bb.__offset(this.bb_pos,16);return e?(t||new Na).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}attributes(t,e){const s=this.bb.__offset(this.bb_pos,18);return s?(e||new Ta).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}attributesLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}relations(t,e){const s=this.bb.__offset(this.bb_pos,20);return s?(e||new Ha).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}relationsLength(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0}relationsItems(t){const e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0}relationsItemsLength(){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.__vector_len(this.bb_pos+t):0}relationsItemsArray(){const t=this.bb.__offset(this.bb_pos,22);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}guid(t){const e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}spatialStructure(t){const e=this.bb.__offset(this.bb_pos,26);return e?(t||new ja).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}static startModel(t){t.startObject(12)}static addMetadata(t,e){t.addFieldOffset(0,e,0)}static addGuids(t,e){t.addFieldOffset(1,e,0)}static startGuidsVector(t,e){t.startVector(16,e,4)}static addGuidsItems(t,e){t.addFieldOffset(2,e,0)}static createGuidsItemsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startGuidsItemsVector(t,e){t.startVector(4,e,4)}static addMaxLocalId(t,e){t.addFieldInt32(3,e,0)}static addLocalIds(t,e){t.addFieldOffset(4,e,0)}static createLocalIdsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startLocalIdsVector(t,e){t.startVector(4,e,4)}static addCategories(t,e){t.addFieldOffset(5,e,0)}static createCategoriesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startCategoriesVector(t,e){t.startVector(4,e,4)}static addGeometries(t,e){t.addFieldOffset(6,e,0)}static addAttributes(t,e){t.addFieldOffset(7,e,0)}static createAttributesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startAttributesVector(t,e){t.startVector(4,e,4)}static addRelations(t,e){t.addFieldOffset(8,e,0)}static createRelationsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startRelationsVector(t,e){t.startVector(4,e,4)}static addRelationsItems(t,e){t.addFieldOffset(9,e,0)}static createRelationsItemsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startRelationsItemsVector(t,e){t.startVector(4,e,4)}static addGuid(t,e){t.addFieldOffset(10,e,0)}static addSpatialStructure(t,e){t.addFieldOffset(11,e,0)}static endModel(t){const e=t.endObject();return t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,12),t.requiredField(e,14),t.requiredField(e,16),t.requiredField(e,24),e}static finishModelBuffer(t,e){t.finish(e,"0001")}static finishSizePrefixedModelBuffer(t,e){t.finish(e,"0001",!0)}}var Ya=(t=>(t[t.Line=0]="Line",t[t.PolyLine=1]="PolyLine",t[t.Arc=2]="Arc",t))(Ya||{}),Xa=(t=>(t[t.Single=0]="Single",t[t.Double=1]="Double",t[t.FrontFace=2]="FrontFace",t[t.BackFace=3]="BackFace",t))(Xa||{});const Ja=class t{static setTransform(e,s,i){const n=s.globalTransforms(e);t.matrix4ToPlacement(i,n)}};nt(Ja,"getTransform",(()=>{const t=new Da,e=new Be,s=new Be;return(i,n,r)=>{Ja.placementToMatrix4(n.localTransforms(i.localTransformId(),t),e),Ja.placementToMatrix4(n.globalTransforms(i.itemId()),s),r.multiplyMatrices(s,e)}})()),nt(Ja,"getBoundingBox",(()=>{const t=new Aa;return(e,s)=>{e.boundingBox(t),Ja.aabbToBox(t,s)}})()),nt(Ja,"aabbToBox",(()=>{const t=new Ia;return(e,s)=>{e.min(t),s.min.set($a(t.x()),$a(t.y()),$a(t.z())),e.max(t),s.max.set($a(t.x()),$a(t.y()),$a(t.z()))}})()),nt(Ja,"placementToMatrix4",(()=>{const t=new Qt,e=new Qt,s=new Qt,i=new Qt,n=new Ua,r=new Ia;return(o,a)=>(o.position(n),t.set($a(n.x()),$a(n.y()),$a(n.z())),o.xAxis(r),e.set($a(r.x()),$a(r.y()),$a(r.z())),o.yAxis(r),s.set($a(r.x()),$a(r.y()),$a(r.z())),i.crossVectors(e,s),a.set(e.x,s.x,i.x,t.x,e.y,s.y,i.y,t.y,e.z,s.z,i.z,t.z,0,0,0,1),a)})()),nt(Ja,"matrix4ToPlacement",(()=>{const t=new Ua,e=new Ia;return(s,i)=>{const n=i.position(t);n.mutate_x(s.elements[12]),n.mutate_y(s.elements[13]),n.mutate_z(s.elements[14]);const r=i.xAxis(e);r.mutate_x(s.elements[0]),r.mutate_y(s.elements[1]),r.mutate_z(s.elements[2]);const o=i.yAxis(e);o.mutate_x(s.elements[4]),o.mutate_y(s.elements[5]),o.mutate_z(s.elements[6])}})()),nt(Ja,"getBoundingBoxLongestAxis",(()=>{const t=new Qt,e=new Qt,s=new Qt,i=new Qt,n=new ki;return r=>(t.copy(r.min),e.copy(r.max),s.addVectors(t,e).multiplyScalar(.5),r.getSize(i),i.x>=i.y&&i.x>=i.z?(t.set(t.x,s.y,s.z),e.set(e.x,s.y,s.z)):i.y>=i.z?(t.set(s.x,t.y,s.z),e.set(s.x,e.y,s.z)):(t.set(s.x,s.y,t.z),e.set(s.x,s.y,e.z)),n.start=t.clone(),n.end=e.clone(),n)})());let Qa=Ja;function $a(t){return Number.isNaN(t)||!Number.isFinite(t)?0:t}function Ka(t,e){if(Array.isArray(t))for(let s=0;s<t.length;s++)e(t[s],s);else e(t,0)}class th{}nt(th,"zero",Object.freeze(new Qt(0,0,0))),nt(th,"one",Object.freeze(new Qt(1,1,1))),nt(th,"up",Object.freeze(new Qt(0,0,1))),nt(th,"down",Object.freeze(new Qt(0,0,-1))),nt(th,"forward",Object.freeze(new Qt(0,1,0))),nt(th,"back",Object.freeze(new Qt(0,-1,0))),nt(th,"right",Object.freeze(new Qt(1,0,0))),nt(th,"left",Object.freeze(new Qt(-1,0,0))),nt(th,"threejsUp",Object.freeze(new Qt(0,1,0))),nt(th,"threejsDown",Object.freeze(new Qt(0,-1,0))),nt(th,"threejsForward",Object.freeze(new Qt(0,0,1))),nt(th,"threejsBack",Object.freeze(new Qt(0,0,-1))),nt(th,"threejsCameraForward",Object.freeze(new Qt(0,0,-1))),nt(th,"threejsCameraBack",Object.freeze(new Qt(0,0,1)));const eh=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","_","$"];class sh{constructor({data:t,ifcGuid:e,msGuid:s}){nt(this,"data"),nt(this,"type","UUID"),t?this.data=t:e?this.setIfcGuid(e):s?this.setMsGuid(s):this.data=new Uint8Array(16)}fromJSON({type:t,data:e}){if("UUID"!==t)throw TypeError("Incorrect type, type needs to be UUID");this.data=new Uint8Array(JSON.parse(`[${e}]`))}equals(t){for(let e=0;e<16;e++)if(this.data[e]!==t.data[e])return!1;return!0}toString(){return this.msGuid}get msGuid(){const t=this.data.byteOffset,e=new DataView(this.data.buffer,t,16);return`${e.getUint32(0,!0).toString(16).padStart(8,"0")}-${e.getUint16(4,!0).toString(16).padStart(4,"0")}-${e.getUint16(6,!0).toString(16).padStart(4,"0")}-${e.getUint8(8).toString(16).padStart(2,"0")}${e.getUint8(9).toString(16).padStart(2,"0")}-${e.getUint8(10).toString(16).padStart(2,"0")}${e.getUint8(11).toString(16).padStart(2,"0")}${e.getUint8(12).toString(16).padStart(2,"0")}${e.getUint8(13).toString(16).padStart(2,"0")}${e.getUint8(14).toString(16).padStart(2,"0")}${e.getUint8(15).toString(16).padStart(2,"0")}`}get guidNumbers(){const t=this.data.byteOffset,e=new DataView(this.data.buffer,t,16);return{b1:e.getUint32(0,!0),b2:e.getUint16(4,!0),b3:e.getUint16(6,!0),b4:e.getUint8(8),b5:e.getUint8(9),b6:e.getUint8(10),b44:e.getUint8(11),b45:e.getUint8(12),b46:e.getUint8(13),b47:e.getUint8(14),b48:e.getUint8(15)}}setMsGuid(t){this.data=this.data||new Uint8Array(16);const e=this.data.byteOffset,s=new DataView(this.data.buffer,e,16),i=(e,s)=>parseInt(t.slice(e,e+s),16);s.setUint32(0,i(0,8),!0),s.setUint16(4,i(9,4),!0),s.setUint16(6,i(14,4),!0),s.setUint8(8,i(19,2)),s.setUint8(9,i(21,2)),s.setUint8(10,i(24,2)),s.setUint8(11,i(26,2)),s.setUint8(12,i(28,2)),s.setUint8(13,i(30,2)),s.setUint8(14,i(32,2)),s.setUint8(15,i(34,2))}get ifcGuid(){const t=new Uint8Array(24),e=this.data;t[0]=e[15],t[1]=e[14],t[2]=e[13],t[3]=0,t[4]=e[12],t[5]=e[11],t[6]=e[10],t[7]=0,t[8]=e[9],t[9]=e[8],t[10]=e[6],t[11]=0,t[12]=e[7],t[13]=e[4],t[14]=e[5],t[15]=0,t[16]=e[0],t[17]=e[1],t[18]=e[2],t[19]=0,t[20]=e[3],t[21]=0,t[22]=0,t[23]=0;const s=new Uint32Array(t.buffer);return this.toBase64(s[5],8)+this.toBase64(s[4],24)+this.toBase64(s[3],24)+this.toBase64(s[2],24)+this.toBase64(s[1],24)+this.toBase64(s[0],24)}setIfcGuid(t){this.data=new Uint8Array(16);const e=this.fromBase64(t[0],6)+this.fromBase64(t[1],0),s=this.fromBase64(t[2],18)+this.fromBase64(t[3],12)+this.fromBase64(t[4],6)+this.fromBase64(t[5],0),i=this.fromBase64(t[6],18)+this.fromBase64(t[7],12)+this.fromBase64(t[8],6)+this.fromBase64(t[9],0),n=this.fromBase64(t[10],18)+this.fromBase64(t[11],12)+this.fromBase64(t[12],6)+this.fromBase64(t[13],0),r=this.fromBase64(t[14],18)+this.fromBase64(t[15],12)+this.fromBase64(t[16],6)+this.fromBase64(t[17],0),o=this.fromBase64(t[18],18)+this.fromBase64(t[19],12)+this.fromBase64(t[20],6)+this.fromBase64(t[21],0),a=this.getBytes(o),h=this.getBytes(r),c=this.getBytes(n),l=this.getBytes(i),u=this.getBytes(s),d=this.getBytes(e);this.data[15]=a[0],this.data[14]=a[1],this.data[13]=a[2],this.data[12]=h[0],this.data[11]=h[1],this.data[10]=h[2],this.data[9]=c[0],this.data[8]=c[1],this.data[6]=c[2],this.data[7]=l[0],this.data[4]=l[1],this.data[5]=l[2],this.data[0]=u[0],this.data[1]=u[1],this.data[2]=u[2],this.data[3]=d[0]}setFromBufferData(t,e){this.data=new Uint8Array(t,e,16)}toBase64(t,e){let s="";if(e>0){s+=eh[63&t],s=this.toBase64(t>>6,e-6)+s}return s}fromBase64(t,e){let s=0;for(;s<64&&eh[s]!=t;)s++;return s<<e}getBytes(t){const e=new ArrayBuffer(8);return new Int32Array(e)[0]=t,new Uint8Array(e)}}function ih(t){return function(t,e,s){const i=Math.round(t.angle()*t.radius()*e);return Math.min(Math.max(i,s),30)}(t,5,4)}const nh=(()=>{const t=new Qt,e=new Qt,s=new Ia,i=new za;return(n,r)=>{const o=n.linesLength();for(let a=0;a<o;a++)n.lines(a,i),i.start(s),t.set(s.x(),s.y(),s.z()),i.end(s),e.set(s.x(),s.y(),s.z()),r(t,e)}})(),rh=(()=>{const t=new Qt,e=new Qt,s=[],i=new Qt,n=new Qt,r=new Ba;return(o,a,h)=>{const c=o.arcsLength();for(let l=0;l<c;l++){o.arcs(l,r);const c=h(r);i.set(r.center().x(),r.center().y(),r.center().z()),n.set(r.axis().x(),r.axis().y(),r.axis().z()),t.set(r.refDirection().x(),r.refDirection().y(),r.refDirection().z()),s.length=c-2;for(let e=0;e<s.length;e++)s[e]=new Qt,s[e].copy(t),s[e].applyAxisAngle(n,r.angle()*(e+1)/(c-1)),s[e].multiplyScalar(r.radius()),s[e].add(i);e.copy(t),e.applyAxisAngle(n,r.angle()),e.multiplyScalar(r.radius()),e.add(i),t.multiplyScalar(r.radius()),t.add(i),a(t,s,e)}}})(),oh=(()=>{const t=new Qt,e=new Qt,s=new Ca;return(i,n)=>{const r=i.polyLinesLength();for(let o=0;o<r;o++){i.polyLines(o,s);for(let i=0,r=s.pointsLength()-1;i<r;i++)t.set(s.points(i).x(),s.points(i).y(),s.points(i).z()),e.set(s.points(i+1).x(),s.points(i+1).y(),s.points(i+1).z()),n(t,e)}}})();function ah(t,e,s){nh(t,((t,i)=>{lh(t,i,e,s)}))}function hh(t,e,s,i){rh(t,((t,s,n)=>{lh(t,s[0],e,i),s.forEach(((t,n)=>{n>0&&lh(s[n-1],t,e,i)})),lh(s[s.length-1],n,e,i)}),s)}function ch(t,e,s){oh(t,((t,i)=>{lh(t,i,e,s)}))}(()=>{const t=new Qt,e=new Qt})();const lh=(()=>{const t=new Qt,e=new Qt;return(s,i,n,r)=>{const o=n.distanceSqToSegment(s,i,t,e);r(t,e,s,i,o)}})(),uh=(()=>{const t=new Qt,e=new Qt,s=new Qt,i=new Be,n=new Be,r=new Ae,o=new Qt,a=new Qt,h=new Qt,c=[],l=(()=>{const t=new Qt(0,0,1),e=new Qt(1,0,0);return(s,i)=>{Math.abs(s.dot(t))>.9?i.crossVectors(s,e).normalize():i.crossVectors(s,t).normalize()}})(),u=(t,e,s)=>{o.copy(r.direction).normalize().multiplyScalar(t).add(r.origin),o.z>=0&&o.z<=e/s&&(a.set(o.x,o.y,0).applyMatrix4(n).normalize(),o.applyMatrix4(i),c.push({point:o.clone()}))};return(o,a,d,p)=>{const m=a.distanceTo(o);t.copy(a).sub(o).normalize(),l(t,s),e.crossVectors(t,s),i.identity().makeBasis(s,e,t),i.setPosition(o),i.scale(h.set(p,p,p)),n.copy(i).invert(),r.copy(d).applyMatrix4(n);const f=r.direction.x*r.direction.x+r.direction.y*r.direction.y,g=2*r.origin.x*r.direction.x+2*r.origin.y*r.direction.y,y=r.origin.x*r.origin.x+r.origin.y*r.origin.y-1;if(4*f*y>g*g)return[];const b=(-g+Math.sqrt(g*g-4*f*y))/(2*f),x=(-g-Math.sqrt(g*g-4*f*y))/(2*f);return c.length=0,n.transpose(),u(b,m,p),u(x,m,p),c}})(),dh=(()=>{const t=new li,e=new Qt,s=new Qt;return(i,n,r,o)=>{if(e.copy(th.up).applyQuaternion(n),t.setFromNormalAndCoplanarPoint(e,i),r.intersectsPlane(t)&&(r.intersectPlane(t,s),s.distanceTo(i)<=o))return{point:i.clone()}}})(),ph=32767;var mh=(t=>(t[t.None=0]="None",t[t.BoundingBoxGenerated=1]="BoundingBoxGenerated",t[t.BuilderGenerated=2]="BuilderGenerated",t))(mh||{});const fh=class t{constructor(t,e){nt(this,"geometryType"),nt(this,"snapGeometryType"),nt(this,"lineLODType",0),nt(this,"geometryPrototypes",new Map),nt(this,"geometryKeys",new Set),nt(this,"checksum",new ya),nt(this,"modelIdHash"),this.geometry=e,this.modelIdHash=this.checksum.clear().add(t).get()}static createCache(t){return new fa({maxSize:Math.max(t??this.calculateMemoryCacheSize(),1),sizeCalculation:t=>{const e=Array.isArray(t)?t.reduce(((t,e)=>t+e.memSize),0):t.memSize;return Math.max(e,1)}})}static calculateMemoryCacheSize(){return Math.trunc(104857600*(navigator.deviceMemory??2))}static set maxCacheSize(e){t._maxCacheSize!==e&&(t.geometries.clear(),t.geometries=t.createCache(e),t._maxCacheSize=e)}setGeometryPrototype(t,e,s=Gi.Full){this.geometryPrototypes.set(this.getCacheKey(t,s),Object.seal(e))}getCachedGeometryData(t,e=Gi.Full){return this.getCachedGeometry(t,e)}getCachedGeometryDatas(t,e=Gi.Full){return this.getCachedGeometry(t,e)}getCachedGeometry(e,s=Gi.Full){const i=this.getCacheKey(e,s);let n=t.geometries.get(i);if(!n){const t=this.geometryPrototypes.get(i);n=Array.isArray(t)?t.map((t=>({...t}))):{...t}}return n}getCacheKey(t,e){return this.checksum.clear().add(this.modelIdHash).add(this.geometryType).add(e).add(t).get()}calculateMemSizeAndCache(e,s,i=Gi.Full){Ka(s,(t=>{t.memSize=t.positions.byteLength,t.indices&&(t.memSize+=t.indices.byteLength),t.normals&&(t.memSize+=t.normals.byteLength),t.uvs&&(t.memSize+=t.uvs.byteLength),t.pointUvs&&(t.memSize+=t.pointUvs.byteLength),t.pointSizes&&(t.memSize+=t.pointSizes.byteLength),Object.seal(t)}));const n=this.getCacheKey(e,i);t.geometries.set(n,s),this.geometryKeys.add(n)}dispose(){for(const e of this.geometryKeys)t.geometries.delete(e)}};nt(fh,"pickableAngleInRadian",Math.PI/36),nt(fh,"SMOOTH_LIMIT",Math.cos(Math.PI/10)),nt(fh,"geometries",fh.createCache()),nt(fh,"_maxCacheSize");let gh=fh;function yh(t,e,s,i,n,r){s=s||2;var o=e&&e.length,a=o?e[0]*s:t.length,h=bh(t,0,a,s,!0,i,n);if(h&&h.next!==h.prev){var c,l,u,d,p,m,f;if(o&&(h=function(t,e,s,i,n,r){var o,a,h,c=[];for(o=0,a=e.length;o<a;o++)(h=bh(t,e[o]*i,o<a-1?e[o+1]*i:t.length,i,!1,n,r))===h.next&&(h.steiner=!0),c.push(zh(h));for(c.sort(Ih),o=0;o<c.length;o++)s=xh(s=Ah(c[o],s),s.next);return s}(t,e,h,s,i,n)),t.length>80*s){c=u=t[i],l=d=t[n];for(var g=s;g<a;g+=s)(p=t[g+i])<c&&(c=p),(m=t[g+n])<l&&(l=m),p>u&&(u=p),m>d&&(d=m);f=0!==(f=Math.max(u-c,d-l))?1/f:0}_h(h,r,s,c,l,f)}}function bh(t,e,s,i,n,r,o){var a,h,c;if(n===function(t,e,s,i,n,r){for(var o=0,a=e,h=s-i;a<s;a+=i)o+=(t[h+n]-t[a+n])*(t[a+r]+t[h+r]),h=a;return o}(t,e,s,i,r,o)>0)for(a=e;a<s;a+=i)h=Uh(a,t[a+r],t[a+o],h);else for(a=s-i;a>=e;a-=i)h=Uh(a,t[a+r],t[a+o],h);return h&&Fh(h,h.next)&&(c=h.next,Dh(h),h=c),h}function xh(t,e){if(!t)return t;e||(e=t);var s,i,n=t;do{if(s=!1,n.steiner||!Fh(n,n.next)&&0!==Ph(n.prev,n,n.next))n=n.next;else{if(i=n.prev,Dh(n),(n=e=i)===n.next)break;s=!0}}while(s||n!==e);return e}function _h(t,e,s,i,n,r,o){if(t){!o&&r&&function(t,e,s,i){var n=t;do{null===n.z&&(n.z=Th(n.x,n.y,e,s,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,s,i,n,r,o,a,h,c=1;do{for(s=t,t=null,r=null,o=0;s;){for(o++,i=s,a=0,e=0;e<c&&(a++,i=i.nextZ);e++);for(h=c;a>0||h>0&&i;)0!==a&&(0===h||!i||s.z<=i.z)?(n=s,s=s.nextZ,a--):(n=i,i=i.nextZ,h--),r?r.nextZ=n:t=n,n.prevZ=r,r=n;s=i}r.nextZ=null,c*=2}while(o>1)}(n)}(t,i,n,r);for(var a,h,c=t;t.prev!==t.next;)if(a=t.prev,h=t.next,r?Sh(t,i,n,r):wh(t))e(a.i/s,t.i/s,h.i/s),Dh(t),t=h.next,c=h.next;else if((t=h)===c){o?1===o?_h(t=vh(xh(t),e,s),e,s,i,n,r,2):2===o&&Mh(t,e,s,i,n,r):_h(xh(t),e,s,i,n,r,1);break}}}function wh(t){var e=t.prev,s=t,i=t.next;if(Ph(e,s,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(Ch(e.x,e.y,s.x,s.y,i.x,i.y,n.x,n.y)&&Ph(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function Sh(t,e,s,i){var n=t.prev,r=t,o=t.next;if(Ph(n,r,o)>=0)return!1;for(var a=n.x<r.x?n.x<o.x?n.x:o.x:r.x<o.x?r.x:o.x,h=n.y<r.y?n.y<o.y?n.y:o.y:r.y<o.y?r.y:o.y,c=n.x>r.x?n.x>o.x?n.x:o.x:r.x>o.x?r.x:o.x,l=n.y>r.y?n.y>o.y?n.y:o.y:r.y>o.y?r.y:o.y,u=Th(a,h,e,s,i),d=Th(c,l,e,s,i),p=t.prevZ,m=t.nextZ;p&&p.z>=u&&m&&m.z<=d;){if(p!==t.prev&&p!==t.next&&Ch(n.x,n.y,r.x,r.y,o.x,o.y,p.x,p.y)&&Ph(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==t.prev&&m!==t.next&&Ch(n.x,n.y,r.x,r.y,o.x,o.y,m.x,m.y)&&Ph(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&Ch(n.x,n.y,r.x,r.y,o.x,o.y,p.x,p.y)&&Ph(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=d;){if(m!==t.prev&&m!==t.next&&Ch(n.x,n.y,r.x,r.y,o.x,o.y,m.x,m.y)&&Ph(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function vh(t,e,s){var i=t;do{var n=i.prev,r=i.next.next;!Fh(n,r)&&Oh(n,i,i.next,r)&&Vh(n,r)&&Vh(r,n)&&(e(n.i/s,i.i/s,r.i/s),Dh(i.next),Dh(i),i=t=r),i=i.next}while(i!==t);return xh(i)}function Mh(t,e,s,i,n,r){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&Lh(o,a)){var h=Rh(o,a);return o=xh(o,o.next),h=xh(h,h.next),_h(o,e,s,i,n,r),void _h(h,e,s,i,n,r)}a=a.next}o=o.next}while(o!==t)}function Ih(t,e){return t.x-e.x}function Ah(t,e){var s=function(t,e){var s,i=e,n=t.x,r=t.y,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var a=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>o){if(o=a,a===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(n===o)return s;var h,c=s,l=s.x,u=s.y,d=1/0;i=s;do{n>=i.x&&i.x>=l&&n!==i.x&&Ch(r<u?n:o,r,l,u,r<u?o:n,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(n-i.x),Vh(i,t)&&(h<d||h===d&&(i.x>s.x||i.x===s.x&&Bh(s,i)))&&(s=i,d=h)),i=i.next}while(i!==c);return s}(t,e);if(!s)return e;var i=Rh(s,t),n=xh(s,s.next);return xh(i,i.next),e===e.next||e===s?n:e}function Bh(t,e){return Ph(t.prev,t,e.prev)<0&&Ph(e.next,t,t.next)<0}function Th(t,e,s,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function zh(t){var e=t,s=t;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==t);return s}function Ch(t,e,s,i,n,r,o,a){return(n-o)*(e-a)-(t-o)*(r-a)>=0&&(t-o)*(i-a)-(s-o)*(e-a)>=0&&(s-o)*(r-a)-(n-o)*(i-a)>=0}function Lh(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==e.i&&s.next.i!==e.i&&Oh(s,s.next,t,e))return!0;s=s.next}while(s!==t);return!1}(t,e)&&(Vh(t,e)&&Vh(e,t)&&function(t,e){var s=t,i=!1,n=(t.x+e.x)/2,r=(t.y+e.y)/2;do{s.y>r!=s.next.y>r&&s.next.y!==s.y&&n<(s.next.x-s.x)*(r-s.y)/(s.next.y-s.y)+s.x&&(i=!i),s=s.next}while(s!==t);return i}(t,e)&&(Ph(t.prev,t,e.prev)||Ph(t,e.prev,e))||Fh(t,e)&&Ph(t.prev,t,t.next)>0&&Ph(e.prev,e,e.next)>0)}function Ph(t,e,s){return(e.y-t.y)*(s.x-e.x)-(e.x-t.x)*(s.y-e.y)}function Fh(t,e){return t.x===e.x&&t.y===e.y}function Oh(t,e,s,i){var n=kh(Ph(t,e,s)),r=kh(Ph(t,e,i)),o=kh(Ph(s,i,t)),a=kh(Ph(s,i,e));return n!==r&&o!==a||(!(0!==n||!Eh(t,s,e))||(!(0!==r||!Eh(t,i,e))||(!(0!==o||!Eh(s,t,i))||!(0!==a||!Eh(s,e,i)))))}function Eh(t,e,s){return e.x<=Math.max(t.x,s.x)&&e.x>=Math.min(t.x,s.x)&&e.y<=Math.max(t.y,s.y)&&e.y>=Math.min(t.y,s.y)}function kh(t){return t>0?1:t<0?-1:0}function Vh(t,e){return Ph(t.prev,t,t.next)<0?Ph(t,e,t.next)>=0&&Ph(t,t.prev,e)>=0:Ph(t,e,t.prev)<0||Ph(t,t.next,e)<0}function Rh(t,e){var s=new Nh(t.i,t.x,t.y),i=new Nh(e.i,e.x,e.y),n=t.next,r=e.prev;return t.next=e,e.prev=t,s.next=n,n.prev=s,i.next=s,s.prev=i,r.next=i,i.prev=r,i}function Uh(t,e,s,i){var n=new Nh(t,e,s);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Dh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ),t.next=t,t.prev=t}function Nh(t,e,s){this.i=t,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Gh extends gh{constructor(){super(...arguments),nt(this,"snapGeometryType",Di.MESH),nt(this,"lineLODType",mh.BoundingBoxGenerated),nt(this,"maxVertexLength",Vi),nt(this,"v0",new Qt),nt(this,"v1",new Qt),nt(this,"v2",new Qt),nt(this,"n1",new Qt),nt(this,"faceCenterPickableMap",new Map),nt(this,"createGeometryPrototype",(()=>{const t=new Ea,e=new ka;let s,i=0,n=0,r=0;const o=()=>{const t={objectType:Di.MESH,indicesLength:3*r,positionsLength:3*(i+n),normalsLength:3*(i+n)};s?Array.isArray(s)?s.push(t):s=[s,t]:s=t,r=0,i=0,n=0};return a=>{if(0===a.profilesLength())return{objectType:Di.MESH};i=0,n=0,r=0,s=void 0;for(let s=0,h=a.profilesLength();s<h;s++){a.profiles(s,e);const h=e.indicesLength();n+=h;let c=!1;for(let e=0;e<a.holesLength();e++)a.holes(e,t),t.profile()===s&&(i+=t.indicesLength(),r+=t.indicesLength(),c&&(r+=2),c=!0);c?r+=e.indicesLength():e.indicesLength()>2&&(r+=e.indicesLength()-2),i+n+h>this.maxVertexLength&&o()}(r>0||i>0||n>0)&&o();const h=s;return s=void 0,h}})()),nt(this,"build",(()=>{const t=new ka;let e,s=0;const i=[];let n,r;const o={vertex_count:0,index_count:0,vertex_length:0,uv_length:0,normal_length:0,normal_count:0},a=t=>{e=Array.isArray(t)?t[s]:t,e.indices=new Uint16Array(e.indicesLength),e.positions=new Float32Array(e.positionsLength),e.normals=new Int16Array(e.normalsLength),e.uvs=new Float32Array(e.uvsLength),o.vertex_count=0,o.index_count=0,o.vertex_length=0,o.uv_length=0,o.normal_length=0,o.normal_count=0,s++};return(h,c)=>{s=0,e=void 0,a(c),i.length=0,h instanceof Va&&(this.getShellProfileNormals(h,i),n=this.getWiresForVertices(h));const l=this.getShellData(h,this.getVertexDataSize(this.geometryType)),u=this.buildHoles(h,i,n);for(let s=0,d=h.profilesLength();s<d;s++){h.profiles(s,t);const d=t.indicesArray();h instanceof Va&&(r=this.getVertexAveragedNormals(d,s,i,n)),3!==t.indicesLength()||u.has(s)?4!==t.indicesLength()||u.has(s)?jh(d,l,r,s,this.geometryType,e,u,o):Wh(d,l,r,s,this.geometryType,e,o):Hh(d,l,r,this.geometryType,e,o),o.vertex_length/3+t.indicesLength()>this.maxVertexLength&&a(c)}e=void 0}})()),nt(this,"buildHoles",(()=>{const t=new Ia,e=new Ea,s=new Map;let i;return(n,r,o)=>{s.clear();for(let a=0,h=n.holesLength();a<h;a++){const h=n.holes(a,e).profile();if(s.has(h)){const t=s.get(h);t.indices.push(t.vertices.length/3),s.set(h,t)}else s.set(h,{indices:[0],vertices:[],normals:[]});const c=s.get(h);i=this.getVertexAveragedNormals(e.indicesArray(),h,r,o);for(let s=0,r=e.indicesLength();s<r;s++)this.geometryType===Ga.Shell&&n instanceof Va&&(n.vertices(e.indices(s),t),c.vertices.push(t.x(),t.y(),t.z()),c.normals.push(i[3*s],i[3*s+1],i[3*s+2]))}return s}})()),nt(this,"pickCenterPoint",(()=>{const t=new ka,e=[],s=new Ea,i=new Map,n=new Qt;let r=new Qt;const o=new Qt;let a;return(h,c,l)=>{a=!1,e.length=0,i.clear();const u=(t,s,i)=>{t&&l.containsPoint(t)&&this.isFaceCenterPickable(h,d,t,s,i)&&e.push({point:t.clone(),snapType:Ui.CENTER_POINT})},d=this.getShell(h);for(let t=0,e=d.holesLength();t<e;t++){const e=d.holes(t).profile();i.has(e)?i.get(e).push(t):i.set(d.holes(t).profile(),[t])}for(let e=0,n=d.profilesLength();e<n;e++){if(i.has(e)){i.get(e).forEach((t=>{d.holes(t,s),r=this.getFaceCenter(d,s,void 0),u(r,s,void 0)}))}d.profiles(e,t),t.indicesLength()<=4||(r=this.getFaceCenter(d,t,void 0),a=!!r||a,u(r,t,void 0))}if(!a){this.findTriangleShellFacesOnSamePlane(d).forEach((t=>{o.set(0,0,0),t.forEach((t=>{this.getVertex(d,t,n),o.addVectors(o,n)})),o.multiplyScalar(1/t.size),u(o,void 0,Array.from(t))}))}return e}})()),nt(this,"findTriangleShellFacesOnSamePlane",(()=>{const t=new ka,e=new Qt,s=new Qt,i=new Qt,n=new Qt,r=new Qt,o=new Qt,a=new li,h=new li,c=new Map;return l=>{const u=performance.now();c.clear();const d=l.profilesLength();for(let p=0;p<d;p++){if(c.size&&[...c.values()].find((t=>t.includes(p))))continue;l.profiles(p,t);if(3!==t.indicesLength())continue;const m=t.indices(0),f=t.indices(1),g=t.indices(2);this.getVertex(l,m,e),this.getVertex(l,f,s),this.getVertex(l,g,i),a.setFromCoplanarPoints(e,s,i);for(let e=0;e<d;e++){if(e<=p)continue;if(l.profiles(e,t),3!==t.indicesLength())continue;const s=t.indices(0),i=t.indices(1),u=t.indices(2);if(this.getVertex(l,s,n),this.getVertex(l,i,r),this.getVertex(l,u,o),h.setFromCoplanarPoints(n,r,o),Math.abs(a.constant-h.constant)>.001||Math.abs(a.normal.dot(h.normal))<.999)continue;const d=c.has(p)?c.get(p):[];d.push(e),c.set(p,d)}if(performance.now()-u>150)break}const p=[];for(const[e,s]of c){const i=new Set;l.profiles(e,t),i.add(t.indices(0)),i.add(t.indices(1)),i.add(t.indices(2)),s.forEach((e=>{l.profiles(e,t),i.add(t.indices(0)),i.add(t.indices(1)),i.add(t.indices(2))})),p.push(i)}return p}})()),nt(this,"isCircularFace",(()=>{const t=new Qt,e=new Qt,s=new Qt,i=new Qt,n=new Qt;let r;return(o,a,h,c)=>{let l;const u=h?h.indicesLength():c.length;for(let e=0;e<u;e++){const s=h?h.indices(e):c[e];if(this.getVertex(o,s,t),l){if(Math.abs(1-l/t.sub(a).length())>.01){r=!1;break}}else l=t.sub(a).length();e===u-1&&(r=!0)}if(r){if(u>50)return r;if(h)for(let a=0;a<u;a++){const c=h.indices(a),l=0===a?h.indices(u-1):h.indices(a-1),d=a===u-1?h.indices(0):h.indices(a+1);if(this.getVertex(o,c,t),this.getVertex(o,l,e),this.getVertex(o,d,s),Math.abs(1-i.subVectors(t,e).length()/n.subVectors(t,s).length())>.01){r=!1;break}}else for(let s=0;s<u;s++){const n=[];this.getVertex(o,c[s],t);for(let r=0;r<u;r++)r!==s&&(this.getVertex(o,c[r],e),n.push(i.subVectors(t,e).length()));if(n.sort(((t,e)=>t-e)),Math.abs(1-n[0]/n[1])>.01){r=!1;break}}}return r}})()),nt(this,"getFaceCenter",(()=>{const t=new Qt,e=new Qt;return(s,i,n)=>{const r=i?i.indicesLength():n.length;if(!(r<4)){t.set(0,0,0);for(let o=0;o<r;o++){const r=i?i.indices(o):n[o];this.getVertex(s,r,e),t.addVectors(t,e)}return t.multiplyScalar(1/r),t.clone()}}})()),nt(this,"isTubeLikeShape",(()=>{const t=new Qt,e=new Qt,s=new Qt,i=new Qt,n=new Qt,r=new Qt,o=new ka,a=new li,h=[],c=[],l=[],u=[],d=[];let p;return m=>{const f=this.getShell(m);c.length=0,l.length=0;for(let t=0,e=f.profilesLength();t<e;t++){if(f.profiles(t,o),o.indicesLength()<4)return!1;4===o.indicesLength()&&l.push(t),o.indicesLength()>4&&c.push(t)}if(0!==c.length&&2!==c.length||l.length<7)return!1;h.length=0,p=this.getWiresForVertices(f);for(let t=0,i=l.length;t<i;t++){f.profiles(l[t],o);for(let i=0,n=o.indicesLength();i<n;i++){const r=o.indices(i),a=i===n-1?o.indices(0):o.indices(i+1);this.getVertex(f,r,e),this.getVertex(f,a,s);const l=p.get(r).filter((t=>!c.includes(t))),u=p.get(a).filter((t=>!c.includes(t)));if(h.filter((t=>t.includes(r)&&t.includes(a))).length)continue;l.filter((t=>-1!==u.indexOf(t))).filter((e=>e!==t)).length&&h.push([r,a])}}this.getVertex(f,h[0][0],e),this.getVertex(f,h[0][1],s),n.subVectors(e,s).normalize();for(let t=1,i=h.length;t<i;t++){if(this.getVertex(f,h[t][0],e),this.getVertex(f,h[t][1],s),r.subVectors(e,s).normalize(),Math.abs(n.dot(r))<=.999)return!1;n.dot(r)<-.999&&(h[t]=[h[t][1],h[t][0]])}u.length=0,u.push(h[0][0]),u.push(h[1][0]),u.push(h[2][0]),this.getVertex(f,h[0][0],e),this.getVertex(f,h[1][0],s),this.getVertex(f,h[2][0],i),a.setFromCoplanarPoints(e,s,i);for(let e=3,s=h.length;e<s;e++)if(this.getVertex(f,h[e][0],t),u.push(h[e][0]),a.distanceToPoint(t)>.001)return!1;const g=this.getFaceCenter(f,void 0,u);if(!this.isCircularFace(f,g,void 0,u))return!1;d.length=0,d.push(h[0][1]),d.push(h[1][1]),d.push(h[2][1]),this.getVertex(f,h[0][1],e),this.getVertex(f,h[1][1],s),this.getVertex(f,h[2][1],i),a.setFromCoplanarPoints(e,s,i);for(let e=3,s=h.length;e<s;e++)if(this.getVertex(f,h[e][1],t),d.push(h[e][1]),a.distanceToPoint(t)>.001)return!1;const y=this.getFaceCenter(f,void 0,d);if(!this.isCircularFace(f,y,void 0,d))return!1;if(2===c.length){u.sort(((t,e)=>t-e)),d.sort(((t,e)=>t-e));for(const t of c){f.profiles(t,o);const e=Array.from(o.indicesArray()).sort(((t,e)=>t-e));if(!u.every(((t,s)=>e[s]===t))&&!d.every(((t,s)=>e[s]===t)))return!1}}return!0}})()),nt(this,"pickFace",(()=>{const t=new li,e=[],s=new Map,i=new Qt,n=new Qt,r=new Qt;return(o,a)=>{const h=this.getShell(o);e.length=0,s.clear();for(let t=0;t<h.holesLength();t++){const e=h.holes(t).profile();s.has(e)?s.get(e).push(t):s.set(h.holes(t).profile(),[t])}const c=this.getVertexDataSize(this.geometryType),l=this.getShellData(h,c);for(let o=0,u=h.profilesLength();o<u;o++){const u=h.profiles(o).indicesArray();this.v0.set(0,0,0),this.v1.set(0,0,0),this.v2.set(0,0,0),this.n1.set(0,0,0);if(3===u.length){let t=u[0],s=u[1],o=u[2];t*=c,s*=c,o*=c,i.set(l[t],l[t+1],l[t+2]),n.set(l[s],l[s+1],l[s+2]),r.set(l[o],l[o+1],l[o+2]);const h=this.intersectTriangle(a,i,n,r);h&&e.push(h);continue}const d=u[0]*c;if(this.v0.set(l[d],l[d+1],l[d+2]),Yh(this.n1,l,u,c),t.setFromNormalAndCoplanarPoint(this.n1,this.v0),a.intersectPlane(t,this.v1)){if(s.has(o)){const e=s.get(o);if(this.insideHole(this.v1,t,e,h,l))continue}this.pointInsidePolygon(this.v1,l,u,c,t)&&e.push({point:this.v1.clone(),normal:t.normal.clone()})}}return e}})()),nt(this,"pickLine",(()=>{const t=new ka,e=new Qt,s=new Qt,i=new Qt,n=[];let r;return(o,a,h)=>{const c=this.getShell(o);n.length=0,this.getShellProfileNormals(c,n),r=this.getWiresForVertices(c);const l=[];for(let o=0,u=c.profilesLength();o<u;o++){c.profiles(o,t);for(let u=0,d=t.indicesLength();u<d;u++){const p=t.indices(u),m=u===d-1?t.indices(0):t.indices(u+1);if(this.getVertex(c,p,e),this.getVertex(c,m,s),a.distanceSqToSegment(e,s,void 0,i),h.containsPoint(i)){const t=r.get(p),a=r.get(m),h=t.filter((t=>-1!==a.indexOf(t))).filter((t=>t!==o));if(h.length&&n[h[0]].dot(n[o])>Math.cos(gh.pickableAngleInRadian))continue;l.push({point:i.clone(),normal:n[o],snapLineStart:e.clone(),snapLineEnd:s.clone()})}}}return l}})()),nt(this,"pickClipPlaneSectionLine",(()=>{const t=new ka,e=new Qt,s=new Qt,i=new Qt,n=new ki,r=[];return(o,a,h,c)=>{const l=this.getShell(o),u=[];for(let o=0,d=l.profilesLength();o<d;o++){l.profiles(o,t),this.getVertex(l,t.indices(t.indicesLength()-1),s);for(const o of c){r.length=0;for(let a=0,h=t.indicesLength();a<h;a++)this.getVertex(l,t.indices(a),e),n.set(e,s),o.intersectsLine(n)&&(o.intersectLine(n,i),r.some((t=>t.equals(i)))||r.push(i.clone())),s.copy(e);2===r.length&&(a.distanceSqToSegment(r[0],r[1],void 0,i),h.containsPoint(i)&&u.push({point:i.clone(),snapLineStart:r[0].clone(),snapLineEnd:r[1].clone()}))}}return u}})()),nt(this,"pickClipPlaneSectionPoint",(()=>{const t=new ka,e=new Qt,s=new Qt,i=new Qt,n=new ki,r=[];return(o,a,h)=>{const c=this.getShell(o),l=[];r.length=0;for(let o=0,a=c.profilesLength();o<a;o++){c.profiles(o,t),this.getVertex(c,t.indices(t.indicesLength()-1),s);for(const o of h)for(let a=0,h=t.indicesLength();a<h;a++)this.getVertex(c,t.indices(a),e),n.set(e,s),o.intersectsLine(n)&&(o.intersectLine(n,i),r.some((t=>t.equals(i)))||r.push(i.clone())),s.copy(e)}return r.forEach((t=>{a.containsPoint(t)&&l.push({point:t.clone()})})),l}})()),nt(this,"pickPoint",(()=>{const t=new Qt;return(e,s,i)=>{const n=this.getShell(e),r=[];for(let e=0,s=n.verticesLength();e<s;e++)this.getVertex(n,e,t),i.containsPoint(t)&&r.push({point:t.clone()});return r}})()),nt(this,"getShellProfileNormals",(()=>(t,e)=>{const s=t.profilesLength();for(let i=0;i<s;i++){const s=t.profiles(i);e.push(this.calculateWireNormal(t,s))}return e})()),nt(this,"calculateWireNormal",(()=>{const t=new Qt,e=new Qt,s=new Qt;return(i,n)=>{const r=n.indicesLength();if(i.verticesLength()<=2||r<=2)return new Qt(1,0,0);s.set(0,0,0);for(let o=0;o<r;o++){const a=(o+1)%r;this.getVertex(i,n.indices(o),t),this.getVertex(i,n.indices(a),e),s.x+=(t.y-e.y)*(t.z+e.z),s.y+=(t.z-e.z)*(t.x+e.x),s.z+=(t.x-e.x)*(t.y+e.y)}return s.clone().normalize()}})()),nt(this,"getWiresForVertices",(()=>{const t=new ka,e=new Ea,s=new Map;return i=>{s.clear();const n=i.profilesLength();for(let e=0;e<n;e++){i.profiles(e,t);for(let i=0,n=t.indicesLength();i<n;i++){const n=t.indices(i);s.has(n)?s.get(n).push(e):s.set(n,[e])}}for(let t=0;t<i.holesLength();t++){const n=i.holes(t).profile();i.holes(t,e);for(let t=0,i=e.indicesLength();t<i;t++){const i=e.indices(t);s.has(i)?s.get(i).push(n):s.set(i,[n])}}return s}})()),nt(this,"getVertexAveragedNormals",(()=>{let t,e=new Qt;return(s,i,n,r)=>{(!t||t.length<3*s.length)&&(t=new Int16Array(3*s.length));const o=n[i];for(let i=0;i<s.length;i++){const a=r.get(s[i]);if(e.set(0,0,0),a&&a.length)if(1===a.length)e=n[a[0]].clone();else for(const t of a){const s=n[t];o.dot(s)>gh.SMOOTH_LIMIT&&e.add(s)}else e.set(1,0,0);e.normalize().multiplyScalar(ph),e.toArray(t,3*i)}return t}})()),nt(this,"getVertex",(()=>{const t=new Ia;return(e,s,i)=>{e instanceof Va&&e.vertices(s,t),i.set(t.x(),t.y(),t.z())}})()),nt(this,"insideHole",(()=>(t,e,s,i,n)=>{for(let r=0,o=s.length;r<o;r++){const o=i.holes(s[r]).indicesArray();if(this.pointInsidePolygon(t,n,o,3,e))return!0}return!1})()),nt(this,"intersectTriangle",(()=>{const t=new ms,e=new Qt;return(s,i,n,r)=>{if(t.a=i,t.b=n,t.c=r,s.intersectTriangle(i,n,r,!1,e))return{point:e.clone(),normal:t.getNormal(new Qt)}}})()),nt(this,"pointInsidePolygon",(()=>{const t=new Qt,e=new Qt,s=new Qt;return(i,n,r,o,a)=>{this.createOrthonormalBasis(a.normal,e,t);const h=r.length,c=r[h-1]*o,l=s.set(n[c],n[c+1],n[c+2]).sub(i);let u=l.dot(t),d=l.dot(e),p=!1;for(let a=0;a<h;a++){const h=r[a]*o,c=s.set(n[h],n[h+1],n[h+2]).sub(i),l=c.dot(t),m=c.dot(e);m>0!=d>0&&(u-l)*-m/(d-m)+l>0&&(p=!p),u=l,d=m}return p}})())}isFaceCenterPickable(t,e,s,i,n){const r=this.checksum.clear().add(t).add(s.x).add(s.y).add(s.z).get();let o=this.faceCenterPickableMap.get(r);return void 0!==o||(o=this.isCircularFace(e,s,i,n),this.faceCenterPickableMap.set(r,o)),o}getGeometries(t,e=!0){const s=this.getCachedGeometry(t);if((Array.isArray(s)&&!s[0].positions||!s.positions)&&e){const e=this.getShell(t);this.build(e,s),this.calculateMemSizeAndCache(t,s)}return s}getVertexDataSize(t){return 3}getShellData(t,e){const s=t.bb.__offset(t.bb_pos,8);return new Float32Array(t.bb.bytes().buffer,t.bb.__vector(t.bb_pos+s),t.verticesLength()*e)}pick(t,e,s){return this.pickFace(t,e)}createOrthonormalBasis(t,e,s){if(Math.abs(t.x)>=Math.abs(t.y)){const i=1/Math.sqrt(t.x*t.x+t.z*t.z);e.set(-t.z*i,0,t.x*i),s.set(t.y*e.z,t.z*e.x-t.x*e.z,-t.y*e.x)}else{const i=1/Math.sqrt(t.y*t.y+t.z*t.z);e.set(0,t.z*i,-t.y*i),s.set(t.y*e.z-t.z*e.y,-t.x*e.z,t.x*e.y)}e.normalize(),s.normalize()}}class qh extends Gh{constructor(){super(...arguments),nt(this,"geometryType",Ga.Shell),nt(this,"getShell",(()=>{const t=new Va;return e=>this.geometry.shells(e,t)})())}createGeometryPrototypes(){for(let t=0,e=this.geometry.shellsLength();t<e;t++){const e=this.getShell(t);this.setGeometryPrototype(t,this.createGeometryPrototype(e))}}}const Wh=(()=>{const t=new Qt,e=new Qt,s=new Qt,i=new Qt,n=new Qt,r=new Qt,o=new Qt,a=new Qt,h=new Qt;let c=0,l=0,u=0,d=0;return(p,m,f,g,y,b,x)=>{c=p[0],l=p[1],u=p[2],d=p[3],y===Ga.Shell&&(c*=3,l*=3,u*=3,d*=3),t.set(m[c],m[c+1],m[c+2]),e.set(m[l],m[l+1],m[l+2]),s.set(m[u],m[u+1],m[u+2]),i.set(m[d],m[d+1],m[d+2]),n.copy(e),r.copy(s),o.copy(i),n.sub(t),r.sub(t),o.sub(t),a.crossVectors(n,r),h.crossVectors(r,o),a.dot(h)>0?(b.indices[x.index_count]=x.vertex_count,b.indices[x.index_count+1]=x.vertex_count+1,b.indices[x.index_count+2]=x.vertex_count+3,b.indices[x.index_count+3]=x.vertex_count+3,b.indices[x.index_count+4]=x.vertex_count+1,b.indices[x.index_count+5]=x.vertex_count+2,x.index_count+=6,b.positions[x.vertex_length]=t.x,b.positions[x.vertex_length+1]=t.y,b.positions[x.vertex_length+2]=t.z,b.positions[x.vertex_length+3]=e.x,b.positions[x.vertex_length+4]=e.y,b.positions[x.vertex_length+5]=e.z,b.positions[x.vertex_length+6]=s.x,b.positions[x.vertex_length+7]=s.y,b.positions[x.vertex_length+8]=s.z,b.positions[x.vertex_length+9]=i.x,b.positions[x.vertex_length+10]=i.y,b.positions[x.vertex_length+11]=i.z,b.normals[x.normal_length]=f[0],b.normals[x.normal_length+1]=f[1],b.normals[x.normal_length+2]=f[2],b.normals[x.normal_length+3]=f[3],b.normals[x.normal_length+4]=f[4],b.normals[x.normal_length+5]=f[5],b.normals[x.normal_length+6]=f[6],b.normals[x.normal_length+7]=f[7],b.normals[x.normal_length+8]=f[8],b.normals[x.normal_length+9]=f[9],b.normals[x.normal_length+10]=f[10],b.normals[x.normal_length+11]=f[11],x.normal_length+=12,x.vertex_count+=4,x.vertex_length+=12):jh(p,m,f,g,y,b,void 0,x)}})(),Hh=(()=>(t,e,s,i,n,r)=>{let o=t[0],a=t[1],h=t[2];i===Ga.Shell&&(o*=3,a*=3,h*=3),n.indices[r.index_count]=r.vertex_count,n.indices[r.index_count+1]=r.vertex_count+1,n.indices[r.index_count+2]=r.vertex_count+2,r.index_count+=3,n.positions[r.vertex_length]=e[o+0],n.positions[r.vertex_length+1]=e[o+1],n.positions[r.vertex_length+2]=e[o+2],n.positions[r.vertex_length+3]=e[a+0],n.positions[r.vertex_length+4]=e[a+1],n.positions[r.vertex_length+5]=e[a+2],n.positions[r.vertex_length+6]=e[h+0],n.positions[r.vertex_length+7]=e[h+1],n.positions[r.vertex_length+8]=e[h+2],n.normals[r.normal_length]=s[0],n.normals[r.normal_length+1]=s[1],n.normals[r.normal_length+2]=s[2],n.normals[r.normal_length+3]=s[3],n.normals[r.normal_length+4]=s[4],n.normals[r.normal_length+5]=s[5],n.normals[r.normal_length+6]=s[6],n.normals[r.normal_length+7]=s[7],n.normals[r.normal_length+8]=s[8],r.normal_length+=9,r.vertex_count+=3,r.vertex_length+=9})(),jh=(()=>{const t=new Qt;return(e,s,i,n,r,o,a,h)=>{const c=e.length,l=h.vertex_length;if(r===Ga.Shell)for(let t=0;t<c;t++){const n=3*e[t];o.positions[h.vertex_length]=s[n],o.positions[h.vertex_length+1]=s[n+1],o.positions[h.vertex_length+2]=s[n+2],o.normals.set([i[3*t],i[3*t+1],i[3*t+2]],h.normal_length),h.vertex_count+=1,h.vertex_length+=3,h.normal_length+=3}let u;if(Zh(o.positions,t,(h.vertex_length-l)/3,l),a&&a.has(n)){const t=a.get(n);u=t.indices.map((t=>t+c)),o.positions.set(t.vertices,h.vertex_length),h.vertex_length+=t.vertices.length,h.vertex_count+=t.vertices.length/3,o.normals.set(t.normals,h.normal_length),h.normal_length+=t.vertices.length}const d=new Float32Array(o.positions.buffer,4*l,h.vertex_length-l),p=function(t,e){const s=Math.abs(e.x),i=Math.abs(e.y),n=Math.abs(e.z);return n>s&&n>i?e.z>0?[0,1]:[1,0]:i>s&&i>n?e.y>0?[2,0]:[0,2]:e.x>0?[1,2]:[2,1]}(0,t);yh(d,u,3,p[0],p[1],((t,e,s)=>{o.indices[h.index_count++]=t+l/3,o.indices[h.index_count++]=e+l/3,o.indices[h.index_count++]=s+l/3}))}})(),Zh=(t,e,s,i=0)=>{e.set(0,0,0);let n=0;for(let r=0,o=s;r<o;r++)n=(r+1)%s,e.x+=(t[i+3*r+1]-t[i+3*n+1])*(t[i+3*r+2]+t[i+3*n+2]),e.y+=(t[i+3*r+2]-t[i+3*n+2])*(t[i+3*r]+t[i+3*n]),e.z+=(t[i+3*r]-t[i+3*n])*(t[i+3*r+1]+t[i+3*n+1]);e.normalize()},Yh=(t,e,s,i)=>{t.set(0,0,0);for(let n=0,r=s.length;n<r;n++){const o=(n+1)%r,a=s[n]*i,h=s[o]*i;t.x+=(e[a+1]-e[h+1])*(e[a+2]+e[h+2]),t.y+=(e[a+2]-e[h+2])*(e[a]+e[h]),t.z+=(e[a]-e[h])*(e[a+1]+e[h+1])}t.normalize()};class Xh extends gh{constructor(){super(...arguments),nt(this,"pickLine",(()=>{const t=[];return(e,s,i)=>{t.length=0;return this.pickLineWithCallback(e,s,((e,s,n,r,o)=>{i.containsPoint(s)&&t.push({point:s.clone(),distanceSqToRay:o,snapLineStart:n.clone(),snapLineEnd:r.clone()})})),t}})())}}function Jh(t,e){const s=new Qt,i=new Qt,n=new Qt,r=new Qt,o=[],a=[];s.set(t.center().x(),t.center().y(),t.center().z()),i.set(t.axis().x(),t.axis().y(),t.axis().z()),n.set(t.refDirection().x(),t.refDirection().y(),t.refDirection().z());for(let r=0;r<e-2;r++)o[r]=new Qt,o[r].copy(n),o[r].applyAxisAngle(i,t.angle()*(r+1)/(e-1)),o[r].multiplyScalar(t.radius()),o[r].add(s);return r.copy(n),r.applyAxisAngle(i,t.angle()),r.multiplyScalar(t.radius()),r.add(s),n.multiplyScalar(t.radius()),n.add(s),a.push(n),a.push(...o),a.push(r),a}class Qh extends Xh{constructor(){super(...arguments),nt(this,"geometryType",Ga.SweptDisk),nt(this,"snapGeometryType",Di.LINE),nt(this,"lineLODType",mh.BuilderGenerated),nt(this,"sds",new Ra),nt(this,"directrix",new La),nt(this,"arc",new Ba),nt(this,"polyline",new Ca),nt(this,"positionPointer"),nt(this,"indexPointer"),nt(this,"pointer",0),nt(this,"buildLineLOD",(()=>(t,e)=>{this.pointer=0,e.positions=new Float32Array(e.positionsLength);for(let s=0,i=t.axesLength();s<i;s++){const i=t.axes(s,this.directrix);for(let t=0;t<i.indexesLength();t++)this.buildSegmentLineLOD(i,t,e)}return e})()),nt(this,"calculateSegmentSize",(()=>{const t={verticesLength:0,indicesLength:0};return(e,s,i)=>{const n=e.types(s),r=e.indexes(s);let o=0,a=0,h=0,c=0;switch(n){case Ya.Line:o=2*i,a=6*i,h=2;break;case Ya.PolyLine:{e.polyLines(r,this.polyline);const t=this.polyline.pointsLength()-1;o=2*t*i,a=6*t*i,h=2*t}break;case Ya.Arc:{e.arcs(r,this.arc);const t=ih(this.arc);o=i*t,a=6*i*(t-1),h=2,c=2}}const l=h*(i-2)*3,u=c*i*6;return t.verticesLength=o,t.indicesLength=a+l+u,t}})()),nt(this,"arcCrossSections",[]),nt(this,"lineStart",new Qt),nt(this,"lineEnd",new Qt),nt(this,"lineQuaternion",new Jt),nt(this,"crossSectionPoints"),nt(this,"tmp",new Qt),nt(this,"getVertex",(()=>(t,e,s)=>s.set(e.positions[3*t],e.positions[3*t+1],e.positions[3*t+2]))()),nt(this,"getMatchCrossSectionPoint",(()=>{const t=new Qt,e=new Qt,s=new Qt,i=new Qt,n=new ki;let r,o,a;return(h,c,l)=>{o=1/0;for(let u=0;u<l;u++){r=0;for(let o=h;o<h+l;o++){this.getVertex(o,c,t);const a=o-l+u;this.getVertex(a>=h?a-l:a,c,e),this.getVertex(a+1>=h?a+1-l:a+1,c,s),n.set(e,s),n.closestPointToPoint(t,!0,i),r+=i.distanceTo(t)}r<o&&(o=r,a=h-l+u+1)}return a}})()),nt(this,"pick",(()=>{const t=[],e=new Ra,s=new La;return(i,n)=>{t.length=0,this.geometry.sweptDisks(i,e);for(let i=0,r=e.axesLength();i<r;i++){e.axes(i,s);const r=e.radius(i);nh(s,((e,s)=>{t.push(...uh(e,s,n,r))})),rh(s,((e,s,i)=>{t.push(...uh(e,s[0],n,r)),s.forEach(((e,i)=>{i>0&&t.push(...uh(s[i-1],e,n,r))})),t.push(...uh(s[s.length-1],i,n,r))}),ih),oh(s,((e,s)=>{t.push(...uh(e,s,n,r))}))}return t}})()),nt(this,"pickLine",(()=>{const t=[],e=new Ra,s=new La;return(i,n,r)=>{t.length=0;const o=(e,s,i,n,r)=>{t.push({point:s.clone(),distanceSqToRay:r,snapLineStart:i.clone(),snapLineEnd:n.clone()})};this.geometry.sweptDisks(i,e);for(let t=0,i=e.axesLength();t<i;t++){e.axes(t,s);const i=e.radius(t);sc(s,n,o,i),ic(s,n,ih,o,i),nc(s,n,o,i)}return t}})()),nt(this,"pickLineWithCallback",(()=>{const t=new Ra,e=new La;return(s,i,n)=>{this.geometry.sweptDisks(s,t);for(let s=0,r=t.axesLength();s<r;s++)t.axes(s,e),ah(e,i,n),hh(e,i,ih,n),ch(e,i,n)}})()),nt(this,"pickPoint",(()=>{const t=[],e=new Ra,s=new La;return(i,n,r)=>{t.length=0,this.geometry.sweptDisks(i,e);for(let i=0,r=e.axesLength();i<r;i++){e.axes(i,s);const r=e.radius(i),o=this.getCrossSectionsPointCount(r);this.updateCrossSectionsPoints(o),nh(s,((e,s)=>{this.tmp.copy(e).sub(s).normalize(),this.lineQuaternion.setFromUnitVectors(th.up,this.tmp),t.push(dh(e,this.lineQuaternion,n,r)),t.push(dh(s,this.lineQuaternion,n,r))})),rh(s,((e,s,i)=>{this.tmp.copy(e).sub(s[0]).normalize(),this.lineQuaternion.setFromUnitVectors(th.up,this.tmp),t.push(dh(e,this.lineQuaternion,n,r)),this.tmp.copy(s[s.length-1]).sub(i).normalize(),this.lineQuaternion.setFromUnitVectors(th.up,this.tmp),t.push(dh(i,this.lineQuaternion,n,r))}),ih),oh(s,((e,s)=>{this.tmp.copy(e).sub(s).normalize(),this.lineQuaternion.setFromUnitVectors(th.up,this.tmp),t.push(dh(e,this.lineQuaternion,n,r)),t.push(dh(s,this.lineQuaternion,n,r))}))}return t.filter((t=>void 0!==t))}})())}getCrossSectionsPointCount(t,e=200){const s=Math.round(t*e);return Math.min(Math.max(s,6),30)}getGeometries(t,e){const s=this.getCachedGeometryDatas(t);return e&&s.length&&!s[0].positions&&(this.geometry.sweptDisks(t,this.sds),this.build(this.sds,s),this.calculateMemSizeAndCache(t,s)),s}getLineLODGeometry(t,e){const s=this.getCachedGeometryData(t,Gi.Line);return e&&!s.positions&&(this.geometry.sweptDisks(t,this.sds),this.buildLineLOD(this.sds,s),this.calculateMemSizeAndCache(t,s,Gi.Line)),s}buildSegmentLineLOD(t,e,s){const i=t.types(e),n=t.indexes(e);switch(i){case Ya.Line:const e=t.lines(n),i=e.start(),r=e.end();s.positions[this.pointer]=i.x(),s.positions[this.pointer+1]=i.y(),s.positions[this.pointer+2]=i.z(),s.positions[this.pointer+3]=r.x(),s.positions[this.pointer+4]=r.y(),s.positions[this.pointer+5]=r.z(),this.pointer+=6;break;case Ya.PolyLine:const o=t.polyLines(n);for(let t=1,e=o.pointsLength();t<e;t++)s.positions[this.pointer]=o.points(t-1).x(),s.positions[this.pointer+1]=o.points(t-1).y(),s.positions[this.pointer+2]=o.points(t-1).z(),s.positions[this.pointer+3]=o.points(t).x(),s.positions[this.pointer+4]=o.points(t).y(),s.positions[this.pointer+5]=o.points(t).z(),this.pointer+=6;break;case Ya.Arc:const a=t.arcs(n),h=ih(a);this.arcCrossSections=Jh(a,h);for(let t=1;t<h;t++)s.positions[this.pointer]=this.arcCrossSections[t-1].x,s.positions[this.pointer+1]=this.arcCrossSections[t-1].y,s.positions[this.pointer+2]=this.arcCrossSections[t-1].z,s.positions[this.pointer+3]=this.arcCrossSections[t].x,s.positions[this.pointer+4]=this.arcCrossSections[t].y,s.positions[this.pointer+5]=this.arcCrossSections[t].z,this.pointer+=6}}createLineLODPrototype(t){const e={objectType:Di.LINE,lodLevel:Gi.Line,lodWidth:0,positionsLength:0};for(let s=0,i=t.axesLength();s<i;s++){const i=t.axes(s,this.directrix);for(let t=0;t<i.indexesLength();t++)this.calculateSegmentPositionLength(i,t,e);e.lodWidth=Math.max(e.lodWidth,t.radius(s))}return e}calculateSegmentPositionLength(t,e,s){const i=t.types(e),n=t.indexes(e);switch(i){case Ya.Line:s.positionsLength+=6;break;case Ya.PolyLine:const e=t.polyLines(n,this.polyline).pointsLength()-1;s.positionsLength+=6*e;break;case Ya.Arc:const i=ih(t.arcs(n,this.arc));s.positionsLength+=6*(i-1)}}createGeometryPrototypes(){for(let t=0,e=this.geometry.sweptDisksLength();t<e;t++)this.geometry.sweptDisks(t,this.sds),this.setGeometryPrototype(t,this.createGeometryPrototype(this.sds),Gi.Full),this.setGeometryPrototype(t,this.createLineLODPrototype(this.sds),Gi.Line)}createDirectrixPrototypes(t,e,s){const i=t.radius(e),n=t.axes(e,this.directrix),r=this.getCrossSectionsPointCount(i);let o=s[s.length-1];for(let t=0;t<n.indexesLength();t++){const e=this.calculateSegmentSize(n,t,r),i=!o;!i&&tc(o.positionsLength/3,e.verticesLength,r)||(o={objectType:Di.MESH,indicesLength:0,positionsLength:0,normalsLength:0},s.push(o),i||0===t||(o.positionsLength+=3*r,o.normalsLength+=3*r,o.indicesLength+=3*(r-2))),o.positionsLength+=3*e.verticesLength,o.normalsLength+=3*e.verticesLength,o.indicesLength+=e.indicesLength}}createGeometryPrototype(t){const e=[];for(let s=0,i=t.axesLength();s<i;s++)this.createDirectrixPrototypes(t,s,e);return e}build(t,e){let s,i=0,n=0;const r={};for(let o=0,a=t.axesLength();o<a;o++){const a=t.radius(o),h=t.axes(o,this.directrix),c=this.getCrossSectionsPointCount(a);for(let t=0;t<h.indexesLength();t++){const o=this.calculateSegmentSize(h,t,c),l=!s;if(0===t&&(r.isStartSegment=!0),t===h.indexesLength()-1&&(r.isEndSegment=!0),l||!tc(n,o.verticesLength,c)){s=e[i++],s.positions=new Float32Array(s.positionsLength),s.normals=new Int16Array(s.normalsLength),s.indices=new Uint16Array(s.indicesLength);const r=this.positionPointer;if(this.positionPointer=0,this.indexPointer=0,n=0,!l&&0!==t){const t=e[i-2];this.copyLastCrossSection(t,s,r,c),n+=c}}this.buildDirectrixSegment(h,t,s,a,c,r),n+=o.verticesLength}}}copyLastCrossSection(t,e,s,i){for(let n=3*-i;n<0;++n)e.positions[this.positionPointer]=t.positions[s+n],e.normals[this.positionPointer]=t.normals[s+n],this.positionPointer++}buildDirectrixSegment(t,e,s,i,n,r){const o=t.types(e),a=t.indexes(e);switch(o){case Ya.Line:this.buildLineSegment(t.lines(a),i,s,n,r);break;case Ya.PolyLine:this.buildPolyLine(t.polyLines(a),i,s,n,r);break;case Ya.Arc:this.buildArc(t.arcs(a),i,s,n,r)}r.isStartSegment=!1,r.isEndSegment=!1}buildPolyLine(t,e,s,i,n){for(let r=1,o=t.pointsLength();r<o;r++)this.lineStart.set(t.points(r-1).x(),t.points(r-1).y(),t.points(r-1).z()),this.lineEnd.set(t.points(r).x(),t.points(r).y(),t.points(r).z()),this.tmp.copy(this.lineEnd).sub(this.lineStart).normalize(),this.lineQuaternion.setFromUnitVectors(th.up,this.tmp),this.buildCrossSection(this.lineStart,e,this.lineQuaternion,s,i),1===r?this.connectFirstCrossSection(s,i,n,this.lineStart,Ya.PolyLine):this.buildCrossSectionIndices(s,i),this.buildCrossSection(this.lineEnd,e,this.lineQuaternion,s,i),r!==o-1||n.isEndSegment?this.buildCrossSectionIndices(s,i,!0):(n.position=this.lineEnd,n.type=Ya.PolyLine),this.connectCrossSections(s,i)}connectFirstCrossSection(t,e,s,i,n){s.isStartSegment?this.buildCrossSectionIndices(t,e):Kh(s.type,n)&&$h(s.position,i)?this.connectCrossSections(t,e,!0):(this.buildCrossSectionIndices(t,e,!0,!0),this.buildCrossSectionIndices(t,e))}buildStartCrossSection(t,e,s,i,n){this.tmp.copy(e).sub(t).normalize(),this.lineQuaternion.setFromUnitVectors(th.up,this.tmp),this.buildCrossSection(t,s,this.lineQuaternion,i,n)}buildMidCrossSection(t,e,s,i,n,r){this.tmp.copy(s).sub(t).normalize(),this.lineQuaternion.setFromUnitVectors(th.up,this.tmp),this.buildCrossSection(e,i,this.lineQuaternion,n,r),this.connectCrossSections(n,r,!0)}buildEndCrossSection(t,e,s,i,n){this.tmp.copy(e).sub(t).normalize(),this.lineQuaternion.setFromUnitVectors(th.up,this.tmp),this.buildCrossSection(e,s,this.lineQuaternion,i,n)}buildArc(t,e,s,i,n){const r=ih(t);this.arcCrossSections=Jh(t,r),this.buildStartCrossSection(this.arcCrossSections[0],this.arcCrossSections[1],e,s,i),this.connectFirstCrossSection(s,i,n,this.arcCrossSections[0],Ya.Arc);for(let t=0;t<r-2;t++)this.buildMidCrossSection(this.arcCrossSections[t],this.arcCrossSections[t+1],this.arcCrossSections[t+2],e,s,i);this.buildEndCrossSection(this.arcCrossSections[r-2],this.arcCrossSections[r-1],e,s,i),n.isEndSegment?this.buildCrossSectionIndices(s,i,!0):(n.position=this.arcCrossSections[r-1],n.type=Ya.Arc),this.connectCrossSections(s,i,!0)}buildLineSegment(t,e,s,i,n){const r=t.start(),o=t.end();this.lineStart.set(r.x(),r.y(),r.z()),this.lineEnd.set(o.x(),o.y(),o.z()),this.tmp.copy(this.lineEnd).sub(this.lineStart).normalize(),this.lineQuaternion.setFromUnitVectors(th.up,this.tmp),this.buildCrossSection(this.lineStart,e,this.lineQuaternion,s,i),this.connectFirstCrossSection(s,i,n,this.lineStart,Ya.Line),this.buildCrossSection(this.lineEnd,e,this.lineQuaternion,s,i),n.isEndSegment?this.buildCrossSectionIndices(s,i,!0):(n.position=this.lineEnd,n.type=Ya.Line),this.connectCrossSections(s,i)}buildCrossSection(t,e,s,i,n){this.updateCrossSectionsPoints(n);for(let r=0;r<n;r++)this.tmp.copy(this.crossSectionPoints[r]).multiplyScalar(e).applyQuaternion(s).add(t),i.positions[this.positionPointer]=this.tmp.x,i.positions[this.positionPointer+1]=this.tmp.y,i.positions[this.positionPointer+2]=this.tmp.z,this.tmp.copy(this.crossSectionPoints[r]).applyQuaternion(s),i.normals[this.positionPointer]=this.tmp.x*ph,i.normals[this.positionPointer+1]=this.tmp.y*ph,i.normals[this.positionPointer+2]=this.tmp.z*ph,this.positionPointer+=3}updateCrossSectionsPoints(t){if(!this.crossSectionPoints||this.crossSectionPoints.length!==t){this.crossSectionPoints=[];for(let e=0;e<t;e++){const s=2*Math.PI*e/t;this.crossSectionPoints.push(new Qt(Math.sin(s),Math.cos(s),0))}}}buildCrossSectionIndices(t,e,s=!1,i=!1){for(let n=0;n<e-2;n++)t.indices[this.indexPointer++]=this.positionPointer/3-e*(i?2:1),t.indices[this.indexPointer++]=this.positionPointer/3+n+(s?2:1)-e*(i?2:1),t.indices[this.indexPointer++]=this.positionPointer/3+n+(s?1:2)-e*(i?2:1)}connectCrossSections(t,e,s=!1){const i=this.positionPointer/3-e,n=i;let r=i-e;s&&(r=this.getMatchCrossSectionPoint(i,t,e));for(let s=0;s<e;s++){const o=(s+1)%e,a=r+s>=i?r+s-e:r+s,h=r+o>=i?r+o-e:r+o,c=n+s>=i+e?n+s-e:n+s,l=n+o>=i+e?n+o-e:n+o;t.indices[this.indexPointer++]=c,t.indices[this.indexPointer++]=l,t.indices[this.indexPointer++]=a,t.indices[this.indexPointer++]=a,t.indices[this.indexPointer++]=l,t.indices[this.indexPointer++]=h}}pickFace(t,e){}}const $h=(t,e)=>t.distanceToSquared(e)<1e-8,Kh=(t,e)=>t===Ya.Arc||e===Ya.Arc,tc=(t,e,s)=>t+e+s<=Vi,ec=(()=>{const t=new Qt;return(e,s,i,n,r)=>{uh(e,s,i,r).forEach((r=>{r.point&&(i.distanceSqToSegment(e,s,void 0,t),n(void 0,t,e,s,void 0))}))}})();function sc(t,e,s,i){nh(t,((t,n)=>{ec(t,n,e,s,i)}))}function ic(t,e,s,i,n){rh(t,((t,s,r)=>{ec(t,s[0],e,i,n),s.forEach(((t,r)=>{r>0&&ec(s[r-1],t,e,i,n)})),ec(s[s.length-1],r,e,i,n)}),s)}function nc(t,e,s,i){oh(t,((t,n)=>{ec(t,n,e,s,i)}))}class rc{constructor(t){nt(this,"nextMessageId",0),nt(this,"callbacks",new Map),nt(this,"processMessage",(t=>{t.data.isResponse?this.processResponse(t.data):this.processRequest(t.data)})),this.onRequest=t}setupPort(t){t.onmessage=this.processMessage}request(t,e){return t.messageId=this.nextMessageId++,new Promise((async(s,i)=>{this.callbacks.set(t.messageId,(t=>{t.error?i(t.error):s(t)}));(await this.getPort(t)).postMessage(t,e)}))}processResponse(t){const e=this.callbacks.get(t.messageId);this.callbacks.delete(t.messageId),e(t)}async processRequest(t){try{await this.onRequest(t)}catch(e){console.error(e),t.error=e.toString()}t.isResponse=!0,(await this.getPort(t)).postMessage(t)}}class oc extends rc{constructor(t,e){super(e),this.messagePort=t,this.setupPort(t)}async getPort(t){return this.messagePort}}class ac{constructor(){nt(this,"it",this),nt(this,"messenger")}setPort(t){this.messenger=new oc(t,(async t=>{const e=this.it[t.type];e?await e(t):console.warn(`Handler not found for worker message type ${t.type}`)}))}}class hc{constructor(t,e){nt(this,"actions",[]),nt(this,"intervalId"),this.modelId=t,this.messenger=e,this.intervalId=setInterval((()=>this.update()),50)}send(t){this.actions.push(t),this.actions.length>20&&this.update()}update(){if(0===this.actions.length)return;const t={type:qi.UPDATE_GEOMETRY,modelId:this.modelId,actions:this.actions};this.actions=[],this.messenger.request(t,hc.getTransferables(t))}static getTransferables(t){const e=[];for(const s of t.actions){if(s.actionType===Ni.ADD_BATCH){const t=s;t.positions&&e.push(t.positions.buffer),t.indices&&e.push(t.indices.buffer),t.normals&&e.push(t.normals.buffer),t.uvs&&e.push(t.uvs.buffer),t.pointUvs&&e.push(t.pointUvs.buffer),t.pointSizes&&e.push(t.pointSizes.buffer),t.ids&&e.push(t.ids.buffer)}if(s.actionType===Ni.ADD_BATCH||s.actionType===Ni.SET_BATCH_STATE){const t=s;t.state.visible&&(e.push(t.state.visible.starts.buffer),e.push(t.state.visible.counts.buffer)),t.state.hovered&&(e.push(t.state.hovered.starts.buffer),e.push(t.state.hovered.counts.buffer)),t.state.selected&&(e.push(t.state.selected.starts.buffer),e.push(t.state.selected.counts.buffer)),t.state.customMaterialRanges&&(e.push(t.state.customMaterialRanges.starts.buffer),e.push(t.state.customMaterialRanges.counts.buffer),e.push(t.state.customMaterialIds.buffer))}}return e}removePendingUpdateFinishedAction(){this.actions=this.actions.filter((t=>t.actionType!==Ni.UPDATE_FINISHED))}dispose(){clearInterval(this.intervalId)}}class cc{constructor(t){nt(this,"pickPriorityMask",3<<Wi.PICK_PRIORITY),nt(this,"state"),nt(this,"customMaterialIds"),this.length=t,this.state=new Uint8Array(t),this.customMaterialIds=new Uint16Array(t)}initialize(){this.state.fill(1<<Wi.VISIBILITY)}isVisible(t){return this.is(t,Wi.VISIBILITY)}isSelected(t){return this.is(t,Wi.SELECTION)}isHovered(t){return this.is(t,Wi.HOVER)}is(t,e){const s=1<<e;return!!(this.state[t]&s)}set(t,e,s){const i=1<<e;this.state[t]=s?this.state[t]|i:this.state[t]&~i}getPickPriority(t){return(this.state[t]&this.pickPriorityMask)>>Wi.PICK_PRIORITY}resetVisibility(){for(let t=0,e=this.state.length;t<e;t++)this.setVisible(t,!0)}setPickPriority(t,e){const s=e<<Wi.PICK_PRIORITY,i=this.state[t];this.state[t]=i&~this.pickPriorityMask|s}resetPickPriority(){for(let t=0,e=this.state.length;t<e;t++)this.setPickPriority(t,Ri.NORMAL)}setVisible(t,e){this.set(t,Wi.VISIBILITY,e)}setSelected(t,e){this.set(t,Wi.SELECTION,e)}setHovered(t,e){this.set(t,Wi.HOVER,e)}clearSelection(){for(let t=0,e=this.state.length;t<e;t++)this.setSelected(t,!1)}resetHovered(){for(let t=0,e=this.state.length;t<e;t++)this.setHovered(t,!1)}resetMaterialIds(){this.customMaterialIds.fill(0)}setCustomMaterialId(t,e){if(e>65535)throw new Error("Material ID 16 bit overflow");this.customMaterialIds[t]=e}getCustomMaterialId(t){return this.customMaterialIds[t]}}class lc{constructor(t){nt(this,"brepCentralLinePickableCache",new Map),nt(this,"pickBrepCentralLine",(()=>{const t=new Qt,e=new te;return(s,i,n,r)=>{Qa.getBoundingBox(s,e);const o=Qa.getBoundingBoxLongestAxis(e);i.distanceSqToSegment(o.start,o.end,void 0,t),n.containsPoint(t)&&r.push({point:t.clone(),snapLineStart:o.start.clone(),snapLineEnd:o.end.clone(),snapType:Ui.CENTER_LINE})}})()),this.queryManager=t}isBrepCentralLinePickable(t,e,s){return!1}pickCentralLine(t,e,s,i,n,r){t instanceof qh?this.isBrepCentralLinePickable(n,e.index(),t)&&this.pickBrepCentralLine(e,s,i,r):t instanceof Qh&&r.push(...t.pickLine(e.index(),s,i))}pickCenterPoint(t,e,s,i,n){t instanceof qh?n.push(...t.pickCenterPoint(e,s,i)):t instanceof Qh&&n.push(...t.pickPoint(e,s,i))}}nt(lc,"CENTER_LINE_SNAPPING_PROFILES",["IfcIShapeProfile","IfcCircleProfile","IfcCircleHollowProfile","IfcRectangleHollowProfile","IfcLShapeProfile","IfcUShapeProfile","IfcCShapeProfile","IfcCCShapeProfile","IfcTShapeProfile"]),nt(lc,"CENTER_LINE_SNAPPING_PROFILE_TYPE_NUMBER",[588,589,591,593,594,595,596,597]),new class{constructor(t,e,s=0,i=1/0){this.ray=new Ae(t,e),this.near=s,this.far=i,this.camera=null,this.layers=new Re,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return Li.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Li),this}intersectObject(t,e=!0,s=[]){return Fi(t,this,s,e),s.sort(Pi),s}intersectObjects(t,e=!0,s=[]){for(let i=0,n=t.length;i<n;i++)Fi(t[i],this,s,e);return s.sort(Pi),s}},(()=>{const t=new li,e=new li,s=new li,i=new li,n=new li,r=new li,o=new Qt,a=new Qt,h=new Qt,c=new Qt,l=new Qt,u=new Qt,d=new Pt,p=new Pt})();class uc{constructor(t,e,s,i){nt(this,"_geometry"),nt(this,"instance",new Pa),nt(this,"definition",new Oa),nt(this,"facePlane",new li),nt(this,"pickFollowLine",(()=>{const t=new Pa,e=new Ae,s=new Be,i=new Be;return(n,r)=>{let o,a=1/0;for(const h of this.boundingBoxManager.getItemInstanceIds(n)){this._geometry.instances(h,t),Qa.getTransform(t,this._geometry,s),i.copy(s).invert(),e.copy(r).applyMatrix4(i);const c=this.geometryManager.pickFollowLine(h,e);if(!c)continue;const l=e.distanceSqToPoint(c.point);l<a&&(a=l,o=c,o.instanceId=h,o.itemId=n,o.point.applyMatrix4(s),o.snapLineStart.applyMatrix4(s),o.snapLineEnd.applyMatrix4(s))}return o}})()),nt(this,"pickGeometry",(()=>{const t=new Ae,e=new pi,s=new Be,i=new Be,n=[];return(r,o,a,h,c,l,u)=>{Qa.getTransform(a,this._geometry,s),i.copy(s).invert(),t.copy(h).applyMatrix4(i),va.transformFrustum(c,i,e),n.length=0,u&&u.length>0&&n.push(...this.transformClipPlanes(u,i));let d=this.geometryManager.pick(o,a.itemId(),l,t,e,n);d&&n.length>0&&(d=d.filter((t=>va.insideNonIntersectingPlanes(t.point,n))));const p=[];return d&&d.forEach((t=>{const e=t;e.point.applyMatrix4(s),e.normal&&e.normal.transformDirection(s),e.instanceId=r,e.itemId=a.itemId(),e.pickPriority=this.itemState.getPickPriority(e.itemId),e.cameraDistanceSq=h.origin.distanceToSquared(e.point),e.snapType||(e.snapType=l),e.snapLineStart&&e.snapLineStart.applyMatrix4(s),e.snapLineEnd&&e.snapLineEnd.applyMatrix4(s),p.push(e)})),p}})()),this.model=t,this.boundingBoxManager=e,this.geometryManager=s,this.itemState=i,this._geometry=t.geometries()}filterPickableInstances(t){return t.filter((t=>(this._geometry.instances(t,this.instance),this.itemState.isVisible(this.instance.itemId())&&this.itemState.getPickPriority(this.instance.itemId())!==Ri.IGNORE)))}areaPick(t,e,s){return this.filterPickableInstances(this.boundingBoxManager.testFrustum(t,e,s)).map((t=>(this._geometry.instances(t,this.instance),this.instance.itemId())))}pick(t,e,s){const i=this.pickBoundingBoxes(e,s);if(0===i.length)return;const n=this.pickBoundingBoxes(t,s),r=n.concat(i),o=this.orderBoundingBoxesByRayOrigin(t,Array.from(new Set(r)));let a=[];const h=performance.now();for(const i of o){this._geometry.instances(i,this.instance),this._geometry.representations(this.instance.representationId(),this.definition);if((!this.geometryManager.getIsMesh(this.definition.type())||n.includes(i))&&(a=a.concat(this.pickGeometry(i,this.definition,this.instance,t,e,void 0,s)),performance.now()-h>400))break}if(0===a.length)return;const c=a.filter((t=>this.itemState.getPickPriority(t.itemId)===Ri.HIGH)),l=c.length>0?this.findClosestHit(c):this.findClosestHit(a);return this.addLocalIdToHit(l),l}pickSnapped(t,e,s,i){let n=[];const r=this.pick(t,e,i);if(!r)return this.pickSnappedEdges(t,e,s,i);this._geometry.instances(r.instanceId,this.instance),this._geometry.representations(this.instance.representationId(),this.definition),r.normal&&(r.normal.dot(r.point.clone().sub(t.origin))>0&&r.normal.negate(),this.facePlane.setFromNormalAndCoplanarPoint(r.normal,r.point.clone().sub(r.normal.clone().multiplyScalar(.001))));for(const o of s)n=n.concat(this.pickGeometry(r.instanceId,this.definition,this.instance,t,e,o,i));const o=this.pickSnappedEdges(t,e,s,i);if(o&&(n=n.concat(o)),!r.normal)return n;const a=n.filter((t=>r.instanceId===t.instanceId&&t.snapType===Ui.CENTER_LINE||this.facePlane.distanceToPoint(t.point)>=0));for(const t of a)this.addLocalIdToHit(t);return a}pickSnappedEdges(t,e,s,i){let n=[];if(s.includes(Ui.LINE)||s.includes(Ui.POINT)){let r=this.pickBoundingBoxes(e,i);r.length>10&&(r=this.orderBoundingBoxesByRayOrigin(t,r,10));const o=performance.now();for(const a of r){this._geometry.instances(a,this.instance),this._geometry.representations(this.instance.representationId(),this.definition);for(const r of s)r!==Ui.LINE&&r!==Ui.POINT||(n=n.concat(this.pickGeometry(a,this.definition,this.instance,t,e,r,i)));if(performance.now()-o>400)break}}if(0!==n.length){for(const e of n)e.distanceSqToRay=t.distanceSqToPoint(e.point);return n}}pickBoundingBoxes(t,e){const s=t instanceof Ae?this.boundingBoxManager.testBeam(t,e):this.boundingBoxManager.testFrustum(t,e);return this.filterPickableInstances(s)}orderBoundingBoxesByRayOrigin(t,e,s){const i=new Array(e.length),n=new Qt;for(let s=0;s<e.length;s++){const r=this.boundingBoxManager.getTransformedAABB(e[s]);t.intersectBox(r,n),i[s]=n.distanceToSquared(t.origin)}const r=this.orderIdsByAssociatedValues(e,i);return s&&r.length>s&&r.splice(s),r}orderIdsByAssociatedValues(t,e){return Array.from(t.keys()).sort(((t,s)=>e[t]-e[s])).map((e=>t[e]))}findClosestHit(t){return t.reduce(((t,e)=>t.distanceSqToRay&&e.distanceSqToRay?25*t.distanceSqToRay+t.cameraDistanceSq<25*e.distanceSqToRay+e.cameraDistanceSq?t:e:t.cameraDistanceSq<e.cameraDistanceSq?t:e))}transformClipPlanes(t,e){return t?t.map((t=>(new li).copy(t).applyMatrix4(e))):[]}addLocalIdToHit(t){if(!t)return;const e=this._geometry.geometriesItems(t.itemId);null!==e&&(t.localId=this.model.localIds(e))}}class dc{constructor(t,e,s,i,n,r,o){nt(this,"geometryBuilders",new Map),nt(this,"geometry"),nt(this,"geometryMessenger"),nt(this,"camera"),nt(this,"visibilityPlanes"),nt(this,"previousCameraDirection",new Qt),nt(this,"previousCameraPosition",new Qt),nt(this,"instancesProcessedForCurrentCamera",0),nt(this,"instanceIndex",0),nt(this,"updateFinished",!1),nt(this,"instanceState"),nt(this,"instance",new Pa),nt(this,"definition",new Oa),nt(this,"instancesLength"),nt(this,"instanceIdsSortedBySize"),nt(this,"checksum",new ya),nt(this,"centerPicker"),nt(this,"getApproxPixelSize",(()=>{let t,e;return(s,i)=>{let n;this.camera.orthoSize?n=this.camera.orthoSize:(this.camera.fieldOfView!==e&&(t=this.getPerspectiveViewWorldSize(this.camera.fieldOfView,1),e=this.camera.fieldOfView),n=t*i);return s/n*this.camera.resolution}})()),nt(this,"getEmptyInstanceGeometry",(()=>{const t=new Be,e=new te,s={};return(i,n,r)=>(Qa.getTransform(n,this.geometry,t),Qa.getBoundingBox(r,e),s.instanceId=i,s.materialId=this.materialIdMap[n.materialId()],s.transform=t,s.boundingBox=e,delete s.geometries,s)})()),nt(this,"pick",(()=>{const t=[];return(e,s,i,n,r,o)=>{t.length=0;const a=e.type(),h=e.index(),c=this.geometryBuilders.get(a);if(void 0===c)return[];try{const a=i===Ui.POINT?c.pickPoint(h,n,r):i===Ui.LINE?c.pickLine(h,n,r):i===Ui.FACE?c.pickFace(h,n,r):void 0===i?c.pick(h,n,r):void 0;a&&a.length&&t.push(...a),this.pickCenter(c,e,s,i,n,r,t),this.pickSection(c,h,i,n,r,o,t);for(const e of t)e.snapGeometryType=c.snapGeometryType;return t}catch(t){this.reportError(t)}}})()),this.modelId=t,this.messenger=e,this.model=s,this.boundingBoxManager=i,this.itemState=n,this.queryManager=r,this.materialIdMap=o,this.geometryMessenger=new hc(t,e),this.geometry=s.geometries(),this.instancesLength=this.geometry.instancesLength(),this.instanceState=new cc(this.instancesLength),this.instanceIdsSortedBySize=new Int32Array(this.instancesLength),this.centerPicker=new lc(this.queryManager),this.registerGeometryBuilders(),this.sortInstancesBySize()}get fbGeometry(){return this.geometry}get geometryStateFull(){return{starts:new Uint32Array([0]),counts:new Uint32Array([4294967295])}}registerGeometryBuilders(){this.registerGeometryBuilder(new qh(this.modelId,this.geometry)),this.registerGeometryBuilder(new Qh(this.modelId,this.geometry))}async createGeometryPrototypes(){for(const t of this.geometryBuilders.values())await t.createGeometryPrototypes()}registerGeometryBuilder(t){this.geometryBuilders.set(t.geometryType,t)}sortInstancesBySize(){for(let t=0;t<this.instancesLength;t++)this.instanceIdsSortedBySize[t]=t;this.instanceIdsSortedBySize.sort(((t,e)=>this.boundingBoxManager.size(e)-this.boundingBoxManager.size(t)))}updateLoop(t){try{if(this.instancesProcessedForCurrentCamera<this.instancesLength&&this.camera)for(let e=0;e<this.instancesLength&&(performance.now()-t<10||e<50);e++)this.updateInstanceGeometry(this.instanceIdsSortedBySize[this.instanceIndex]),this.instanceIndex++,this.instanceIndex>=this.instancesLength&&(this.instanceIndex=0),this.instancesProcessedForCurrentCamera++;this.instancesProcessedForCurrentCamera>=this.instancesLength&&!this.updateFinished&&(this.geometryMessenger.send({actionType:Ni.UPDATE_FINISHED,modelId:this.modelId}),this.updateFinished=!0)}catch(t){this.reportError(t)}}updateInstanceState(t,e,s=!1){const i=this.getItemId(t),n=this.itemState.isVisible(i),r=this.instanceState.isVisible(t),o=this.itemState.isSelected(i),a=this.instanceState.isSelected(t),h=this.itemState.isHovered(i),c=this.instanceState.isHovered(t),l=this.itemState.getCustomMaterialId(i),u=this.instanceState.getCustomMaterialId(t);(n!==r||o!==a||h!==c||l!==u||s)&&this.setInstanceState(t,n,o,h,l,e)}isVisible(t){return this.isVisibleByCamera(t)&&this.isVisibleByState(t)}isVisibleByCamera(t){const e=this.boundingBoxManager.getTransformedAABB(t);return this.isVisibleByClipPlanes(e)&&this.isVisibleByCameraDistance(t,e)}isVisibleByClipPlanes(t){return va.planesIntersectBox(this.visibilityPlanes,t)}isVisibleByCameraDistance(t,e){const s=this.boundingBoxManager.size(t),i=e.distanceToPoint(this.camera.position),n=this.getApproxPixelSize(s,i);return s>2?n>5:n>20}isVisibleByState(t){return this.geometry.instances(t,this.instance),this.itemState.isVisible(this.instance.itemId())}setCamera(t){this.camera=t,gh.maxCacheSize=t.settings.geometryCacheSize,this.forceUpdate(),this.restartInstanceIndex(),this.camera.clipPlanes?(this.visibilityPlanes=[...this.camera.frustum.planes],this.visibilityPlanes.push(...this.camera.clipPlanes)):this.visibilityPlanes=this.camera.frustum.planes}restartInstanceIndex(){const t=this.camera.frustum.planes[4].normal;t.angleTo(this.previousCameraDirection)>10*Lt&&(this.instanceIndex=0,this.previousCameraDirection.copy(t)),this.camera.position.distanceToSquared(this.previousCameraPosition)>400&&(this.instanceIndex=0,this.previousCameraPosition.copy(this.camera.position))}forceUpdate(){this.updateFinished=!1,this.instancesProcessedForCurrentCamera=0,this.geometryMessenger.removePendingUpdateFinishedAction()}forceStateUpdate(t){if(t&&this.camera)for(const e of t){const t=this.boundingBoxManager.getItemInstanceIds(e);if(t)for(const e of t)this.updateInstanceGeometry(e)}this.forceUpdate()}setItemTransform(t,e){for(let e=0;e<this.instancesLength&&(this.geometry.instances(e,this.instance),this.instance.itemId()!==t);e++);const s=this.geometry.localTransforms(this.instance.localTransformId()),i=Qa.placementToMatrix4(s,new Be);e.multiply(i.invert()),Qa.setTransform(t,this.geometry,e);for(let e=0;e<this.instancesLength;e++)this.instance.itemId()===t&&this.boundingBoxManager.computeTransformedAABB(e)}getGeometryId(t,e,s){return this.checksum.clear().add(t).add(e).add(s).get()}updateInstanceGeometry(t){this.isVisible(t)?this.instanceState.isVisible(t)?this.updateInstanceState(t,0):this.showInstanceGeometry(t,0):this.instanceState.isVisible(t)&&this.hideInstanceGeometry(t,0)}showInstanceGeometry(t,e){const s=this.getInstanceGeometry(t,e);if(s.geometries){const i=this.getItemId(t),n=this.itemState.isVisible(i),r=this.itemState.isSelected(i),o=this.itemState.isHovered(i),a=this.itemState.getCustomMaterialId(i),h=this.createBatchState(t,n,r,o,a);Ka(s.geometries,((n,r)=>{this.addGeometry(this.getGeometryId(t,r,e),n,void 0,s.materialId,s.transform,s.boundingBox,h,e,i,!0)}))}}getGeometries(t,e,s,i){return t.lineLODType===mh.BuilderGenerated&&i===Gi.Line?t.getLineLODGeometry(e,s):t.getGeometries(e,s)}getInstanceGeometry(t,e){this.geometry.instances(t,this.instance),this.geometry.representations(this.instance.representationId(),this.definition);const s=this.getEmptyInstanceGeometry(t,this.instance,this.definition),i=this.geometryBuilders.get(this.definition.type());if(i)try{s.geometries=this.getGeometries(i,this.definition.index(),!0,e)}catch(t){this.reportError(t)}return s}getInstanceTransform(t){this.geometry.instances(t,this.instance),this.geometry.representations(this.instance.representationId(),this.definition);return this.getEmptyInstanceGeometry(t,this.instance,this.definition).transform}setInstanceState(t,e,s,i,n,r){const o=this.createBatchState(t,e,s,i,n),a=this.geometry.instances(t,this.instance).representationId();this.geometry.representations(a,this.definition);Ka(this.getGeometries(this.geometryBuilders.get(this.definition.type()),this.definition.index(),!1,r),((e,s)=>{this.sendGeometryState(this.getGeometryId(t,s,r),e.objectType,this.materialIdMap[this.instance.materialId()],o,r)}))}createBatchState(t,e,s,i,n){return this.instanceState.setVisible(t,e),this.instanceState.setSelected(t,s),this.instanceState.setHovered(t,i),this.instanceState.setCustomMaterialId(t,n),{visible:e&&0===n?this.geometryStateFull:void 0,selected:s?this.geometryStateFull:void 0,hovered:i?this.geometryStateFull:void 0,customMaterialRanges:0!==n?this.geometryStateFull:void 0,customMaterialIds:0!==n?new Uint16Array([n]):void 0}}getItemId(t){return this.geometry.instances(t,this.instance).itemId()}sendGeometryState(t,e,s,i,n){this.geometryMessenger.send({actionType:Ni.SET_BATCH_STATE,modelId:this.modelId,batchId:t,objectType:e,materialId:s,state:i,lodLevel:n})}addGeometry(t,e,s,i,n,r,o,a,h,c=!1){const l=c&&e.positions?new Float32Array(e.positions):e.positions,u=c&&e.normals?new Int16Array(e.normals):e.normals,d=c&&e.indices?e.indices.slice():e.indices,p=c&&e.uvs?new Float32Array(e.uvs):e.uvs,m=c&&e.pointUvs?new Float32Array(e.pointUvs):e.pointUvs,f=c&&e.pointSizes?new Float32Array(e.pointSizes):e.pointSizes,g=c&&s?new Float32Array(s):s;this.geometryMessenger.send({actionType:Ni.ADD_BATCH,modelId:this.modelId,objectType:e.objectType,batchId:t,userData:{id:t,itemId:h},state:o,indices:d,positions:l,normals:u,uvs:p,pointUvs:m,pointSizes:f,ids:g,materialId:i,transform:n.clone(),boundingBox:r.clone(),lodLevel:a})}hideInstanceGeometry(t,e){this.instanceState.setVisible(t,!1);const s=this.geometry.instances(t,this.instance).representationId();this.geometry.representations(s,this.definition);Ka(this.getGeometries(this.geometryBuilders.get(this.definition.type()),this.definition.index(),!1,e),((s,i)=>{this.removeGeometry(this.getGeometryId(t,i,e))}))}removeGeometry(t){this.geometryMessenger.send({actionType:Ni.REMOVE_BATCH,modelId:this.modelId,batchId:t,userData:{id:t}})}getIsMesh(t){return this.geometryBuilders.has(t)&&(this.geometryBuilders.get(t).snapGeometryType===Di.MESH||t===Ga.SweptDisk)}pickSection(t,e,s,i,n,r,o){const a=t;r.length&&a.pickClipPlaneSectionLine&&(s===Ui.LINE&&o.push(...a.pickClipPlaneSectionLine(e,i,n,r)),s===Ui.POINT&&o.push(...a.pickClipPlaneSectionPoint(e,n,r)))}pickCenter(t,e,s,i,n,r,o){i===Ui.CENTER_POINT?this.centerPicker.pickCenterPoint(t,e.index(),n,r,o):i===Ui.CENTER_LINE&&this.centerPicker.pickCentralLine(t,e,n,r,s,o)}reportError(t){console.error(t),this.messenger.request({type:qi.ERROR,modelId:this.modelId,errorMessage:t.toString(),stackTrace:t.stack})}pickFollowLine(t,e){let s;this.geometry.instances(t,this.instance),this.geometry.representations(this.instance.representationId(),this.definition);const i=this.geometryBuilders.get(this.definition.type());if(i instanceof Xh){let t=1/0;return i.pickLineWithCallback(this.definition.index(),e,((e,i,n,r,o)=>{s||(s={point:void 0}),o<t&&(t=o,s.point=i.clone(),s.snapLineStart=n.clone(),s.snapLineEnd=r.clone())})),s}}getItemIdsWithGeometry(){const t=new Set;for(let e=0;e<this.instancesLength;e++)this.geometry.instances(e,this.instance),t.add(this.instance.itemId());return Array.from(t)}dispose(){this.geometryMessenger.dispose();for(const t of this.geometryBuilders.values())t.dispose()}getPerspectiveViewWorldSize(t,e){return Math.tan(.5*t*Lt)*e}}class pc extends dc{constructor(t,e,s,i,n,r,o){super(t,e,s,i,n,r,o),nt(this,"instanceIdToLineLODType"),nt(this,"instanceIdToLODLevel"),nt(this,"instanceIdToWidth"),nt(this,"buildLineLOD",(()=>{const t={objectType:Di.LINE,positionsLength:6,positions:new Float32Array(6)};return e=>{const s=Qa.getBoundingBoxLongestAxis(e);return s.start.toArray(t.positions,0),s.end.toArray(t.positions,3),t}})()),this.instanceIdToLineLODType=new Uint8Array(this.instancesLength),this.instanceIdToLODLevel=new Uint8Array(this.instancesLength),this.instanceIdToWidth=new Float32Array(this.instancesLength);const a=new te,h=new Qt;for(let t=0;t<this.instancesLength;t++)this.geometry.instances(t,this.instance),this.geometry.representations(this.instance.representationId(),this.definition),this.instanceIdToLineLODType[t]=this.getLineLODType(this.definition.type()),this.instanceIdToLODLevel[t]=Gi.Hidden,Qa.getBoundingBox(this.definition,a),a.getSize(h),h.x>h.y&&h.set(h.y,h.x,h.z),h.y>h.z&&h.set(h.x,h.z,h.y),h.x>h.y&&h.set(h.y,h.x,h.z),this.instanceIdToWidth[t]=h.y}getLineLODType(t){const e=this.geometryBuilders.get(t);return e?e.lineLODType:mh.None}getInstanceGeometry(t,e){if(e===Gi.Line){this.geometry.instances(t,this.instance),this.geometry.representations(this.instance.representationId(),this.definition);if(this.geometryBuilders.get(this.definition.type()).lineLODType===mh.BoundingBoxGenerated){const e=this.getEmptyInstanceGeometry(t,this.instance,this.definition);return e.geometries=this.buildLineLOD(e.boundingBox),e}}return super.getInstanceGeometry(t,e)}updateInstanceGeometry(t){let e=this.getLodLevel(t);const s=this.instanceIdToLODLevel[t];if(e===Gi.Line&&this.instanceState.getCustomMaterialId(t)&&(e=Gi.Hidden),e===s)return void(e!==Gi.Hidden&&this.updateInstanceState(t,e));s!==Gi.Hidden&&this.hideInstanceGeometry(t,s);const i=e!==Gi.Hidden;i&&this.showInstanceGeometry(t,e),this.instanceState.setVisible(t,i),this.instanceIdToLODLevel[t]=e}updateInstanceState(t,e){const s=this.instanceIdToLODLevel[t];super.updateInstanceState(t,e,e!==s)}getLodLevel(t){const e=this.boundingBoxManager.getTransformedAABB(t);if(!this.isVisibleByClipPlanes(e))return Gi.Hidden;const s=this.getLodLevelByCameraDistance(t,e);return s!==Gi.Hidden&&this.isVisibleByState(t)?s:Gi.Hidden}getLodLevelByCameraDistance(t,e){const s=this.camera.settings.lodSetting,i=this.boundingBoxManager.size(t),n=e.distanceToPoint(this.camera.position),r=this.getApproxPixelSize(i,n);if(this.camera.xr)return i<2&&r<40||i>=2&&r<2?Gi.Hidden:Gi.Full;if(i<2&&r<5*s)return Gi.Hidden;if(i<2&&r<15*s&&this.instanceIdToLineLODType[t]===mh.None)return Gi.Hidden;if(i>=2&&r<2*s)return Gi.Hidden;if(this.instanceIdToLineLODType[t]===mh.None)return Gi.Full;if(i<2&&r<15*s)return Gi.Line;if(i>=2&&r<5*s)return Gi.Line;const o=this.instanceIdToWidth[t];return this.getApproxPixelSize(o,n)<Math.max(4*s,4)?Gi.Line:Gi.Full}}let mc=0;const fc=class t extends pc{constructor(e,s,i,n,r,o,a){super(e,s,i,n,r,o,a),nt(this,"gridSize"),nt(this,"batches",new Map),nt(this,"instanceIdToBatchIds"),nt(this,"instanceIdToLODBatchId"),nt(this,"updatedBatches",new Set),nt(this,"batchHashToBucketSize",new Map),nt(this,"vec3",new Qt),nt(this,"matrix",new Be),nt(this,"getBatchHash",(()=>{const e=new Qt;return(s,i,n,r)=>{const o=this.boundingBoxManager.getTransformedAABB(s);o.getCenter(e);const a=r===Gi.Full?this.gridSize:10*this.gridSize,h=t.getSizeCategory(o);return this.checksum.clear().add(n.objectType).add(i).add(e.x-e.x%a).add(e.y-e.y%a).add(e.z-e.z%a).add(h).add(r).add(n.uvsLength>0),this.checksum.get()}})()),nt(this,"assignInstanceToLODBatch",(()=>{const e={objectType:Di.LINE,positionsLength:6};return(s,i)=>{const n=this.getBatchHash(s,i,e,Gi.Line);let r=this.batches.get(n);return r||(r=this.createBatch(e.objectType,i,Gi.Line),this.batches.set(n,r)),t.addToBatch(r,e,s,0),n}})()),this.gridSize=this.calculateGridSize(),this.instanceIdToBatchIds=new Array(this.instancesLength),this.instanceIdToLODBatchId=new Array(this.instancesLength)}async createGeometryPrototypes(){await super.createGeometryPrototypes(),await this.createBatches()}async updateLoop(t){await super.updateLoop(t),this.sendUpdatedBatchStates()}showInstanceGeometry(t,e){this.updateInstanceState(t,e)}hideInstanceGeometry(t,e){const s=this.getBatchIds(t,e);void 0!==s&&Ka(s,(e=>this.hideFromBatch(e,t)))}getBatchIds(t,e){return e===Gi.Full?this.instanceIdToBatchIds[t]:this.instanceIdToLODBatchId[t]}setInstanceState(t,e,s,i,n,r){this.instanceState.setVisible(t,!0),this.instanceState.setHovered(t,i),this.instanceState.setSelected(t,s),this.instanceState.setCustomMaterialId(t,n);const o=i,a=n,h=0===n,c=s,l=this.getBatchIds(t,r);void 0!==l&&Ka(l,(e=>{this.updateBatch(e,t,a,h,o,c)}))}updateBatch(e,s,i,n,r,o){const a=this.batches.get(e),h=a.instanceIdToIndex.get(s);a.visibilityRanges.set(h,n),a.hoverRanges.set(h,r),a.selectionRanges.set(h,o),a.materialRanges.set(h,i),a.inMainThread?this.updatedBatches.add(e):(this.buildBatch(a),this.addBatch(e,a),a.inMainThread=!0,t.freeBatch(a))}hideFromBatch(t,e){const s=this.batches.get(t),i=s.instanceIdToIndex.get(e);s.visibilityRanges.set(i,!1),s.hoverRanges.set(i,!1),s.selectionRanges.set(i,!1),s.materialRanges.set(i,0),s.visibilityRanges.all(!1)&&s.materialRanges.all(0)&&mc>this.camera.settings.gpuMemoryUsage?(this.removeGeometry(t),s.inMainThread=!1,mc-=s.memSize):this.updatedBatches.add(t)}calculateGridSize(){const t=this.boundingBoxManager.modelAABB.getSize(this.vec3);return Math.max(40,Math.ceil(Math.max(t.x,t.y,t.z)/8))}sendUpdatedBatchStates(){for(const e of this.updatedBatches){const s=this.batches.get(e),i=t.getState(s);this.sendGeometryState(e,s.objectType,s.materialId,i,s.lodLevel)}this.updatedBatches.clear()}generateBatchId(t,e,s){s.positionsLength/3>Vi&&console.warn(`Geometry of instance ${t} does not fit in 16-bit index (position size ${s.positionsLength}), and will be truncated.`);const i=this.getBatchHash(t,e,s,void 0===s.lodLevel?Gi.Full:s.lodLevel),n=this.batchHashToBucketSize.get(i)||1;let r=i+n-1;const o=this.batches.get(r);return(o?o.positionsLength:0)+s.positionsLength>Vi&&(r++,this.batchHashToBucketSize.set(i,n+1)),r}createBatch(t,e,s){return{lodLevel:s,objectType:t,materialId:e,indicesLength:0,positionsLength:0,normalsLength:0,uvsLength:0,pointUvsLength:0,pointSizesLength:0,inMainThread:!1,boundingBox:new te,instancesLength:0,instanceIdToIndex:new Map,geometryIndices:[],indexOffsets:[],vertexOffsets:[]}}static addToBatch(t,e,s,i){t.instanceIdToIndex.set(s,t.instancesLength),t.instancesLength++,t.geometryIndices.push(i),t.indexOffsets.push(t.indicesLength||0),t.vertexOffsets.push((t.positionsLength||0)/3),e.indicesLength&&(t.indicesLength+=e.indicesLength),e.positionsLength&&(t.positionsLength+=e.positionsLength),e.normalsLength&&(t.normalsLength+=e.normalsLength),e.uvsLength&&(t.uvsLength+=e.uvsLength),e.pointUvsLength&&(t.pointUvsLength+=e.pointUvsLength),e.pointSizesLength&&(t.pointSizesLength+=e.pointSizesLength),void 0!==e.materialId&&(t.materialId=e.materialId)}assignInstanceToBatches(e,s,i){let n;return Ka(i,((i,r)=>{const o=this.generateBatchId(e,s,i);void 0===n?n=o:"number"==typeof n?n!==o&&(n=[n,o]):n.includes(o)||n.push(o);let a=this.batches.get(o);a||(a=this.createBatch(i.objectType,s,void 0===i.lodLevel?Gi.Full:i.lodLevel),this.batches.set(o,a)),t.addToBatch(a,i,e,r)})),n}createBatches(){for(let t=0;t<this.instancesLength;++t){this.geometry.instances(t,this.instance),this.geometry.representations(this.instance.representationId(),this.definition);const e=this.materialIdMap[this.instance.materialId()],s=this.geometryBuilders.get(this.definition.type());if(!s)continue;const i=this.getGeometries(s,this.definition.index(),!1,Gi.Full);if(this.instanceIdToBatchIds[t]=this.assignInstanceToBatches(t,e,i),s.lineLODType===mh.BoundingBoxGenerated)this.instanceIdToLODBatchId[t]=this.assignInstanceToLODBatch(t,e);else if(s.lineLODType===mh.BuilderGenerated){const i=this.getGeometries(s,this.definition.index(),!1,Gi.Line);this.instanceIdToWidth[t]=i.lodWidth,this.instanceIdToLODBatchId[t]=this.assignInstanceToBatches(t,e,i)}}for(const t of this.batches.values())t.visibilityRanges=new xa(t.instancesLength,!1),t.hoverRanges=new xa(t.instancesLength,!1),t.selectionRanges=new xa(t.instancesLength,!1),t.materialRanges=new xa(t.instancesLength,0)}buildBatch(e){e.positions||t.allocateBatch(e);const s=!e.position;for(const[t,i]of e.instanceIdToIndex){const n=this.getInstanceGeometry(t,e.lodLevel);n&&n.geometries&&(this.loadInstanceIntoBatch(e,n,e.geometryIndices[i]),s&&this.expandBoundingBox(e,t))}}loadInstanceIntoBatch(t,e,s){const i=t.instanceIdToIndex.get(e.instanceId),n=Array.isArray(e.geometries)?e.geometries[s]:e.geometries;n.positions||console.log("hey"),t.position||(t.position=(new Qt).fromArray(n.positions).applyMatrix4(e.transform));const r=this.vec3.copy(t.position).negate();if(this.matrix.identity().setPosition(r).multiply(e.transform),this.transformPositions(this.matrix,n.positions,t.positions,3*t.vertexOffsets[i],n.positions.length),t.normals&&this.transformNormals(this.matrix,n.normals,t.normals,3*t.vertexOffsets[i],n.normals.length),t.indices){const e=t.indexOffsets[i],s=t.vertexOffsets[i];for(let i=0;i<n.indicesLength;i++)t.indices[i+e]=n.indices[i]+s}t.uvs&&t.uvs.set(n.uvs,2*t.vertexOffsets[i]),t.pointUvs&&t.pointUvs.set(n.pointUvs,4*t.vertexOffsets[i]),t.pointSizes&&t.pointSizes.set(n.pointSizes,4*t.vertexOffsets[i]),n.objectType===Di.MESH&&t.ids.fill(this.getItemId(e.instanceId),t.vertexOffsets[i],t.vertexOffsets[i]+n.positionsLength/3)}expandBoundingBox(t,e){const s=this.boundingBoxManager.getTransformedAABB(e),i=this.vec3.copy(t.position).negate();s.translate(i),t.boundingBox.union(s)}transformPositions(t,e,s,i=0,n){for(let r=0;r<n;r+=3)this.vec3.fromArray(e,r),this.vec3.applyMatrix4(t),this.vec3.toArray(s,i+r)}transformNormals(t,e,s,i=0,n){for(let r=0;r<n;r+=3)this.vec3.fromArray(e,r),this.vec3.transformDirection(t),this.vec3.multiplyScalar(ph),this.vec3.toArray(s,i+r)}addBatch(e,s){const i=t.getState(s);s.position&&this.matrix.identity().setPosition(s.position),this.addGeometry(e,s,s.ids,s.materialId,this.matrix,s.boundingBox,i,s.lodLevel),mc+=s.memSize}static getSizeCategory(t){const e=t.min.distanceToSquared(t.max);return e<.25?0:e<4?1:2}static allocateBatch(t){t.positions=new Float32Array(t.positionsLength),t.memSize=t.positions.byteLength,t.indicesLength>0&&(t.indices=new Uint16Array(t.indicesLength),t.memSize+=t.indices.byteLength),t.normalsLength>0&&(t.normals=new Int16Array(t.normalsLength),t.memSize+=t.normals.byteLength),t.uvsLength>0&&(t.uvs=new Float32Array(t.uvsLength),t.memSize+=t.uvs.byteLength),t.pointUvsLength>0&&(t.pointUvs=new Float32Array(t.pointUvsLength),t.memSize+=t.pointUvs.byteLength),t.pointSizesLength>0&&(t.pointSizes=new Float32Array(t.pointSizesLength),t.memSize+=t.pointSizes.byteLength),t.objectType===Di.MESH&&(t.ids=new Float32Array(t.positionsLength/3),t.memSize+=t.ids.byteLength)}static freeBatch(t){delete t.indices,delete t.positions,delete t.normals,delete t.uvs,delete t.pointUvs,delete t.pointSizes,delete t.ids}};nt(fc,"getState",(()=>t=>{const e=t.indicesLength?t.indexOffsets:t.vertexOffsets,s=t.visibilityRanges.all(!1)?void 0:wa(t.visibilityRanges,e,(t=>t)),i=t.hoverRanges.all(!1)?void 0:wa(t.hoverRanges,e,(t=>t)),n=t.selectionRanges.all(!1)?void 0:wa(t.selectionRanges,e,(t=>t));let r,o;const a=t.materialRanges.count((t=>0!==t));return a>0&&(o=new Uint16Array(a),r=wa(t.materialRanges,e,(t=>0!==t),((t,e)=>{o[t]=e}))),{visible:s,hovered:i,selected:n,customMaterialRanges:r,customMaterialIds:o}})());let gc=fc;class yc{constructor(t,e){nt(this,"materials"),this.modelId=t,this.postMessage=e,this.materials=[]}sendModelMaterials(t){const e=[],s=t.geometries(),i=s.materialsLength();for(let t=0;t<i;t++){const i=s.materials(t),n={color:new xs(i.r()/255,i.g()/255,i.b()/255),side:i.sidedness(),lineType:i.lineType(),opacity:i.a()/255,transparent:i.a()<255};e.push(n)}return this.sendMaterials(e)}sendMaterials(t){const e=[],s=[];t:for(const i of t){for(let t=0,s=this.materials.length;t<s;t++)if(this.equal(i,this.materials[t])){e.push(t);continue t}this.materials.push(i),s.push(i),e.push(this.materials.length-1)}return this.postMessage({type:qi.ADD_MATERIAL,modelId:this.modelId,materials:s}),e}equal(t,e){return(t.color===e.color||t.color&&e.color&&t.color.r===e.color.r&&t.color.g===e.color.g&&t.color.b===e.color.b)&&this.eq(t.opacity,e.opacity,1)&&this.eq(t.side,e.side,Xa.Single)&&this.eq(t.lineType,e.lineType,Wa.Normal)&&t.lineWidth===e.lineWidth}eq(t,e,s){return t===e||void 0===t&&e===s||t===s&&void 0===e}getMaterial(t){return this.materials[t]}}class bc{constructor(t,e){nt(this,"geometry"),nt(this,"localIdsToGeometryIds"),nt(this,"getIdentifier",(()=>{const t=new qa;return e=>{const s=this.model.guidsItemsArray().indexOf(e),i=this.model.guids(s,t);return xc(i)}})()),this.model=t,this.boundingBoxManager=e,this.geometry=t.geometries(),this.localIdsToGeometryIds=new Map;const s=this.model.geometries(),i=s.geometriesItemsLength();for(let t=0;t<i;t++){const e=s.geometriesItems(t),i=this.model.localIds(e);null!==i&&(this.localIdsToGeometryIds.has(i)||this.localIdsToGeometryIds.set(i,[]),this.localIdsToGeometryIds.get(i).push(t))}}getItemIdsFromLocalIds(t){if(!t)return;const e=[];for(const s of t){const t=this.localIdsToGeometryIds.get(s);if(t)for(const s of t)e.push(s)}return e}findByClass(t){const e=[];for(let s=0,i=this.model.localIdsLength();s<i;s++)this.model.categories(this.model.itemCategories(s))===t&&e.push(s);return e}findByGeometryType(t){const e=new Pa,s=new Oa,i=[];t:for(let n=0,r=this.model.localIdsLength();n<r;n++){const r=this.boundingBoxManager.getItemInstanceIds(n);if(r)for(const o of r)if(this.geometry.instances(o,e),this.geometry.representations(e.representationId(),s),s.type()===t){i.push(n);continue t}}return i}getAABBFromIds(t,e){t.forEach((t=>{const s=this.boundingBoxManager.getItemInstanceIds(t);s&&s.forEach((t=>{e.union(this.boundingBoxManager.getTransformedAABB(t))}))}))}getItem(t){if(t<0||t>this.model.localIdsLength())return;const e={};return e.id=t,e.identifier=this.getIdentifier(t),e.class=this.model.categories(this.model.itemCategories(t)),e.transform=Qa.placementToMatrix4(this.geometry.globalTransforms(t),new Be),e}getItemIdsFromGuids(t){const e=new Map,s=new sh({});let i=0;for(const n of t)22===n.length?e.set(n,i):36===n.length?(s.setMsGuid(n),e.set(s.ifcGuid,i)):console.warn("Only IFC GUID and MS GUID is currently supported"),i++;const n=new qa,r=new Array(t.length);let o=0;const a=this.model.guidsItemsArray();for(let i=0,h=this.model.localIdsLength();i<h;i++){const h=a.indexOf(i);this.model.guids(h,n),s.setFromBufferData(n.bb.bytes().buffer,n.bb_pos);const c=s.ifcGuid;if(e.has(c)&&(r[e.get(c)]=i,o++,o===t.length))return r}return r.length!==t.length&&console.warn("Not all ids could be converted"),r}getItemsFromIds(t){if(t){const e=Array(t.length);for(let s=0,i=t.length;s<i;s++)e[s]=this.getItem(t[s]);return e}const e=this.model.localIdsLength(),s=Array(e);for(let t=0;t<e;t++)s[t]=this.getItem(t);return s}getItemsLength(){return this.model.localIdsLength()}getItemCategory(t){var e;const s="number"==typeof t?t:this.getLocalIdByGuid(t);if(null===s)return null;const i=null==(e=this.model.localIdsArray())?void 0:e.indexOf(s);if(void 0===i||-1===i)return null;return this.model.categories(i)}getItemGuid(t){var e,s;const i=null==(e=this.model.localIdsArray())?void 0:e.indexOf(t);if(void 0===i||-1===i)return null;const n=null==(s=this.model.guidsItemsArray())?void 0:s.indexOf(i);if(void 0===n||-1===i)return null;const r=this.model.guids(n);return null===r?null:xc(r).ifcGuid}getLocalIdByGuid(t){let e=-1;for(let s=0;s<this.model.guidsLength();s++){const i=this.model.guids(s);if(null!==i&&xc(i).ifcGuid===t){e=s;break}}if(-1===e)return null;const s=this.model.guidsItems(e);return null===s?null:this.model.localIds(s)}getItemAttributes(t){var e;const s="number"==typeof t?t:this.getLocalIdByGuid(t);if(null===s)return null;const i=null==(e=this.model.localIdsArray())?void 0:e.indexOf(s);if(void 0===i||-1===i)return null;const n=this.model.attributes(i);if(!n)return null;const r={};for(let t=0;t<n.dataLength();t++){const e=n.data(t);if(!e)continue;const[s,i,o]=JSON.parse(e);r[s]={value:i,type:o}}return r}getItemRelations(t){var e;const s="number"==typeof t?t:this.getLocalIdByGuid(t);if(null===s)return null;const i=null==(e=this.model.relationsItemsArray())?void 0:e.indexOf(s);if(void 0===i||-1===i)return null;const n=this.model.relations(i);if(!n)return null;const r={};for(let t=0;t<n.dataLength();t++){const e=n.data(t);if(!e)continue;const[s,...i]=JSON.parse(e);r[s]=i}return r}getMaxLocalId(){return this.model.maxLocalId()}getAllCategories(){const t=new Set;for(let e=0;e<this.model.categoriesLength();e++){const s=this.model.categories(e);s&&t.add(s)}return[...t]}getMetadata(){const t=this.model.metadata();return t?JSON.parse(t):null}}const xc=t=>new sh({data:t.bb.bytes().slice(t.bb_pos,t.bb_pos+16)});class _c{constructor(t=new Float64Array(6),e=0){this.aabb=t,this.offset=e}get minX(){return this.aabb[this.offset]}get maxX(){return this.aabb[this.offset+1]}get minY(){return this.aabb[this.offset+2]}get maxY(){return this.aabb[this.offset+3]}get minZ(){return this.aabb[this.offset+4]}get maxZ(){return this.aabb[this.offset+5]}copy(t){this.aabb[this.offset]=t.minX,this.aabb[this.offset+1]=t.maxX,this.aabb[this.offset+2]=t.minY,this.aabb[this.offset+3]=t.maxY,this.aabb[this.offset+4]=t.minZ,this.aabb[this.offset+5]=t.maxZ}merge(t,e){this.aabb[this.offset]=Math.min(t.minX,e.minX),this.aabb[this.offset+1]=Math.max(t.maxX,e.maxX),this.aabb[this.offset+2]=Math.min(t.minY,e.minY),this.aabb[this.offset+3]=Math.max(t.maxY,e.maxY),this.aabb[this.offset+4]=Math.min(t.minZ,e.minZ),this.aabb[this.offset+5]=Math.max(t.maxZ,e.maxZ)}}class wc{constructor(t,e){nt(this,"aabb"),nt(this,"dataOrSize"),this.aabb=new _c(t,e)}isLeaf(){return this.dataOrSize>=0}getAABB(){return this.aabb}getBranchSize(){return-this.dataOrSize}getLeafData(){return this.dataOrSize}makeBranch(t,e){this.dataOrSize=-t,this.aabb.copy(e)}setSize(t){this.dataOrSize=-t}makeLeaf(t,e){this.dataOrSize=t,this.aabb.copy(e)}setData(t){this.dataOrSize=t}overlaps(t){return!(this.aabb.minX>t.maxX||this.aabb.maxX<t.minX||this.aabb.minY>t.maxY||this.aabb.maxY<t.minY||this.aabb.minZ>t.maxZ||this.aabb.maxZ<t.minZ)}}class Sc{constructor(t){if(nt(this,"nodes",[]),nt(this,"primaryLimits",[]),nt(this,"secondaryLimits",[]),nt(this,"divideX",(()=>{const t=new Qt;return(e,s,i,n)=>{let r=s;for(let o=s;o<i;o++){this.boundingBoxManager.getTransformedAABB(e[o]).getCenter(t).x>n&&(this.exchange(e,o,r),r++)}return r}})()),nt(this,"divideY",(()=>{const t=new Qt;return(e,s,i,n)=>{let r=s;for(let o=s;o<i;o++){this.boundingBoxManager.getTransformedAABB(e[o]).getCenter(t).y>n&&(this.exchange(e,o,r),r++)}return r}})()),nt(this,"divideZ",(()=>{const t=new Qt;return(e,s,i,n)=>{let r=s;for(let o=s;o<i;o++){this.boundingBoxManager.getTransformedAABB(e[o]).getCenter(t).z>n&&(this.exchange(e,o,r),r++)}return r}})()),nt(this,"computeAveragePosition",(()=>{const t=new Qt;return(e,s,i,n)=>{let r=this.boundingBoxManager.getTransformedAABB(e[s]);r.getCenter(n);for(let o=s+1;o<i;o++)r=this.boundingBoxManager.getTransformedAABB(e[o]),n.add(r.getCenter(t));const o=i-s;return n.divideScalar(o)}})()),nt(this,"quantize",(()=>{const t=new Qt,e=new Qt;return(s,i)=>{t.subVectors(s.min,this.boundingBoxManager.modelAABB.min),e.subVectors(s.max,this.boundingBoxManager.modelAABB.min),i.aabb[i.offset]=t.x,i.aabb[i.offset+1]=e.x,i.aabb[i.offset+2]=t.y,i.aabb[i.offset+3]=e.y,i.aabb[i.offset+4]=t.z,i.aabb[i.offset+5]=e.z}})()),nt(this,"constructHierarchy",(()=>(t,e,s,i,n,r)=>{if(n-i==1){const t=this.boundingBoxManager.getTransformedAABB(s[i]);return this.quantize(t,r),this.createLeaf(e,r,s[i]),1}if(n-i==2){const t=this.nodes[e+1].getAABB();let n=this.boundingBoxManager.getTransformedAABB(s[i]);this.quantize(n,t),this.setAsDataNode(e+1,s[i]);const o=this.nodes[e+2].getAABB();return n=this.boundingBoxManager.getTransformedAABB(s[i+1]),this.quantize(n,o),this.setAsDataNode(e+2,s[i+1]),r.merge(t,o),this.createBranch(e,r,3),3}const o=this.divideOnAxis(s,i,n),a=this.constructHierarchy(t+1,e+1,s,i,o,this.primaryLimits[t]),h=this.constructHierarchy(t+1,e+a+1,s,o,n,this.secondaryLimits[t]);r.merge(this.primaryLimits[t],this.secondaryLimits[t]);const c=a+h+1;return this.createBranch(e,r,c),c})()),nt(this,"divideOnAxis",(()=>{const t=new Qt,e=new Qt,s=new Qt;return(i,n,r)=>{this.computeAveragePosition(i,n,r,s),t.set(0,0,0);for(let o=n;o<r;o++){this.boundingBoxManager.getTransformedAABB(i[o]).getCenter(e).sub(s);const n=e.multiply(e);t.add(n)}let o;o=t.x>t.y?t.x>t.z?this.divideX(i,n,r,s.x):this.divideZ(i,n,r,s.z):t.y>t.z?this.divideY(i,n,r,s.y):this.divideZ(i,n,r,s.z);const a=(r-n)/3;return(o<=n+a||o>=r-1-a)&&(o=(n+r)/2),Math.round(o)}})()),this.boundingBoxManager=t,0===t.count)return;const e=new Uint32Array(t.count);for(let t=0;t<e.length;t++)e[t]=t;const s=2*e.length-1,i=new Float64Array(6*s);for(let t=0;t<s;t++)this.nodes.push(new wc(i,6*t));const n=new _c;for(let t=0;t<32;t++)this.primaryLimits.push(new _c),this.secondaryLimits.push(new _c);this.constructHierarchy(0,0,e,0,e.length,n)}count(){return this.nodes.length}getItemsInRegion(t){const e=[],s=new _c;this.quantize(t,s);let i=0;for(;i<this.nodes.length;){const t=this.testRegionCollision(i,s),n=this.isLeaf(i);n&&t?(e.push(this.getLeafData(i)),i++):n||t?i++:i+=this.getBranchSize(i)}return e}testBeam(t,e){const s=e&&e.length>0?t=>va.planesIntersectBox(e,t):()=>!0;return this.test((e=>t.intersectsBox(e)),(()=>!1),s)}testFrustum(t,e,s){const i=[...t.planes];e&&i.push(...e);return this.test((t=>va.planesIntersectBox(i,t)),(t=>va.planesContainBox(i,t)),(()=>!0),s)}test(t,e,s,i=!1){const n=[];let r=0;const o=this.nodes.length;for(;r<o;){const o=this.getBounds(r),a=this.isLeaf(r),h=e(o),c=h||t(o);if(a&&c&&s(o)&&(i?h&&n.push(this.getLeafData(r)):n.push(this.getLeafData(r))),c||a){if(r++,h&&!a){const t=r+this.getBranchSize(r);for(;r<t;r++)this.isLeaf(r)&&s(o)&&(i?h&&n.push(this.getLeafData(r)):n.push(this.getLeafData(r)))}}else r+=this.getBranchSize(r)}return n}exchange(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}testRegionCollision(t,e){return this.nodes[t].overlaps(e)}isLeaf(t){return this.nodes[t].isLeaf()}getBounds(t){const e=this.nodes[t].getAABB();return this.reverseQuantize(e)}createLeaf(t,e,s){this.nodes[t].makeLeaf(s,e)}setAsDataNode(t,e){this.nodes[t].setData(e)}createBranch(t,e,s){this.nodes[t].makeBranch(s,e)}getLeafData(t){return this.nodes[t].getLeafData()}getBranchSize(t){return this.nodes[t].getBranchSize()}reverseQuantize(t){const e=this.boundingBoxManager.modelAABB,s=new Qt(t.minX+e.min.x,t.minY+e.min.y,t.minZ+e.min.z),i=new Qt(t.maxX+e.min.x,t.maxY+e.min.y,t.maxZ+e.min.z);return new te(s,i)}}class vc{constructor(t){nt(this,"modelAABB",new te),nt(this,"geometries"),nt(this,"transformedAABBs"),nt(this,"instanceDimensions"),nt(this,"box",new te),nt(this,"instance",new Pa),nt(this,"representation",new Oa),nt(this,"vector",new Qt),nt(this,"transform",new Be),nt(this,"itemToInstance"),this.geometries=t.geometries(),this.transformedAABBs=new Float64Array(6*this.geometries.instancesLength()),this.instanceDimensions=new Float32Array(this.geometries.instancesLength()),this.computeAABBs(),this.evaluateInstances()}evaluateInstances(){this.itemToInstance=new Array(this.geometries.globalTransformsLength());const t=this.geometries.instancesLength(),e=new Pa,s=new Oa;for(let i=0;i<t;i++){this.geometries.instances(i,e),this.geometries.representations(e.representationId(),s);const t=e.itemId();let n=this.itemToInstance[t];n||(n=[],this.itemToInstance[t]=n),n.push(i)}}computeAABBs(){for(let t=0;t<this.geometries.instancesLength();t++){this.geometries.instances(t,this.instance),this.geometries.representations(this.instance.representationId(),this.representation),Qa.getBoundingBox(this.representation,this.box);const e=this.box.getSize(this.vector);this.instanceDimensions[t]=e.length(),this.computeTransformedAABB(t)}}getItemInstanceIds(t){return this.itemToInstance[t]}computeTransformedAABB(t){this.geometries.instances(t,this.instance),this.geometries.representations(this.instance.representationId(),this.representation),Qa.getTransform(this.instance,this.geometries,this.transform),Qa.getBoundingBox(this.representation,this.box),this.box.applyMatrix4(this.transform),this.modelAABB.union(this.box),this.setTransformedAABB(t,this.box)}setTransformedAABB(t,e){e.min.toArray(this.transformedAABBs,6*t),e.max.toArray(this.transformedAABBs,6*t+3)}getTransformedAABB(t){return this.box.min.fromArray(this.transformedAABBs,6*t),this.box.max.fromArray(this.transformedAABBs,6*t+3),this.box}size(t){return this.instanceDimensions[t]}testBeam(t,e){const s=e&&e.length>0?t=>va.planesIntersectBox(e,t):()=>!0;return this.test((e=>t.intersectsBox(e)),s)}testFrustum(t,e,s=!1){const i=[...t.planes];e&&i.push(...e);const n=s?t=>va.planesContainBox(i,t):t=>va.planesIntersectBox(i,t);return this.test(n,(()=>!0))}test(t,e){const s=[];for(let i=0;i<this.count;i++){const n=this.getTransformedAABB(i);t(n)&&e(n)&&s.push(i)}return s}get count(){return this.transformedAABBs.length/6}}class Mc extends vc{constructor(t){super(t),nt(this,"lookup"),this.lookup=new Sc(this)}computeTransformedAABB(t){if(this.lookup)throw new Error("Unable to recalculate bounding box when tree has already been built");super.computeTransformedAABB(t)}testBeam(t,e){return this.lookup.testBeam(t,e)}testFrustum(t,e,s=!1){return this.lookup.testFrustum(t,e,s)}}class Ic{constructor(t,e,s){nt(this,"_sectionGenerator",new sa),nt(this,"model"),nt(this,"geometryManager"),nt(this,"materialManager"),nt(this,"boundingBoxManager"),nt(this,"pickManager"),nt(this,"itemState"),nt(this,"queryManager"),nt(this,"camera"),nt(this,"editing",!1),this.modelId=t,this.messenger=s;const i=new Qi(new Uint8Array(e));this.replaceTextDecoder(i),this.model=Za.getRootAsModel(i),this.editing?this.boundingBoxManager=new vc(this.model):this.boundingBoxManager=new Mc(this.model),this.materialManager=new yc(t,((t,e)=>s.request(t,e)));const n=this.model.localIdsLength();this.itemState=new cc(n),this.itemState.initialize(),this.setupBVH()}replaceTextDecoder(t){if(void 0===t.text_decoder_)throw new Error("ByteBuffer text_decoder_ can not be replaced");t.text_decoder_=new Ma}async createCaches(){const t=this.materialManager.sendModelMaterials(this.model);this.editing?this.geometryManager=new dc(this.modelId,this.messenger,this.model,this.boundingBoxManager,this.itemState,this.queryManager,t):this.geometryManager=new gc(this.modelId,this.messenger,this.model,this.boundingBoxManager,this.itemState,this.queryManager,t),this.queryManager=new bc(this.model,this.boundingBoxManager),this.pickManager=new uc(this.model,this.boundingBoxManager,this.geometryManager,this.itemState),await this.geometryManager.createGeometryPrototypes()}updateLoop(t){return this.geometryManager.updateLoop(t),this.geometryManager.updateFinished}pick(t,e){if(this.camera)return this.pickManager.pick(t,e,this.camera.clipPlanes)}pickSnapped(t,e,s){if(this.camera)return this.pickManager.pickSnapped(t,e,s,this.camera.clipPlanes)}areaPick(t,e){if(this.camera)return this.pickManager.areaPick(t,this.camera.clipPlanes,e)}getCoordinates(){const t=this.model.geometries().coordinates(),e=t.position(),s=t.xAxis(),i=t.yAxis();return[e.x(),e.y(),e.z(),s.x(),s.y(),s.z(),i.x(),i.y(),i.z()]}getSelection(){const t=[];for(let e=0;e<this.itemState.length;e++)this.itemState.isSelected(e)&&t.push(e);return t}forEachItem(t,e){if(t)for(let s=0;s<t.length;s++)e(t[s],s);else for(let t=0;t<this.itemState.length;t++)e(t,t)}setCustomMaterial(t,e){const s=this.queryManager.getItemIdsFromLocalIds(t),i=[];this.forEachItem(s,(t=>{const s=this.itemState.getCustomMaterialId(t);if(void 0!==s){const t=this.materialManager.getMaterial(s),n={...e};void 0===n.color&&void 0!==t.color&&(n.color=t.color),void 0===n.opacity&&void 0!==t.opacity&&(n.opacity=t.opacity),void 0===n.transparent&&void 0!==t.transparent&&(n.transparent=t.transparent),void 0===n.side&&void 0!==t.side&&(n.side=t.side),i.push(n)}else i.push(e)}));const n=this.materialManager.sendMaterials(i);this.forEachItem(s,((t,e)=>{this.itemState.setCustomMaterialId(t,n[e])})),this.geometryManager.forceStateUpdate(s)}getCustomMaterials(t){const e=[];return this.forEachItem(t,(t=>{const s=this.itemState.getCustomMaterialId(t);e.push(s?this.materialManager.getMaterial(s):void 0)})),e}getCustomMaterialItemIds(){const t=[];for(let e=0;e<this.itemState.length;e++)this.itemState.getCustomMaterialId(e)&&t.push(e);return t}setVisibility(t,e){this.forEachItem(t,(t=>this.itemState.setVisible(t,e))),this.geometryManager.forceStateUpdate(t)}getVisibility(t){return t.map((t=>this.itemState.isVisible(t)))}getItemsLength(){return this.model.localIdsLength()}getItems(t){return this.queryManager.getItemsFromIds(t)}getItem(t){return this.queryManager.getItem(t)}getItemGeometry(t){const e=this.boundingBoxManager.getItemInstanceIds(t),s=new Array;for(const t of e){const e=this.geometryManager.getInstanceGeometry(t,Gi.Full);Ka(e.geometries,(t=>{s.push({transform:e.transform,indices:t.indices,positions:t.positions,normals:t.normals})}))}return s}async getSection(t){const e=new li(new Qt(0,0,1),1.5);this._sectionGenerator.plane=e,performance.now();const s=this.queryManager.getItemsLength(),i=new Map,n=[];for(let t=0;t<s;t++){const s=this.boundingBoxManager.getItemInstanceIds(t);if(s)for(const r of s){const s=this.boundingBoxManager.getTransformedAABB(r);if(!e.intersectsBox(s))continue;const o=this.geometryManager.fbGeometry.geometriesItems(t);if("IFCSPACE"===this.model.categories(o))continue;const a=this.geometryManager.fbGeometry.instances(r);if(!a)continue;const h=a.representationId();if(!i.has(h)){const t=[];Ka(this.geometryManager.getInstanceGeometry(r,Gi.Full).geometries,(e=>{if(!e.indices||!e.positions)return;const s=new Vs;s.setIndex(Array.from(e.indices)),s.setAttribute("position",new As(e.positions,3)),t.push(s)})),i.set(h,t)}const c=i.get(h);if(c)for(const t of c){const e=new Xs(t),s=this.geometryManager.getInstanceTransform(r);e.applyMatrix4(s),e.updateWorldMatrix(!0,!0),n.push(e)}}}const r=new Float32Array(6e5),o=new As(r,3,!1),{index:a,indexes:h}=this._sectionGenerator.createEdges({meshes:n,posAttr:o}),c=this._sectionGenerator.createFills(r,h);for(const[,t]of i)for(const e of t)e.dispose();return t.buffer=r,t.index=a,t.fillsIndices=c,t}findItemsByClass(t){return this.queryManager.findByClass(t)}findItemsByGeometryType(t){return this.queryManager.findByGeometryType(t)}setCamera(t){this.camera=t,this.geometryManager.setCamera(t)}getBoundingBox(){return this.boundingBoxManager.modelAABB}getItemsBoundingBox(t){const e=new te,s=this.queryManager.getItemIdsFromLocalIds(t);return this.queryManager.getAABBFromIds(s,e),e}resetCustomMaterials(t){const e=this.queryManager.getItemIdsFromLocalIds(t);if(e)for(const t of e)this.itemState.setCustomMaterialId(t,0);else this.itemState.resetMaterialIds();this.geometryManager.forceUpdate()}_clearSelection(){this.itemState.clearSelection(),this.geometryManager.forceUpdate()}resetVisibility(){this.itemState.resetVisibility(),this.geometryManager.forceUpdate()}resetPickPriority(){this.itemState.resetPickPriority()}guidsToItemIds(t){return this.queryManager.getItemIdsFromGuids(t)}getVisibleItemIds(t){return this.getItemIdsByState((e=>this.itemState.isVisible(e)===t))}getItemIdsByPickPriority(t){return this.getItemIdsByState((e=>this.itemState.getPickPriority(e)===t))}getItemIdsByState(t){const e=[];for(let s=0,i=this.model.localIdsLength();s<i;s++)t(s)&&e.push(s);return e}setItemTransform(t,e){this.geometryManager.setItemTransform(t,e)}getBuffer(){return this.model.bb.bytes().buffer}dispose(){this.geometryManager.dispose()}getItemCategory(t){return this.queryManager.getItemCategory(t)}getItemGuid(t){return this.queryManager.getItemGuid(t)}getLocalIdByGuid(t){return this.queryManager.getLocalIdByGuid(t)}getItemAttributes(t){return this.queryManager.getItemAttributes(t)}getItemRelations(t){return this.queryManager.getItemRelations(t)}getMaxLocalId(){return this.queryManager.getMaxLocalId()}getAllCategories(){return this.queryManager.getAllCategories()}getMetadata(){return this.queryManager.getMetadata()}setupBVH(){Vs.prototype.computeBoundsTree=Oo,Vs.prototype.disposeBoundsTree=Eo,Xs.prototype.raycast=Lo}}async function Ac(t,e){for(let e=0;e<t.args.length;e++)t.args[e]&&t.args[e].elements&&(t.args[e]=Lc(t.args[e])),t.args[e]&&t.args[e].origin&&t.args[e].direction&&(t.args[e]=Cc(t.args[e]));const s=e.get(t.modelId);t.result=await s[t.methodName].apply(s,t.args),t.args=void 0}function Bc(t){return(new Qt).copy(t)}function Tc(t){return t?t.map((t=>new li(Bc(t.normal),t.constant))):t}function zc(t){if(!t)return;const e=Tc(t.planes);return new pi(e[0],e[1],e[2],e[3],e[4],e[5])}function Cc(t){return new Ae(Bc(t.origin),Bc(t.direction))}function Lc(t){return(new Be).copy(t)}const Pc=new class extends ac{constructor(){super(),nt(this,"models",new Map),nt(this,"sharedArray"),this.it[qi.LOAD]=async t=>{const e=new Ic(t.modelId,t.buffer,this.messenger);await e.createCaches(),this.models.set(t.modelId,e),t.buffer=void 0,t.boundingBox=e.getBoundingBox()},this.it[qi.UNLOAD]=t=>{this.models.get(t.modelId).dispose(),this.models.delete(t.modelId)},this.it[qi.PICK]=t=>{if(t.snapTypes)t.hits=this.models.get(t.modelId).pickSnapped(Cc(t.ray),zc(t.frustum),t.snapTypes);else if(t.ray){const e=this.models.get(t.modelId).pick(Cc(t.ray),zc(t.frustum));e&&(t.hits=[e])}else t.childrenItemIds=this.models.get(t.modelId).areaPick(zc(t.frustum),t.frustumPickContainedOnly)},this.it[qi.CAMERA_UPDATE]=t=>{t.camera.frustum=zc(t.camera.frustum),t.camera.position=Bc(t.camera.position),t.camera.clipPlanes=Tc(t.camera.clipPlanes);const e=this.models.get(t.modelId);e&&e.setCamera(t.camera)},this.it[qi.GET_BOUNDINGBOXES]=t=>{t.boundingBoxes=[];const e=this.models.get(t.modelId);if(t.itemIdGroups)for(const s of t.itemIdGroups){const i=e.getItemsBoundingBox(s);t.boundingBoxes.push(i)}else{const s=[0];for(let i=0,n=e.getItemsLength();i<n;i++){s[0]=i;const n=e.getItemsBoundingBox(s);t.boundingBoxes.push(n)}}t.itemIdGroups=void 0},this.it[qi.GUIDS_TO_ITEMIDS]=t=>{t.itemIds=this.models.get(t.modelId).guidsToItemIds(t.guids)},this.it[qi.CALL]=async t=>{await Ac(t,this.models)},this.startUpdateLoop()}startUpdateLoop(){const t=()=>{let e=!0;const s=performance.now();for(const t of this.models.values())if(e=e&&t.updateLoop(s),performance.now()-s>15)break;setTimeout(t,e?100:0)};t()}setSharedArray(t){this.sharedArray=t}};self.onmessage=t=>{if(t.data instanceof MessagePort)Pc.setPort(t.data);else{if(!crossOriginIsolated)return void console.log("SharedArrayBuffers are not enabled. This generally means worse performance. To enable them: https://stackoverflow.com/a/65675390");t.data instanceof SharedArrayBuffer&&Pc.setSharedArray(t.data)}};export{Ac as processCallMessage,zc as restoreFrustum,Lc as restoreMatrix4,Tc as restorePlanes,Cc as restoreRay,Bc as restoreVector};
